!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CommaJS=t():e.CommaJS=t()}(window,function(){return o={},i.m=n=[function(e,t,a){"use strict";(function(n){function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var r={polyfill:function(){var e=0<navigator.userAgent.indexOf("MSIE ")||!!navigator.userAgent.match(/Trident.*rv\:11\./)||0<navigator.userAgent.indexOf("Edge/");if(!("KeyboardEvent"in window)||"key"in KeyboardEvent.prototype&&!e)return!1;var t={get:function(){var e=r.keys[this.which||this.keyCode];return Array.isArray(e)&&(e=e[+this.shiftKey]),e},enumerable:!0,configurable:!0};return Object.defineProperty(KeyboardEvent.prototype,"key",t),t},keys:{3:"Cancel",6:"Help",8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",28:"Convert",29:"NonConvert",30:"Accept",31:"ModeChange",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",41:"Select",42:"Print",43:"Execute",44:"PrintScreen",45:"Insert",46:"Delete",48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],91:"OS",93:"ContextMenu",106:"*",107:"+",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",181:"VolumeMute",182:"VolumeDown",183:"VolumeUp",186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"'],224:"Meta",225:"AltGraph",246:"Attn",247:"CrSel",248:"ExSel",249:"EraseEof",250:"Play",251:"ZoomOut"}};function s(){var e,t=this.parentNode,n=arguments.length;if(t)for(n||t.removeChild(this);n--;)"object"!==o(e=arguments[n])?e=this.ownerDocument.createTextNode(e):e.parentNode&&e.parentNode.removeChild(e),n?t.insertBefore(this.previousSibling,e):t.replaceChild(e,this)}!function(){for(var e=1;e<25;e++)r.keys[111+e]="F"+e;var t="";for(e=65;e<91;e++)t=String.fromCharCode(e),r.keys[e]=[t.toLowerCase(),t.toUpperCase()];for(e=96;e<106;e++)t=String.fromCharCode(e-48),r.keys[e]=t;"function"==typeof define&&a(2)?define("keyboardevent-key-polyfill",r):"undefined"!=typeof exports&&void 0!==n?n.exports=r:window&&(window.keyboardeventKeyPolyfill=r)}();var e=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,o=[{key:"Init",value:function(){r.polyfill(),Element.prototype.replaceWith||(Element.prototype.replaceWith=s),CharacterData.prototype.replaceWith||(CharacterData.prototype.replaceWith=s),DocumentType.prototype.replaceWith||(DocumentType.prototype.replaceWith=s)}}],(n=null)&&i(t.prototype,n),o&&i(t,o),e}();t.a=e}).call(this,a(1)(e))},function(e,t){e.exports=function(e){var t;return e.webpackPolyfill||((t=Object.create(e)).children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1),t}},function(t,e){(function(e){t.exports=e}).call(this,{})},function(e,t,n){"use strict";n.r(t),n.d(t,"BlockNode",function(){return H}),n.d(t,"InlineNode",function(){return z}),n.d(t,"TextNode",function(){return _}),n.d(t,"PluginActions",function(){return Q}),n.d(t,"Plugin",function(){return ut}),n.d(t,"NodeStyle",function(){return E}),n.d(t,"Base64",function(){return dt});var i=n(0);function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.history=[],this.index=0,this.wordCounter=0}var t,n,o;return t=e,(n=[{key:"PushChar",value:function(e,t){this.wordCounter++,2<this.wordCounter&&this.Push(e,t)}},{key:"Push",value:function(e,t){this.wordCounter=0;var n={content:e,cursorPosition:t};this.history[this.index]=n,this.index++,this.history=this.history.slice(0,this.index)}},{key:"GetUndo",value:function(){this.wordCounter=0;var e=this.index-2,t={content:"",cursorPosition:0};return e<0?(e=0,this.index=1,t=this.history[e]):(t=this.history[e],this.index--),t}},{key:"GetRedo",value:function(){this.wordCounter=0;var e=this.index;e>this.history.length-1&&(e=this.history.length-1);var t=this.history[e];return this.index=e+1,t}}])&&r(t.prototype,n),o&&r(t,o),e}();function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var l=["Meta+1","Meta+2","Meta+3","Meta+4","Meta+5","Meta+6","Meta+7","Meta+8","Meta+9","Meta+0","Ctrl+q","Ctrl+w","Ctrl+e","Ctrl+r","Ctrl+t","Ctrl+y","Ctrl+o","Ctrl+p","Ctrl+s","Ctrl+d","Ctrl+f","Ctrl+g","Ctrl+h","Ctrl+j","Ctrl+k","Ctrl+l","Ctrl+n","Ctrl+m"],u=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.editor=e,this.shortcutsByKey={},this.SetShortcuts(t)}var e,t,o;return e=n,o=[{key:"FormatKeyboardInput",value:function(e){var t=e.key,n="";return e.metaKey&&(""==n?n="Meta":n+="+Meta"),e.ctrlKey&&(""==n?n="Ctrl":n+="+Ctrl"),e.altKey&&(""==n?n="Alt":n+="+Alt"),n+="+"+t,l.indexOf(n)<0&&(n="_protected_"),n}}],(t=[{key:"SetShortcuts",value:function(e){var n=this;this.shortcuts=e,null!=this.shortcuts&&this.shortcuts.forEach(function(e){var t={action:e.action,params:e.params};n.shortcutsByKey[e.shortcut.toLowerCase()]=t})}},{key:"Fire",value:function(e){var t,n=!1;return"_protected_"==e||null!=(t=this.shortcutsByKey[e.toLowerCase()])&&(n=!0,this._performAction(t.action,t.params)),n}},{key:"_performAction",value:function(e,t){"insertText"==e?this.editor.AppendTextAtCursor(t.text):"insertPlugin"==e?this.editor.InsertPluginAtSection(t.pluginName,t.pluginParams):"function"==e&&null!=t&&t()}}])&&a(e.prototype,t),o&&a(e,o),n}();function c(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw r}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function h(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var f={ENTER:"enter",ESC:"esc",BACKSPACE:"backspace",DELETE:"delete",TAB:"tab",CUT:"cut",COPY:"copy",PASTE:"paste",CUR_POS_CHANGED:"cursorPositionHasChanged",AFTER_CHAR_ADDED:"afterCharacterIsAdded",ARROW_UP:"arrowUp",ARROW_DOWN:"arrowDown",ARROW_LEFT:"arrowLeft",ARROW_RIGHT:"arrowRight",SHIFT_ARROW_UP:"shiftArrowUp",SHIFT_ARROW_DOWN:"shiftArrowDown",SHIFT_ARROW_LEFT:"shiftArrowLeft",SHIFT_ARROW_RIGHT:"shiftArrowRight",SHIFT_DOWN:"SHIFT_DOWN",SHIFT_UP:"SHIFT_UP",SELECT_ALL:"SELECT_ALL",BEFORE_COPY:"BEFORE_COPY",BEFORE_CUT:"BEFORE_CUT",BEFORE_PASTE:"BEFORE_PASTE",BOLD:"BOLD",ITALIC:"ITALIC",UNDERLINED:"UNDERLINED",SELECTION_CHANGED:"SELECTION_CHANGED"},p=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=e,this.stopClipboardEvent=!1}var e,n,o;return e=t,(n=[{key:"OnClick",value:function(e){this.editor.FireStyleMonitoring(),this.editor.Fire(f.CUR_POS_CHANGED,e),this.editor.Fire(f.CLICK,e),e.preventDefault(),e.stopPropagation()}},{key:"KeyDown",value:function(e){var t=e.key;switch(t){case"Tab":this.editor.Fire(f.TAB,e)&&(e.preventDefault(),e.stopPropagation());break;case"Meta":break;case"Shift":this.editor.Fire(f.SHIFT_DOWN,e)&&(e.preventDefault(),e.stopPropagation());break;case"Alt":case"Control":break;case"Down":case"ArrowDown":(e.shiftKey?this.editor.Fire(f.SHIFT_ARROW_DOWN,e):this.editor.Fire(f.ARROW_DOWN,e))&&(e.preventDefault(),e.stopPropagation());break;case"Up":case"ArrowUp":(e.shiftKey?this.editor.Fire(f.SHIFT_ARROW_UP,e):this.editor.Fire(f.ARROW_UP,e))&&(e.preventDefault(),e.stopPropagation());break;case"Left":case"ArrowLeft":(e.shiftKey?this.editor.Fire(f.SHIFT_ARROW_LEFT,e):this.editor.Fire(f.ARROW_LEFT,e))&&(e.preventDefault(),e.stopPropagation());break;case"Right":case"ArrowRight":(e.shiftKey?this.editor.Fire(f.SHIFT_ARROW_RIGHT,e):this.editor.Fire(f.ARROW_RIGHT,e))&&(e.preventDefault(),e.stopPropagation());break;case"CapsLock":break;case"Enter":this.editor.Fire(f.ENTER,e)&&(e.preventDefault(),e.stopPropagation());break;case"Esc":case"Escape":this.editor.Fire(f.ESC,e)&&(e.preventDefault(),e.stopPropagation());break;case"Backspace":this.editor.Fire(f.BACKSPACE,e)&&(e.preventDefault(),e.stopPropagation());break;case"Delete":this.editor.Fire(f.DELETE,e)&&(e.preventDefault(),e.stopPropagation());break;default:e.metaKey&&!e.shiftKey&&"z"==t?(this.editor.Undo(),e.preventDefault(),e.stopPropagation()):e.shiftKey&&e.metaKey&&"z"==t?(this.editor.Redo(),e.preventDefault(),e.stopPropagation()):e.ctrlKey&&!e.shiftKey&&"z"==t?(this.editor.Undo(),e.preventDefault(),e.stopPropagation()):e.ctrlKey&&e.shiftKey&&"z"==t?(this.editor.Redo(),e.preventDefault(),e.stopPropagation()):(e.metaKey||e.ctrlKey)&&"a"==t?this.editor.Fire(f.SELECT_ALL,e)&&(e.preventDefault(),e.stopPropagation()):(e.metaKey||e.ctrlKey)&&"c"==t?this.stopClipboardEvent=this.editor.Fire(f.BEFORE_COPY,e):(e.metaKey||e.ctrlKey)&&"x"==t?this.stopClipboardEvent=this.editor.Fire(f.BEFORE_CUT,e):(e.metaKey||e.ctrlKey)&&"b"==t?(this.stopClipboardEvent=this.editor.Fire(f.BOLD,e),e.preventDefault(),e.stopPropagation()):(e.metaKey||e.ctrlKey)&&"i"==t?(this.stopClipboardEvent=this.editor.Fire(f.ITALIC,e),e.preventDefault(),e.stopPropagation()):(e.metaKey||e.ctrlKey)&&"u"==t?(this.stopClipboardEvent=this.editor.Fire(f.UNDERLINED,e),e.preventDefault(),e.stopPropagation()):(e.metaKey||e.ctrlKey||e.altKey)&&""!=t&&this.editor.ManageUserShortcuts(u.FormatKeyboardInput(e))&&(e.preventDefault(),e.stopPropagation()),e.metaKey||e.ctrlKey||e.altKey||""!=t&&this.editor.InsertCharacter(t)&&(e.preventDefault(),e.stopPropagation())}this.editor.Fire(f.AFTER_CHAR_ADDED,e)}},{key:"KeyUp",value:function(e){var t=e.key;switch(t){case"Meta":break;case"Shift":this.editor.Fire(f.SHIFT_UP,e)&&(e.preventDefault(),e.stopPropagation());break;case"Alt":case"Control":break;case"Down":case"ArrowDown":this.editor.FireStyleMonitoring(),this.editor.Fire(f.CUR_POS_CHANGED,e);break;case"Up":case"ArrowUp":this.editor.FireStyleMonitoring(),this.editor.Fire(f.CUR_POS_CHANGED,e);break;case"Left":case"ArrowLeft":this.editor.FireStyleMonitoring(),this.editor.Fire(f.CUR_POS_CHANGED,e);break;case"Right":case"ArrowRight":this.editor.FireStyleMonitoring(),this.editor.Fire(f.CUR_POS_CHANGED,e)}e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||""!=t&&this.editor.DoneInsertCharacter(t)}},{key:"OnPaste",value:function(e){var t=e.clipboardData.getData("text/html"),n=Array.from(e.clipboardData.files||[]);if(!t&&0<n.length){if(null!=this.editor.onFilesPasted){var o,i=[],r=c(n);try{for(r.s();!(o=r.n()).done;){var s=o.value;0==i.length&&i.push(s)}}catch(e){r.e(e)}finally{r.f()}this.editor.onFilesPasted(i)}else console.log("Files paste not supported: add onFilesPasted implementation");e.preventDefault(),e.stopPropagation()}else this.stopClipboardEvent=this.editor.Fire(f.BEFORE_PASTE,e),(this.stopClipboardEvent||this.editor.Fire(f.PASTE,e))&&(e.preventDefault(),e.stopPropagation()),this.stopClipboardEvent=!1}},{key:"OnCut",value:function(e){(this.stopClipboardEvent||this.editor.Fire(f.CUT,e))&&(e.preventDefault(),e.stopPropagation()),this.stopClipboardEvent=!1}},{key:"OnCopy",value:function(e){(this.stopClipboardEvent||this.editor.Fire(f.COPY,e))&&(e.preventDefault(),e.stopPropagation()),this.stopClipboardEvent=!1}}])&&h(e.prototype,n),o&&h(e,o),t}();function y(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var g=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.allKeys={},null!=e&&e.forEach(function(e){this.allKeys[e]=!0})}var e,n,o;return e=t,(n=[{key:"GetNew",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=!1,n="";!t;){for(var o=0;o<5;o++)n+=e.charAt(Math.floor(Math.random()*e.length));null==this.allKeys[n]&&(t=this.allKeys[n]=!0)}return n}},{key:"Release",value:function(e){delete this.allKeys[e]}},{key:"VerifyAndRegister",value:function(e){return this.allKeys[e]&&(e=this.GetNew()),this.allKeys[e]=!0,e}},{key:"Reset",value:function(){this.allKeys={}}}])&&y(e.prototype,n),o&&y(e,o),t}(),o={exampleClass:{applyAs:"class",classes:["ex1","ex2"]},margin:{applyAs:"style",name:"margin",on:"set#by#user",off:"",isToggle:!1},width:{applyAs:"style",name:"width",on:"set#by#user",off:"",isToggle:!1},height:{applyAs:"style",name:"height",on:"set#by#user",off:"",isToggle:!1},border:{applyAs:"style",name:"border",on:"set#by#user",off:"",isToggle:!1},bold:{applyAs:"style",name:"fontWeight",on:"bold",off:"normal",isToggle:!0},italic:{applyAs:"style",name:"fontStyle",on:"italic",off:"normal",isToggle:!0},underlined:{applyAs:"style",name:"textDecorationLine",on:"underline",off:"none",preserve:!0,isToggle:!0},strike:{applyAs:"style",name:"textDecorationLine",on:"line-through",off:"none",preserve:!0,isToggle:!0},fontSize:{applyAs:"style",name:"fontSize",on:"set#by#user",off:"initial",isToggle:!1},fontFamily:{applyAs:"style",name:"fontFamily",on:"set#by#user",off:"initial",isToggle:!1},fontColor:{applyAs:"style",name:"color",on:"set#by#user",off:"initial",isToggle:!1,isColor:!0},backgroundColor:{applyAs:"style",name:"backgroundColor",on:"set#by#user",off:"initial",isToggle:!1,isColor:!0},align:{applyAs:"style",name:"textAlign",on:"set#by#user",off:"left",isToggle:!0},indent:{applyAs:"style",name:"paddingLeft",step:40,preserve:!1,calculated:!0,unit:"px",on:0,off:0,isToggle:!1},lineSpacing:{applyAs:"style",name:"lineHeight",on:"set#by#user",off:"normal",isToggle:!1},horizontalRule:{applyAs:"style",name:"borderBottom",on:"1px solid #8c8c8c",off:"none"},headerOne:{applyAs:"class",classes:["headerOne"]},headerTwo:{applyAs:"class",classes:["headerTwo"]},headerThree:{applyAs:"class",classes:["headerThree"]},superscript:{applyAs:"class",classes:["scplSup"],isToggle:!0},subscript:{applyAs:"class",classes:["scplSub"],isToggle:!0},splitSelection:{applyAs:"class",classes:["splitSelectionDummy"]},quote:{applyAs:"class",classes:["commaQuoteContainer"],isToggle:!0}};function m(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function v(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?m(Object(r),!0).forEach(function(e){var t,n,o;t=i,o=r[n=e],n in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}function C(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function N(e,t,n){var o,i;return e.classList?n?e.classList.toggle(t,!0):e.classList.toggle(t):0<=(i=(o=e.className.split(" ")).indexOf(t))&&!n?o.splice(i,1):(o.push(t),e.className=o.join(" ")),e}var E=function(){function f(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),this.document=e,null!=t&&(t=JSON.parse(JSON.stringify(t))),this.styles=t,null==this.styles&&(this.styles={}),this.additionalStyles={},this.additionalClasses={}}var e,t,n;return e=f,n=[{key:"GetAllStyles",value:function(e){var t=o;return null!=e.allStyles&&(t=v(v({},o),e.allStyles)),t}},{key:"cssNameToJsName",value:function(e){for(var t=e.split("-"),n="",o=0;o<t.length;o++)0<o&&0<t[o].length&&(1!=o||"ms"!=t[o])&&(t[o]=t[o].substr(0,1).toUpperCase()+t[o].substr(1)),n+=t[o];return n}},{key:"jsNameToCssName",value:function(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}},{key:"ParseDefaultFormat",value:function(e,n){var o=new f(e);return null!=n&&Object.keys(n).forEach(function(e){var t=n[e];t&&o.Toggle(e,t)}),o}},{key:"parseStyle",value:function(e){var t={};if(3!=e.nodeType&&8!=e.nodeType&&null!=e.getAttribute("cm-plugin"))for(var n=0,o=e.style.length;n<o;n++){var i=e.style[n].replace(/-([a-z])/g,function(e){return e[1].toUpperCase()}),r=e.style[i];t[i]=r}return t}},{key:"CalculateStylesForExternalHTML",value:function(e,t){var n=window.getComputedStyle(t),o=f.GetAllStyles(e),i=Object.keys(o),r={},s=new f(e);i.forEach(function(e){var t;"height"==e.toLowerCase()||"width"==e.toLowerCase()||"style"==(t=JSON.parse(JSON.stringify(o[e]))).applyAs&&(r[t.name]=e)});for(var a=n.length;a--;){var l,u,c=n[a],d=n.getPropertyValue(c),h=r[f.cssNameToJsName(c)];null==h||""==h||null!=(l=JSON.parse(JSON.stringify(o[h])))&&("set#by#user"==l.on?(l.on=d,s.styles[h]=l):l.preserve?d.indexOf(l.on)<0||(s.styles[h]=l):(l.calculated?(u=null!=(u=d.replace(l.unit,""))&&""!=u?parseInt(u):0,l.on=u):l.on==d||(l.on=d),s.styles[h]=l))}return s}},{key:"CalculateStyles",value:function(e,a){var l=f.parseStyle(a),u=new f(e),c=f.GetAllStyles(e);return Object.keys(c).forEach(function(e){var t,n,o,i,r,s=JSON.parse(JSON.stringify(c[e]));"style"==s.applyAs?null==a.style||null!=(t=a.style[s.name])&&""!=t&&(null!=l[s.name]&&delete l[s.name],"set#by#user"==s.on?(s.on=t,u.styles[e]=s):s.preserve?t.indexOf(s.on)<0||(u.styles[e]=s):s.calculated?(n=null!=(n=t.replace(s.unit,""))&&""!=n?parseInt(n):0,s.on=n,u.styles[e]=s):s.on==t&&(u.styles[e]=s)):"class"==s.applyAs&&(a.classList?(o=!0,s.classes.forEach(function(e){a.classList.contains(e)||(o=!1)}),o&&(u.styles[e]=s)):null!=a.className&&(i=a.className.split(" "),r=!0,s.classes.forEach(function(e){i.indexOf(e)<0&&(r=!1)}),r&&(u.styles[e]=s)))}),u.additionalStyles=l,u.additionalClasses={},u}}],(t=[{key:"isEmpty",value:function(){var e=!1,t=Object.keys(this.styles).length,n=Object.keys(this.additionalStyles).length,o=Object.keys(this.additionalStyles).length;return 0==t&&0==n&&0==o&&(e=!0),e}},{key:"toStringForStyleTag",value:function(){var i="",r=this,e=Object.keys(this.styles),s={};return e.forEach(function(e){var t,n,o=r.styles[e];"style"==o.applyAs&&(o.preserve?(null==s[o.name]&&(s[o.name]=[]),s[o.name].push(o)):(t=o.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=o.on,i=i+t+": "+n.replace(/"/g,"'")+";"))}),Object.keys(s).forEach(function(e){var t=s[e],n="",o="";t.forEach(function(e){"style"==e.applyAs&&e.preserve&&(n=e.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=""==o?e.on:o+" "+e.on)}),i=i+n+": "+o.replace(/"/g,"'")+";"}),i}},{key:"toStringForClassTag",value:function(){var n="",o=this;return Object.keys(this.styles).forEach(function(e){var t=o.styles[e];"class"==t.applyAs&&t.classes.forEach(function(e){n=""==n?e:n+" "+e})}),n}},{key:"toJSON",value:function(){return{style:this.styles}}},{key:"Copy",value:function(){var e=new f(this.document);return e.styles=JSON.parse(JSON.stringify(this.styles)),e.additionalStyles=JSON.parse(JSON.stringify(this.additionalStyles)),e.additionalClasses=JSON.parse(JSON.stringify(this.additionalClasses)),e}},{key:"Equals",value:function(o){var i=!0,r=this,t=Object.keys(o.styles),e=Object.keys(r.styles);return t.length!=e.length?i=!1:(e.forEach(function(e){t.indexOf(e)<0&&(i=!1)}),i&&e.every(function(e){var t=r.styles[e],n=o.styles[e];return t.on!=n.on&&(i=!1,t.isColor&&n.isColor&&r.AreSameColors(t.on,n.on)&&(i=!0)),i})),i}},{key:"AreSameColors",value:function(e,t){return(e=this._parseColor(e))==(t=this._parseColor(t))}},{key:"_parseColor",value:function(e){var t,n=e;return null!=e&&(-1<e.toLowerCase().indexOf("rgb")||-1<e.toLowerCase().indexOf("rgba"))&&(t=(e=e.toLowerCase()).split("(")[1].split(")")[0].split(","),n="#"+this._rgbToHex(t[0].split(" ").join(""))+this._rgbToHex(t[1].split(" ").join(""))+this._rgbToHex(t[2].split(" ").join(""))),n}},{key:"_rgbToHex",value:function(e){var t=Number(e).toString(16);return t.length<2&&(t="0"+t),t}},{key:"isAlreadyApplied",value:function(e){var t=f.GetAllStyles(this.document);if(null==t[e])return console.log("Unknown style: "+e),!1;var n=JSON.parse(JSON.stringify(t[e])),o=!1;return"style"==n.applyAs?null!=this.styles[e]&&(o="set#by#user"!=n.on):"class"==n.applyAs&&null!=this.styles[e]&&(o=!0),o}},{key:"Apply",value:function(i){var r=this;i.style="",Object.keys(r.styles).forEach(function(e){var t,n,o=r.styles[e];"style"==o.applyAs?"set#by#user"==o.on?i.style[o.name]=o.on:o.preserve?(t=i.style[o.name],n="",t.split(" ").forEach(function(e){e!=o.on&&"none"!=e&&(n+=" "+e)}),n+=" "+o.on,i.style[o.name]=n):o.calculated?i.style[o.name]=o.on.toString()+o.unit:i.style[o.name]=o.on:"class"==o.applyAs&&o.classes.forEach(function(e){i=N(i,e,!0)})}),Object.keys(r.additionalStyles).forEach(function(e){i.style[e]=r.additionalStyles[e]})}},{key:"Toggle",value:function(e,t,n){var o=2<arguments.length&&void 0!==n&&n,i=f.GetAllStyles(this.document);if(null==i[e])return console.log("Unknown style: "+e),!1;var r=JSON.parse(JSON.stringify(i[e])),s=!0;return this.isAlreadyApplied(e)&&!o?(s=!1,delete this.styles[e]):"style"==r.applyAs?("set#by#user"==r.on&&(r.on=t),this.styles[e]=r):"class"==r.applyAs&&(this.styles[e]=r),s}},{key:"CalculateStyle",value:function(e,t){return"style"==e.applyAs&&e.calculated&&("add"==t?e.on=e.on+e.step:"subtract"==t&&(e.on=e.on-e.step,e.on<e.off&&(e.on=e.off))),e}},{key:"ToggleOnDomElement",value:function(t,e,n,o){var i=3<arguments.length&&void 0!==o&&o,r=f.GetAllStyles(this.document);if(null==r[e])return console.log("Unknown style: "+e),!1;if(null==r[e])throw"Style '"+e+"' is not defined";var s,a,l,u,c,d=JSON.parse(JSON.stringify(r[e])),h=!0;return this.isAlreadyApplied(e)&&!i?(h=!1,"style"==d.applyAs?"set#by#user"==d.on?t.style[d.name]=d.off:d.calculated?(null==(s=this.styles[e])&&(s=JSON.parse(JSON.stringify(d))),s=this.CalculateStyle(s,n),t.style[d.name]=s.on.toString()+s.unit):(d.preserve?(a=t.style[d.name],l="",a.split(" ").forEach(function(e){e!=d.on&&(l+=" "+e)}),""==l&&(l+=" "+d.off),t.style[d.name]=l):t.style[d.name]=d.off,delete this.styles[e]):"class"==d.applyAs&&(delete this.styles[e],d.classes.forEach(function(e){t=N(t,e)}))):"style"==d.applyAs?("set#by#user"==d.on?((d=JSON.parse(JSON.stringify(d))).on=n,t.style[d.name]=n):d.preserve?(u=t.style[d.name],c="",u.split(" ").forEach(function(e){e!=d.on&&"none"!=e&&(c+=" "+e)}),c+=" "+d.on,t.style[d.name]=c):d.calculated?(d=this.CalculateStyle(d,n),t.style[d.name]=d.on.toString()+d.unit):t.style[d.name]=d.on,this.styles[e]=d):"class"==d.applyAs&&(d.classes.forEach(function(e){t=N(t,e)}),this.styles[e]=d),h}}])&&C(e.prototype,t),n&&C(e,n),f}();function S(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var T={BLOCK:"block",INLINE:"inline",TEXT:"text"},b=function(){function r(e,t,n,o){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),null==i&&(i=new E(e)),this.document=e,this.id=t,this.tagName=n,this.type=o,this.nodeStyle=i,this.attributes=[],this.children=[],this.previous=void 0,this.next=void 0,this.parent=void 0,this.domElement=void 0}var e,t,n;return e=r,(t=[{key:"AddAttribute",value:function(e,t){var n={name:e,value:t};this.attributes.push(n),null!=this.domElement&&this.domElement.setAttribute(e,t)}},{key:"GetAttribute",value:function(t){var e,n=void 0;return this.attributes.forEach(function(e){e.name==t&&(n=e.value)}),null!=n||null!=(e=this.domElement.getAttribute(t))&&(n=e),n}},{key:"RemoveAttribute",value:function(t){var n=this,o=[];this.attributes.forEach(function(e){e.name==t?null!=n.domElement&&n.domElement.removeAttribute(t):o.push(e)}),this.attributes=o}},{key:"_isType",value:function(e){var t=!1;return this.type==e&&(t=!0),t}},{key:"isBlockNode",value:function(){return this._isType(T.BLOCK)}},{key:"isInlineNode",value:function(){return this._isType(T.INLINE)}},{key:"isTextNode",value:function(){return this._isType(T.TEXT)}},{key:"IsStyleApplied",value:function(e){return this.nodeStyle.isAlreadyApplied(e)}},{key:"ToggleStyle",value:function(e,t,n,o){var i=!(2<arguments.length&&void 0!==n)||n,r=3<arguments.length&&void 0!==o&&o;return null!=this.nodeStyle&&null!=this.nodeStyle.styles||(this.nodeStyle=new E(this.document)),i?this.nodeStyle.ToggleOnDomElement(this.domElement,e,t,r):this.nodeStyle.Toggle(e,t,r)}},{key:"GetBlockContainer",value:function(){return this.isBlockNode()?this:this.parent.GetBlockContainer()}},{key:"SetPluginType",value:function(e){this.pluginName=e,this.domElement.setAttribute("cm-plugin",e)}},{key:"RemovePluginType",value:function(){this.pluginName="",this.domElement.removeAttribute("cm-plugin")}},{key:"GetPluginType",value:function(){return this.pluginName}},{key:"Delete",value:function(e){e?this.document.DeleteNode(this):this.document.DeleteNode(this,!0)}},{key:"Contains",value:function(t){var n=!1;return null!=this.children&&this.children.forEach(function(e){n=n||(e.id==t||e.Contains(t))}),n}}])&&S(e.prototype,t),n&&S(e,n),r}();function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(r){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,o,i=O(r);return t=s?(e=O(this).constructor,Reflect.construct(i,arguments,e)):i.apply(this,arguments),n=this,!(o=t)||"object"!==A(o)&&"function"!=typeof o?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(n):o}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(l,b);var e,t,n,a=P(l);function l(e,t,n,o,i){var r,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:[];return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(r=a.call(this,e,t,n,T.TEXT,o)).attributes=s,null==i&&(i=""),r.text=i,r.GenerateDomElement(),r}return e=l,n=[{key:"CreateNew",value:function(e,t,n,o,i){var r=new l(e,e.GenereateNewNodeId(),t,o,n,i);return e.RegisterNode(r),r}}],(t=[{key:"Copy",value:function(){return new l(this.document,"",this.tagName,this.nodeStyle.Copy(),this.text,JSON.parse(JSON.stringify(this.attributes)))}},{key:"Append",value:function(){throw new Exception("Text nodes cannot contain any other node")}},{key:"GenerateDomElement",value:function(){this.domElement=void 0;var t=document.createElement(this.tagName);t.setAttribute("cm-id",this.id),t.setAttribute("cm-type",this.type),this.attributes.forEach(function(e){""!=e.name&&t.setAttribute(e.name,e.value)}),""==this.text?t.appendChild(document.createTextNode("\ufeff")):t.appendChild(document.createTextNode(this.text)),this.domElement=t,null!=this.nodeStyle&&this.nodeStyle.Apply(this.domElement)}},{key:"ApplyNodeStyle",value:function(e){null!=e&&(this.nodeStyle=e,this.nodeStyle.Apply(this.domElement))}},{key:"SetAttributes",value:function(e){var t=this;this.attributes=e,this.attributes.forEach(function(e){""!=e.name&&t.domElement.setAttribute(e.name,e.value)})}},{key:"AddAttribute",value:function(e,t){var n={name:e,value:t};this.attributes.push(n),this.domElement.setAttribute(n.name,n.value)}},{key:"RemoveAttribute",value:function(t){var n=[];this.attributes.forEach(function(e){e.name!=t&&n.push(e)}),this.attributes=n,this.domElement.removeAttribute(t)}},{key:"SetFocusAtTheEnd",value:function(){this.SetCarretAtTheEnd()}},{key:"SetCarretAtTheEnd",value:function(){this.SelectText(this.text.length,this.text.length)}},{key:"SelectText",value:function(e,t){var n,o;e==t?this.SetFocus(e):(n=window.getSelection(),(o=document.createRange()).setStart(this.domElement.firstChild,e),o.setEnd(this.domElement.firstChild,t),n.removeAllRanges(),n.addRange(o))}},{key:"SetFocus",value:function(e){null==e&&(e=0),""==this.text&&(e=1);var t=document.createRange(),n=window.getSelection();if(null!=this.domElement.firstChild){this.domElement.firstChild.length<e&&(e=this.domElement.firstChild.length),t.setStart(this.domElement.firstChild,e),t.collapse(!0),n.removeAllRanges();try{n.addRange(t)}catch(e){console.log(e)}}}},{key:"HasSameStyle",value:function(e){return this.nodeStyle.Equals(e.nodeStyle)}},{key:"HasSameAttributes",value:function(e){var t,n=!0,o=e.attributes;return this.attributes.length!=o.length?n=!1:(t={},o.forEach(function(e){t[e.name]=e.value}),this.attributes.forEach(function(e){(null==t[e.name]||t[e.name]!=e.value)&&(n=!1)})),n}},{key:"SetZeroWidthChar",value:function(){this.text="",this.domElement.removeChild(this.domElement.firstChild),this.domElement.appendChild(document.createTextNode("\ufeff"))}},{key:"TrimTextContent",value:function(e,t){this.ForceTextContent(this.text.substring(e,t))}},{key:"DeleteText",value:function(e,t){var n,o,i,r;"string"!=typeof this.text&&(this.text=JSON.stringify(this.text)),""==this.text||(0==e&&t==this.text.length?this.text="":e==t||(0<e?t<this.text.length?(n=this.text.substring(0,e),this.text.substring(e,t),o=this.text.substring(t,this.text.length),this.text=n+o):t==this.text.length&&(i=this.text.substring(0,e),this.text.substring(e,t),this.text=i):0==e&&t<this.text.length&&(this.text.substring(e,t),r=this.text.substring(t,this.text.length),this.text=r)))}},{key:"RemoveCharAt",value:function(e,t){var n=this.domElement.textContent.replace(/[\u200B-\u200D\uFEFF]/g,"");this.text=n.slice(0,e)+n.slice(e+1),null!=t&&t&&this.ForceTextContent(this.text)}},{key:"AppendTextContent",value:function(e){this.text=this.text+e,this.ForceTextContent(this.text)}},{key:"ForceTextContent",value:function(e){this.text=e,""==this.text?(this.domElement.removeChild(this.domElement.firstChild),this.domElement.appendChild(document.createTextNode("\ufeff"))):(this.domElement.removeChild(this.domElement.firstChild),this.domElement.appendChild(document.createTextNode(this.text)))}},{key:"ForceInsertString",value:function(e){var t,n;""==this.text?(this.text=e,this.domElement.textContent=this.text,this.SetFocus(e.length)):null!=e&&""!=e&&(t=document.getSelection().getRangeAt(0).startOffset,n=this.domElement.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""),this.text=[n.slice(0,t),e,n.slice(t)].join(""),"\n"==e&&""==n.slice(t)&&(this.text=this.text+" "),this.domElement.textContent=this.text,this.SetFocus(t+e.length))}},{key:"InsertCharacter",value:function(e){var t,n,o,i,r,s,a=!1;return""==this.text?(" "==e&&(e="Â "),t=document.createTextNode(e),this.domElement.removeChild(this.domElement.firstChild),this.domElement.appendChild(t),(o=(n=document.getSelection()).getRangeAt(0)).selectNodeContents(this.domElement.firstChild),o.collapse(),n.removeAllRanges(),n.addRange(o),a=!0,this.text=this.domElement.textContent.replace(/[\u200B-\u200D\uFEFF]/g,"")):(null==e&&(e=""),i=document.getSelection().getRangeAt(0),r=this.domElement.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""),s=i.startOffset,this.text=[r.slice(0,s),e,r.slice(s)].join(""),a=!1),a}},{key:"Split",value:function(e,t){var n,o,i,r,s,a,l,u,c,d,h,f,p,y,g,m,v,C,N,E,S,T,b,A=[];return""==this.text||0==e&&t==this.text.length?A.push(this):e==t?0==e?((n=this.Copy()).text="",A.push(n),o=this.Copy(),A.push(o)):e==this.text.length?(i=this.Copy(),A.push(i),(r=this.Copy()).text="",A.push(r)):(s=this.text.substring(0,e),a=this.text.substring(e,this.text.length),(l=this.Copy()).text=s,A.push(l),(u=this.Copy()).text="",A.push(u),(c=this.Copy()).text=a,A.push(c)):0<e?t<this.text.length?(d=this.text.substring(0,e),h=this.text.substring(e,t),f=this.text.substring(t,this.text.length),(p=this.Copy()).text=d,A.push(p),(y=this.Copy()).text=h,A.push(y),(g=this.Copy()).text=f,A.push(g)):t==this.text.length&&(m=this.text.substring(0,e),v=this.text.substring(e,t),(C=this.Copy()).text=m,A.push(C),(N=this.Copy()).text=v,A.push(N)):0==e&&t<this.text.length&&(E=this.text.substring(e,t),S=this.text.substring(t,this.text.length),(T=this.Copy()).text=E,A.push(T),(b=this.Copy()).text=S,A.push(b)),A}},{key:"Merge",value:function(t,e){if(!t.isTextNode())throw console.log("87-16"),"Fatal error: 87-16";var n,o,i,r=this;null==e?r.text=r.text+t.text:(n=r.text,o=t.text,r.text=[n.slice(0,e),o,n.slice(e)].join("")),r.ForceTextContent(r.text),r.next=t.next,t.domElement.remove(),this.document.UnregisterNode(t),null!=t.parent&&(i=[],t.parent.children.forEach(function(e){e.id!=t.id&&i.push(e)}),t.parent.children=i)}},{key:"ChangeTagName",value:function(e){this.tagName=e;for(var t=this.domElement,n=document.createElement(e),o=0,i=t.attributes.length;o<i;++o){var r=t.attributes.item(o).nodeName,s=t.attributes.item(o).nodeValue;n.setAttribute(r,s)}for(;t.hasChildNodes();)n.appendChild(t.removeChild(t.firstChild));t.parentNode.replaceChild(n,t),this.domElement=n}}])&&x(e.prototype,t),n&&x(e,n),l}();function w(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var F=function(){function g(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),this.document=e}var e,t,n;return e=g,n=[{key:"PrintToConsole",value:function(e,t){var n=new g(e);t?n._debugPrintNode(n.document.rootNode):console.log(n.document.rootNode)}},{key:"DeleteNodesBetween",value:function(e,t,n){return new g(e)._DeleteNodesBetween(t,n)}},{key:"GetAllTextNodes",value:function(e,t,n,o){return new g(e)._getAllTextNodes(t,n,o)}},{key:"InsertNodeAtCursor",value:function(e,t){e.selectionManager.IsCollapsed()||e.DeleteSelection();var n,o,i=e.selectionManager.GetCurrent(),r=i.startNode,s=i.startOffset,a=i.endOffset;r.isTextNode()&&(n=[],2==(o=r.Split(s,a)).length?0==s?(t.isInlineNode()&&n.push(_.CreateNew(e,"span","",r.nodeStyle.Copy())),n.push(t),n.push(o[1])):(n.push(o[0]),n.push(t)):3==o.length?(n.push(o[0]),n.push(t),n.push(o[2])):1==o.length&&(t.isInlineNode()&&n.push(_.CreateNew(e,"span","",r.nodeStyle.Copy())),n.push(t)),g.ReplaceNode(e,r,n,!1,!0,r.nodeStyle.Copy()),t.next.SetFocus())}},{key:"ReplaceNode",value:function(n,o,i,r,e,s){var a=n;null==r&&(r=!1);var l,u,c,d,t,h,f,p=o.parent,y=!0;(null==p||1==i.length&&i[0].id==o.id)&&(y=!1),y&&(u=void 0,d=c=!(l=[]),p.children.forEach(function(e){var t;e.id==o.id?(i.forEach(function(e){var t;e.id=a.GenereateNewNodeId(),e.GenerateDomElement(),null!=u&&(u.next=e,u.isInlineNode()&&e.isInlineNode()&&((t=_.CreateNew(n,"span","",s.Copy())).previous=u,t.parent=u.parent,u.next=t,u.domElement.parentNode.insertBefore(t.domElement,u.domElement.nextSibling),l.push(t),u=t)),e.previous=u,e.next=void 0,e.parent=p,e.document=p.document,u=e,l.push(e),a.RegisterNode(e)}),c=!0,r&&(d=!0)):d||(c&&(null!=u&&(u.isInlineNode()&&e.isInlineNode()?(null==s&&(s=n.GetDefaultNodeStyle()),(t=_.CreateNew(n,"span","",s.Copy())).previous=u,t.parent=u.parent,u.next=t,u=t,e.domElement.parentNode.insertBefore(t.domElement,e.domElement),l.push(t)):u.next=e),e.previous=u,c=!1),null!=(u=e).next&&e.next.id==o.id&&(e.next=void 0),l.push(e))}),p.children=l,t=!0,h=void 0,i.forEach(function(e){h=(t?(t=!1,o.domElement.replaceWith(e.domElement)):h.domElement.parentNode.insertBefore(e.domElement,h.domElement.nextSibling),e)}),t&&o.domElement.remove(),a.UnregisterNode(o),e?(f=_.CreateNew(n,"span","",s.Copy()),p.Append(f)):p.isBlockNode()&&0==p.children?g.ReplaceNode(n,p,[],r):o.isBlockNode())}}],(t=[{key:"_debugPrintNode",value:function(e,t){var n=this;null==t&&(t=""),e.isTextNode()?console.log(t+e.id+" "+e.tagName+" %c"+e.type+" %c=> [%c"+e.text+"%c]","color:#ad0c9d","color:black","color:#129957","color:black"):console.log(t+e.id+" "+e.tagName+" %c"+e.type,"color:#ad0c9d"),e.children.forEach(function(e){n._debugPrintNode(e,t+"   ")})}},{key:"_recursive_getAllTextNodes",value:function(e){var t;this.adding?this.toNode.id==e.id?(this.adding=!1,this.includeFromAndToInResults&&e.isTextNode()&&this.opResults.push(e),this.completed=!0):e.isTextNode()&&this.opResults.push(e):this.fromNode.id==e.id&&(this.adding=!0,this.includeFromAndToInResults&&e.isTextNode()&&this.opResults.push(e)),this.completed||(t=this,e.children.every(function(e){return t._recursive_getAllTextNodes(e),!t.completed}))}},{key:"_getAllTextNodes",value:function(e,t,n){this.fromNode=e,this.toNode=t,this.includeFromAndToInResults=n,this.adding=!1,this.completed=!1,this.opResults=[];var o=this;return this.document.rootNode.children.every(function(e){return o._recursive_getAllTextNodes(e),!o.completed}),this.opResults}},{key:"_deleteNode_DNB",value:function(e){var n=[],o=this;e.children.forEach(function(e){var t=!0;e.id==o.fromNode.id?o.deleting=!0:e.id==o.toNode.id?(o.deleting=!1,o.doneDeleting=!0):o.deleting?t=!o._deleteNode_DNB(e):o.doneDeleting||o._deleteNode_DNB(e),t&&n.push(e)});return o.deleting&&0==n.length?(e.domElement.remove(),o.document.UnregisterNode(e),null!=e.previous&&(e.previous.next=e.next),null!=e.next&&(e.next.previous=e.previous),!0):(e.children=n,!1)}},{key:"_DeleteNodesBetween",value:function(e,t){this.fromNode=e,this.toNode=t,this.deleting=!1,this.doneDeleting=!1,this._deleteNode_DNB(this.document.rootNode)}}])&&w(e.prototype,t),n&&w(e,n),g}();function I(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var R=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e}var e,n,o;return e=t,(n=[{key:"GetRange",value:function(e){null==e&&(e=document.getSelection());var t=void 0;return e.rangeCount?t=e.getRangeAt(0):(t=document.createRange()).collapse(!0),t}},{key:"GetStartNode",value:function(e){var t;null==e&&(t=document.getSelection(),e=this.GetRange(t));var n=e.startContainer.parentNode;if("BODY"==n.tagName)return this.document.rootNode.GetFirstTextNode();if(null!=n){var o=n.getAttribute("cm-id");return this.document.GetNodeById(o)}}},{key:"GetEndNode",value:function(e){var t;null==e&&(t=document.getSelection(),e=this.GetRange(t));var n=e.startContainer.parentNode.getAttribute("cm-id");return this.document.GetNodeById(n)}},{key:"IsCollapsed",value:function(){return document.getSelection().isCollapsed}},{key:"GetBoundingClientRect",value:function(){var e=document.getSelection(),t=this.GetRange(e),n=t.getBoundingClientRect(),o=navigator.userAgent.toLowerCase();return-1!=o.indexOf("safari")&&(-1<o.indexOf("chrome")||(n=t.getClientRects()[0])),n}},{key:"GetCurrent",value:function(){var e,t,n,o=document.getSelection(),i=this.GetRange(o),r=i.startContainer.parentNode,s=i.startOffset,a=i.endContainer.parentNode,l=i.endOffset,u={hasFocus:!1,startNode:void 0,startOffset:0,endNode:void 0,endOffset:0};return null!=r&&null!=a&&(e=r.getAttribute("cm-id"),t=a.getAttribute("cm-id"),n=this.document.GetNodeById(e),u={hasFocus:null!=r&&null!=n?!0:!1,startNode:n,startOffset:s,endNode:this.document.GetNodeById(t),endOffset:l}),u}},{key:"SelectText",value:function(e,t,n,o){var i=window.getSelection(),r=document.createRange();r.setStart(e.domElement.firstChild,t),r.setEnd(n.domElement.firstChild,o),i.removeAllRanges(),i.addRange(r)}},{key:"_parents",value:function(e){for(var t=[e];e;e=e.parent)t.unshift(e);return t}},{key:"FindCommonNodeContainer",value:function(e,t){var n=this._parents(e),o=this._parents(t);if(n[0].id!=o[0].id)throw"No common ancestor";for(var i=0;i<n.length;i++)if(n[i].id!=o[i].id)return n[i-1]}},{key:"GetSelectedLines",value:function(){var t,n,e,o,i=this.GetCurrent(),r=[];return i.hasFocus&&(t=i.startNode,n=i.endNode,null!=t&&null==n?n=t:null==t&&null!=n&&(t=n),this.IsCollapsed()||t.parent.id==n.parent.id?r.push(t.GetBlockContainer()):t.isTextNode()&&n.isTextNode()&&(e=this.FindCommonNodeContainer(t,n),o=!1,e.children.forEach(function(e){e.Contains(t.id)?(o=!0,r.push(e)):o&&(r.push(e),e.Contains(n.id)&&(o=!1))}))),r}},{key:"GetSelectedTextNodes",value:function(){var e,t,n,o=[];return document.getSelection().isCollapsed||(t=(e=this.GetCurrent()).startNode,e.startOffset,n=e.endNode,e.endOffset,(o=F.GetAllTextNodes(this.document,t,n,!1)).unshift(t),n.id!=t.id&&o.push(n)),o}},{key:"_extractSelection",value:function(e,t,n){var o=e.Split(t,n);return 1==o.length?e:(F.ReplaceNode(this.document,e,o),2==o.length&&0==t?o[0]:o[1])}},{key:"IsolateAndReturnSelectedTextNodes",value:function(){var t=[];if(!document.getSelection().isCollapsed){var e,n,o,i,r=this.GetCurrent(),s=r.startNode,a=r.startOffset,l=r.endNode,u=r.endOffset;if(!s.isTextNode()||!l.isTextNode())return void console.log("#84-22");s.id==l.id?(e=this._extractSelection(s,a,u),t.push(e)):(n=F.GetAllTextNodes(this.document,s,l,!1),o=this._extractSelection(s,a,s.text.length),t.push(o),n.forEach(function(e){t.push(e)}),i=this._extractSelection(l,0,u),t.push(i))}return t}},{key:"_getNextTextNode",value:function(e){return null==e.next?this._getNextTextNode(e.parent):e.next.isTextNode()?e.next:this._getNextTextNode(e.next.parent)}},{key:"VerifyCursorPosition",value:function(){}}])&&I(e.prototype,n),o&&I(e,o),t}();function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(r){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,o,i=B(r);return t=s?(e=B(this).constructor,Reflect.construct(i,arguments,e)):i.apply(this,arguments),n=this,!(o=t)||"object"!==D(o)&&"function"!=typeof o?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(n):o}}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var H=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(u,b);var e,t,n,l=M(u);function u(e,t,n,o){var i,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[],s=5<arguments.length&&void 0!==arguments[5]&&arguments[5],a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(i=l.call(this,e,t,n,T.BLOCK,o)).attributes=r,i.hasTextContent=s,i.textContent=a,i.GenerateDomElement(),i.firstTextNode=void 0,i.lastTextNode=void 0,i}return e=u,n=[{key:"CreateNew",value:function(e,t,n,o,i,r){var s=4<arguments.length&&void 0!==i&&i,a=5<arguments.length&&void 0!==r?r:"",l=new u(e,e.GenereateNewNodeId(),t,n,o,s,a);return e.RegisterNode(l),l}}],(t=[{key:"Copy",value:function(){var t=new u(this.document,this.document.GenereateNewNodeId(),this.tagName,this.nodeStyle.Copy(),this.attributes,this.hasTextContent,this.textContent);return t.firstTextNode=this.firstTextNode,t.lastTextNode=this.lastTextNode,t.GenerateDomElement(),this.children.forEach(function(e){t.Append(e.Copy())}),t}},{key:"UpdateTextContent",value:function(e){this.hasTextContent=!0,this.textContent=e,this.domElement.setAttribute("cm-has-text-content",!0),this.domElement.textContent=this.textContent}},{key:"GenerateDomElement",value:function(){this.domElement=void 0;var t=document.createElement(this.tagName);t.setAttribute("cm-id",this.id),t.setAttribute("cm-type",this.type),this.attributes.forEach(function(e){""!=e.name&&t.setAttribute(e.name,e.value)}),this.domElement=t,this.hasTextContent&&(t.setAttribute("cm-has-text-content",!0),this.domElement.textContent=this.textContent),null!=this.nodeStyle&&this.nodeStyle.Apply(this.domElement)}},{key:"ChangeTagName",value:function(e){this.tagName=e;var t=document.createElement(this.tagName);t.setAttribute("cm-id",this.id),t.setAttribute("cm-type",this.type),this.attributes.forEach(function(e){""!=e.name&&t.setAttribute(e.name,e.value)}),this.children.forEach(function(e){t.appendChild(e.domElement)}),this.hasTextContent&&(t.setAttribute("cm-has-text-content",!0),this.domElement.textContent=this.textContent),null!=this.nodeStyle&&this.nodeStyle.Apply(t),this.domElement.parentNode.replaceChild(t,this.domElement),this.domElement=t}},{key:"SetAttributes",value:function(e,t){var n,o=1<arguments.length&&void 0!==t&&t;this.attributes=e,o||(n=this).attributes.forEach(function(e){""!=e.name&&n.domElement.setAttribute(e.name,e.value)})}},{key:"AppendAfter",value:function(t,e){var n=0,o=0;return this.children.forEach(function(e){o++,e.id==t.id&&(n=o)}),this.Append(e,n)}},{key:"Append",value:function(o,i){var e,t,n,r,s,a,l,u,c,d,h,f,p;o.parent=this,null!=i&&i>=this.children.length&&(i=void 0),null==i?o.isInlineNode()?(t=void 0,null!=this.document.GetStyleAtCurrentCursorPosition()&&(t=(e=new E(this.document,this.document.GetStyleAtCurrentCursorPosition().nodeStyle)).isEmpty()?this.document.GetDefaultNodeStyle().Copy():e.Copy()),n=void 0,0<this.children.length&&(n=this.children[this.children.length-1]),null!=n&&n.isTextNode()||((r=_.CreateNew(this.document,"span","",t)).parent=this,r.next=o,null!=n&&(n.next=r),r.previous=n,n=r,this.children.push(r),this.domElement.appendChild(r.domElement)),(n.next=o).previous=n,(o.parent=this).children.push(o),this.domElement.appendChild(o.domElement),(s=_.CreateNew(this.document,"span","",t)).parent=this,(s.previous=o).next=s,this.children.push(s),this.domElement.appendChild(s.domElement)):(0<(o.parent=this).children.length&&(((a=this.children[this.children.length-1]).next=o).previous=a),this.children.push(o),this.domElement.appendChild(o.domElement)):(l=void 0,u=[],d=void(c=0),null!=this.document.GetStyleAtCurrentCursorPosition()&&(d=new E(this.document,this.document.GetStyleAtCurrentCursorPosition().nodeStyle)),f=[],p=void 0,(h=this).children.forEach(function(e){var t,n;i==c&&(p=l,!o.isInlineNode()||null!=l&&l.isTextNode()||((t=_.CreateNew(h.document,"span","",d.Copy())).parent=h,null!=l&&(l.next=t),t.previous=l,l=t,u.push(t),f.push(t)),null!=(o.previous=l)&&(l.next=o),u.push(o),l=o,f.push(o),o.isInlineNode()&&!e.isTextNode()&&((n=_.CreateNew(h.document,"span","",d.Copy())).parent=h,(l.next=n).previous=l,(n.next=e).previous=n,u.push(n),l=n,f.push(n))),null!=(e.previous=l)&&(l.next=e),u.push(e),l=e,c++}),this.children=u,null!=p?f.forEach(function(e){p.domElement.parentNode.insertBefore(e.domElement,p.domElement.nextSibling),p=e}):null==o.next?this.domElement.appendChild(o.domElement):this.domElement.insertBefore(o.domElement,o.next.domElement))}},{key:"InsertTextNodeAtCursor",value:function(e){if(e.isTextNode()){var t=new R(this.document).GetCurrent();if(!t.hasFocus)return;var n=t.startNode,o=t.startOffset,i=t.endNode,r=t.endOffset;if(!n.isTextNode()||!i.isTextNode())return void console.log("#10-22");var s,a,l,u=n.GetBlockContainer(),c=i.GetBlockContainer();u.id!=c.id&&console.log("#10-33"),n.id==i.id&&(1==(a=(s=n).Split(o,r)).length?this.Append(e,0):(2==a.length?0==o?a.unshift(e):a.push(e):((l=[]).push(a[0]),l.push(e),l.push(a[2]),a=l),F.ReplaceNode(this.document,s,a)))}}},{key:"_parseIsEmpty",value:function(e){var t=this,n=!0;return e.children.forEach(function(e){n&&(e.isTextNode()?""==e.text||(n=!1):n=!e.isInlineNode()&&t._parseIsEmpty(e))}),n}},{key:"isEmpty",value:function(){return this._parseIsEmpty(this)}},{key:"_parseGetFirstTextNode",value:function(e){var t=this;return e.children.every(function(e){return e.isTextNode()&&null==t.firstTextNode?(t.firstTextNode=e,!1):t._parseGetFirstTextNode(e)}),!0}},{key:"SelectWholeTextContent",value:function(){var e=this.GetFirstTextNode(),t=this.GetLastTextNode();this.document.selectionManager.SelectText(e,0,t,t.text.length)}},{key:"GetFirstTextNode",value:function(){return this.firstTextNode=void 0,this._parseGetFirstTextNode(this),this.firstTextNode}},{key:"_parseGetLastTextNode",value:function(e){var t=this;return e.children.every(function(e){return e.isTextNode()?void(t.lastTextNode=e):t._parseGetLastTextNode(e)}),!0}},{key:"GetLastTextNode",value:function(){return this.lastTextNode=void 0,this._parseGetLastTextNode(this),this.lastTextNode}},{key:"_parseDeleteButReturnTextNodes",value:function(e){var t=this;e.children.every(function(e){return e.isTextNode()?(t.tmpAllTextNodes.push(e),!1):t._parseDeleteButReturnTextNodes(e)}),e.Delete()}},{key:"DeleteButReturnTextNodes",value:function(){return this.tmpAllTextNodes=[],this._parseDeleteButReturnTextNodes(this),this.tmpAllTextNodes}},{key:"Delete",value:function(){this.document.DeleteNode(this)}},{key:"InsertEmptyBlockNodeBefore",value:function(e){return this._InsertEmptyLine("before",e)}},{key:"InsertEmptyBlockNodeAfter",value:function(e){return this._InsertEmptyLine("after",e)}},{key:"_InsertEmptyLine",value:function(t,e){var n=this;null==e&&(e="div");var o=this.parent,i=u.CreateNew(this.document,e),r=o.children;return o.children=[],r.forEach(function(e){"before"==t?(e.id==n.id&&o.Append(i),o.Append(e)):"after"==t&&(o.Append(e),e.id==n.id&&o.Append(i))}),i}},{key:"Merge",value:function(t,e){var n,o=this,i=void 0,r=void 0;null==o.children||0<=(n=o.children.length-1)&&(r=o.children[n]),t.children.forEach(function(e){"text"==e.type?(o.Append(e),null==i&&(i=e)):e.DeleteButReturnTextNodes().forEach(function(e){o.Append(e)})}),t.domElement.remove(),this.document.UnregisterNode(t),o.next=t.next,null!=o.next&&(o.next.previous=o);var s=[];return o.parent.children.forEach(function(e){e.id!=t.id&&s.push(e)}),o.parent.children=s,e?i:r}}])&&L(e.prototype,t),n&&L(e,n),u}();function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(r){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,o,i=Y(r);return t=s?(e=Y(this).constructor,Reflect.construct(i,arguments,e)):i.apply(this,arguments),n=this,!(o=t)||"object"!==j(o)&&"function"!=typeof o?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(n):o}}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var z=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(l,b);var e,t,n,a=K(l);function l(e,t,n,o,i){var r,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:[];return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(r=a.call(this,e,t,n,T.INLINE,i)).attributes=s,null==o&&(o=""),r.text=o,r.GenerateDomElement(),r}return e=l,n=[{key:"CreateNew",value:function(e,t,n,o,i){var r=new l(e,e.GenereateNewNodeId(),t,n,o,i);return e.RegisterNode(r),r}}],(t=[{key:"Copy",value:function(){var t=new l(this.document,this.document.GenereateNewNodeId(),this.tagName,this.text,this.nodeStyle.Copy(),this.attributes);return this.GenerateDomElement(),this.children.forEach(function(e){t.Append(e.Copy())}),t}},{key:"GenerateDomElement",value:function(){this.domElement=void 0;var t=document.createElement(this.tagName);t.setAttribute("cm-id",this.id),t.setAttribute("cm-type",this.type),this.attributes.forEach(function(e){""!=e.name&&t.setAttribute(e.name,e.value)}),""!=this.text&&t.appendChild(document.createTextNode(this.text)),this.domElement=t,null!=this.nodeStyle&&this.nodeStyle.Apply(this.domElement)}},{key:"Append",value:function(o,i){if(o.isBlockNode())throw"Inline nodes cannot contain block nodes";var e,t,n,r,s,a,l,u;null==i&&(i=this.children.length),0==this.children.length||this.children.length==i?o.isInlineNode()?(e=void 0,0<this.children.length&&(e=this.children[this.children.length-1]),null!=e&&e.isTextNode()||((t=TextNode.CreateNew(this.document,"span","",this.nodeStyle.Copy())).parent=this,t.next=o,null!=e&&(e.next=t),t.previous=e,e=t,this.children.push(t),this.domElement.appendChild(t.domElement)),o.previous=e,(o.parent=this).children.push(o),this.domElement.appendChild(o.domElement),(n=TextNode.CreateNew(this.document,"span","",this.nodeStyle.Copy())).parent=this,(n.previous=o).next=n,this.children.push(n),this.domElement.appendChild(n.domElement)):((o.parent=this).children.push(o),this.domElement.appendChild(o.domElement)):(r=void 0,a=0,l=!(s=[]),this.children.forEach(function(e){var t,n;r=i==a?(!o.isInlineNode()||null!=r&&r.isTextNode()||((t=TextNode.CreateNew(this.document,"span","",this.nodeStyle.Copy())).parent=this,null!=r&&(r.next=t),t.previous=r,r=t,s.push(t)),null!=(o.previous=r)&&(r.next=o),l=!0,o.parent=this,s.push(o),o):(l&&(l=!1,o.isInlineNode()&&!e.isTextNode()?((n=TextNode.CreateNew(this.document,"span","",this.nodeStyle.Copy())).parent=this,(r.next=n).previous=r,(n.next=e).previous=n,s.push(n)):(e.previous=o).next=e),e),s.push(e),a++}),l&&o.isInlineNode()&&((u=TextNode.CreateNew(this.document,"span","",this.nodeStyle.Copy())).parent=this,(r.next=u).previous=r,u.next=void 0,s.push(u)),this.children=s,null==o.next?this.domElement.appendChild(o.domElement):this.domElement.insertBefore(o.domElement,o.next.domElement))}},{key:"Delete",value:function(){this.domElement.remove(),this.document.UnregisterNode(this)}}])&&U(e.prototype,t),n&&U(e,n),l}();function J(e){return function(e){if(Array.isArray(e))return X(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return X(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function V(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Z=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e,this.selectionManager=new R(this.document)}var e,n,o;return e=t,(n=[{key:"GetStyleAtCurrentCursorPosition",value:function(){var e=this.selectionManager.GetCurrent();if(!e.hasFocus)return{};var t=e.startNode;if(null==t)return{};var n=this._getFirstParentBlockNode(t);return{nodeStyle:t.nodeStyle.styles,lineStyle:n.nodeStyle.styles,plugin:void 0}}},{key:"ToggleStyleOnLine",value:function(t,n){var e,o,i,r,s,a,l,u,c=this.selectionManager.GetCurrent();c.hasFocus&&(e=c.startNode,o=c.startOffset,i=c.endNode,r=c.endOffset,e.isTextNode()&&i.isTextNode()?e.id==i.id?(this._getFirstParentBlockNode(e).ToggleStyle(t,n,!0),e.SelectText(o,r)):(s=this._getFirstParentBlockNode(e),a=this._getFirstParentBlockNode(i),s.id==a.id?(s.ToggleStyle(t,n,!0),this.selectionManager.SelectText(e,o,i,r)):(l=s.parent).id==a.parent.id?(u=!1,l.children.forEach(function(e){e.id==s.id&&(u=!0),u&&(e.ToggleStyle(t,n,!0),e.id==a.id&&(u=!1))})):console.log("#10-03")):console.log("#10-02"))}},{key:"_getFirstParentBlockNode",value:function(e){var t=e.parent;return t.isBlockNode()||(t=this._getFirstParentBlockNode(t)),t}},{key:"ToggleStyleOnSelection",value:function(t,n){var e=this.selectionManager.GetCurrent();if(e.hasFocus){var o,i,r,s,a,l,u,c=e.startNode,d=e.startOffset,h=e.endNode,f=e.endOffset;if(!c.isTextNode()||!h.isTextNode())if(console.log("Possible #10-01",c,h),c.isTextNode()&&!h.isTextNode())f=(h=c).text.length;else{if(c.isTextNode()||!h.isTextNode())return void console.log("#10-01");c=h,d=0}c.id==h.id?this._toggleStyleOnNode(c,d,f,t,n).SelectText(0,f-d):(o=F.GetAllTextNodes(this.document,c,h,!1),i=!1,r=[],c.IsStyleApplied(t)?r.push(!0):r.push(!1),o.forEach(function(e){e.IsStyleApplied(t)?r.push(!0):r.push(!1)}),h.IsStyleApplied(t)?r.push(!0):r.push(!1),1<(r=J(new Set(r))).length&&(i=!0),i?((s=c).IsStyleApplied(t)||(s=this._toggleStyleOnNode(c,d,c.text.length,t,n)),o.forEach(function(e){e.IsStyleApplied(t)||e.ToggleStyle(t,n,!0)}),(a=h).IsStyleApplied(t)||this._toggleStyleOnNode(h,0,f,t,n),this.selectionManager.SelectText(s,0,a,f)):(l=this._toggleStyleOnNode(c,d,c.text.length,t,n),o.forEach(function(e){e.ToggleStyle(t,n,!0)}),u=this._toggleStyleOnNode(h,0,f,t,n),this.selectionManager.SelectText(l,0,u,f)))}}},{key:"_toggleStyleOnNode",value:function(e,t,n,o,i){var r=e.Split(t,n);if(1==r.length)return e.ToggleStyle(o,i,!0),e;var s=void 0;return(s=0==t?r[0]:r[1]).ToggleStyle(o,i,!1),F.ReplaceNode(this.document,e,r),s}}])&&V(e.prototype,n),o&&V(e,o),t}();function q(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var $=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e,this.selectionManager=new R(this.document)}var e,n,o;return e=t,(n=[{key:"Insert",value:function(){if(this.selectionManager.IsCollapsed()||this.document.DeleteSelection(),this.selectionManager.IsCollapsed()){var e=this.selectionManager.GetCurrent();if(!e.hasFocus)return{};var t,n,o,i,r,s,a,l,u,c,d,h=e.startNode,f=e.startOffset,p=e.endOffset;null!=h&&h.isTextNode()?(t=h.parent).isBlockNode()?(o=!(n=[]),i=[],s=r=void 0,t.children.forEach(function(e){e.id==h.id?o=!0:o?n.push(e):(i.push(e),(r=e).isTextNode()&&(s=e.nodeStyle))}),a=h.Split(f,p),l=!0,u=[],a.forEach(function(e){""==e.text?l=!1:l?u.push(e):n.unshift(e)}),0<u.length||0<i.length?(F.ReplaceNode(this.document,h,u,!0),this.InsertNewRootLine("after",h.parent,!0,h.parent.nodeStyle,h.nodeStyle,n)):(c=void 0,null!=h.parent&&(c=h.parent.nodeStyle),this.InsertNewRootLine("before",h.parent,!1,c,h.nodeStyle,u)),null!=r&&r.isInlineNode()&&(d=_.CreateNew(this.document,"span","",s),t.Append(d))):console.log("#20-03"):console.log("#20-02")}else console.log("Selection not collapsed"),console.log("#20-01");return!0}},{key:"InsertNewRootLine",value:function(e,t,n,o,i,r){var s,a,l,u,c,d,h,f=t.parent;null!=f&&(a=s=0,f.children.forEach(function(e){e.id==t.id&&(s=a),a++}),null==o&&(o=new E(this.document)),(l=H.CreateNew(this.document,t.tagName,o.Copy(),t.attributes)).parent=f,"before"==e?(l.previous=t.previous,null!=t.previous&&(t.previous.next=l),(l.next=t).previous=l):(s+=1,l.previous=t,l.next=t.next,null!=t.next&&(t.next.previous=l),t.next=l),u=void 0,0==r.length?(c=_.CreateNew(this.document,"span","",i.Copy()),l.Append(c),u=c):(d=this.document,h=void 0,r.forEach(function(e){""==e.id&&(e.id=d.GenereateNewNodeId(),e.GenerateDomElement(),d.RegisterNode(e));var t=!0;e.isTextNode()&&(null!=h?h.HasSameStyle(e)&&h.HasSameAttributes(e)?(t=!1,h.AppendTextContent(e.text),h.next=e.next,d.UnregisterNode(e),e.domElement.parentNode.removeChild(e.domElement)):h=e:(e.previous=void 0,h=e)),t&&(l.Append(e),null==u&&(e.isTextNode()?u=e:e.isInlineNode()&&(u=e.previous)))})),f.domElement.insertBefore(l.domElement,f.domElement.children[s]),f.children.splice(s,0,l),"after"==e&&n&&u.SetFocus())}}])&&q(e.prototype,n),o&&q(e,o),t}(),Q={DELETE:"delete",DELETE_TOP:"deleteTop",DELETE_FROM_BOTTOM:"deleteFromBottom",CANCEL_FROM_TOP:"cancelFromTop",CANCEL_FROM_BOTTOM:"cancelFromBottom",ENTER:"enter",APPLY_STYLE_ON_LINE:"applyStyleOnLine",APPLY_STYLE_ON_TEXT:"applyStyleOnText",CLICK:"click",DELETE_BEFORE_INLINE:"DELETE_BEFORE_INLINE",CANCEL_BEFORE_INLINE:"CANCEL_BEFORE_INLINE",NODE_UNREGISTERED:"NODE_UNREGISTERED",TAB:"TAB",NEW_CHAR_ADDED:"newCharAdded",ARROW_UP:"arrowUp",ARROW_DOWN:"arrowDown",ARROW_LEFT:"arrowLeft",ARROW_RIGHT:"arrowRight",SHIFT_ARROW_UP:"shiftArrowUp",SHIFT_ARROW_DOWN:"shiftArrowDown",SHIFT_ARROW_LEFT:"shiftArrowLeft",SHIFT_ARROW_RIGHT:"shiftArrowRight",SHIFT_DOWN:"SHIFT_DOWN",SHIFT_UP:"SHIFT_UP",SELECT_ALL:"SELECT_ALL",BEFORE_COPY:"BEFORE_COPY",BEFORE_CUT:"BEFORE_CUT",BEFORE_PASTE:"BEFORE_PASTE",LOST_FOCUS:"LOST_FOCUS",ESC:"esc"};function ee(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var te=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e,this.selectionManager=new R(this.document)}var e,n,o;return e=t,(n=[{key:"DeleteNode",value:function(e){return F.ReplaceNode(this.document,e,[],!1)}},{key:"DeleteSelection",value:function(){var n,e,t,o,i,r=!1,s=this.selectionManager.GetCurrent(),a=s.startNode,l=s.startOffset,u=s.endNode,c=s.endOffset;return null!=a&&null!=u||(a=this.document.rootNode.GetFirstTextNode(),u=this.document.rootNode.GetLastTextNode(),c=u.text.length),u.isBlockNode()&&(n=!1,u.children.forEach(function(e){var t;e.id==a.id&&(n=!0),!n||null!=(t=e.domElement.getAttribute("contenteditable"))&&"false"==t&&(u=e.next,c=0)})),a.isTextNode()&&!u.isTextNode()?c=(u=a).text.length:!a.isTextNode()&&u.isTextNode()&&(a=u,l=0),a.isTextNode()&&u.isTextNode()?a.id==u.id?(a.DeleteText(l,c),r=!0,(e=this.selectionManager.GetRange()).deleteContents(),e.collapse(!0),(t=document.getSelection()).removeAllRanges(),t.addRange(e),""==a.text&&(null==a.previous&&null==a.next&&(a.SetZeroWidthChar(),a.SetFocus()),r=!0)):(F.DeleteNodesBetween(this.document,a,u),a.TrimTextContent(0,l),u.TrimTextContent(c),a.parent.id==u.parent.id?((a.next=u).previous=a,this._adjustAndSetFocus(a,u,l)):(o=a.parent,i=u.parent,o.parent.id==i.parent.id?(i.children.forEach(function(e){o.Append(e)}),i.children=[],this.DeleteNode(i),this._adjustAndSetFocus(a,u,l)):u.SetFocus()),r=!0):console.log("#30-01-01"),r}},{key:"Delete",value:function(){var e=!1;if(this.selectionManager.IsCollapsed()){var t=this.selectionManager.GetCurrent();if(!t.hasFocus)return!0;var n,o,i,r,s,a,l,u,c=t.startNode,d=t.startOffset;t.endOffset;if(!c.parent.isBlockNode())return console.log("#30-01"),!0;null!=c&&c.isTextNode()?(n=!1,d!=c.text.length&&""!=c.text||(n=!0),c.RemoveCharAt(d),d<c.text.length?e=!1:null==c.next?""==c.text?e=(null==c.parent.next?null!=c.previous&&c.previous.isTextNode()?(o=c.previous,this.DeleteNode(c),o.SetCarretAtTheEnd()):(c.SetZeroWidthChar(),c.SetFocus()):n?(i=!0,null!=c.parent.next.GetPluginType()&&(i=!(i=this.document.NotifyPlugin(Q.CANCEL_FROM_TOP,c.parent.next))),i&&(this.DeleteNode(c),c.parent.next.isBlockNode()?null!=(r=c.parent.next.GetFirstTextNode())&&r.SetFocus():console.log("#72-28"))):(c.SetZeroWidthChar(),c.SetFocus()),!0):n?(null!=c.parent.next?(s=!0,null!=c.parent.next&&null!=c.parent.next.GetPluginType()&&(s=!(s=this.document.NotifyPlugin(Q.CANCEL_FROM_TOP,c.parent.next))),!s||null!=(a=c.parent.Merge(c.parent.next,!0))&&a.SetFocus()):this.document.NotifyPlugin(Q.CANCEL_FROM_BOTTOM,c),e=!0):""==c.text&&(c.SetZeroWidthChar(),c.SetFocus(),e=!0):(l=c.next).isInlineNode()?n?(this.document.NotifyPlugin(Q.CANCEL_BEFORE_INLINE,l)||(u=l.next,this.DeleteNode(l),this.DeleteNode(c),null!=u&&u.SetFocus()),e=!0):""==c.text&&(c.SetZeroWidthChar(),c.SetFocus(),e=!0):l.isTextNode()&&(n?(l.RemoveCharAt(0,!0),e=(""==l.text?(this.DeleteNode(l),c.SetCarretAtTheEnd()):l.SetFocus(),!0)):""==c.text&&(this.DeleteNode(c),l.SetFocus(),e=!0))):e=!0}else e=this.DeleteSelection();return e}},{key:"Backspace",value:function(){var e=!1;if(this.selectionManager.IsCollapsed()){var t=this.selectionManager.GetCurrent();if(!t.hasFocus)return!0;var n,o,i,r,s,a,l,u,c,d,h,f,p=t.startNode,y=t.startOffset;t.endOffset;if(!p.parent.isBlockNode())return console.log("#30-23"),!0;null!=p&&p.isTextNode()?(n=!1,""==p.text&&(n=!0),(o=y-1)<0?(e=!0,i=p.previous,""==p.text?null!=i?i.isTextNode()?(this.DeleteNode(p),i.SetCarretAtTheEnd(),console.log("I DONT UNDERSTAND THIS (see next line)"),e=!0):i.isInlineNode()&&(r=i.previous,this.DeleteNode(i),this.DeleteNode(p),null!=r&&r.SetCarretAtTheEnd(),e=!0):e=(null!=p.parent.previous?(this.DeleteNode(p),null!=(s=p.parent.previous.Merge(p.parent,!1))&&s.SetCarretAtTheEnd()):null==p.parent.parent.parent||(this.document.IsNodeInsidePlugin(p)?this.document.NotifyPlugin(Q.DELETE_TOP,p):this._consolidateCommaNodes(p)),!0):null!=i?i.isTextNode()?(null!=i&&i.SetCarretAtTheEnd(),console.log("WHY AM I HERE?!?",i)):i.isInlineNode()&&(this.document.NotifyPlugin(Q.DELETE_BEFORE_INLINE,i)||(a=i.previous,this.DeleteNode(i),null!=a&&a.SetCarretAtTheEnd()),e=!0):e=(null!=p.parent.previous?(l=!0,null!=p.parent.previous.GetPluginType()&&(l=!(l=this.document.NotifyPlugin(Q.DELETE_FROM_BOTTOM,p.parent.previous))),!l||null!=(u=p.parent.previous.Merge(p.parent,!1))&&u.SetCarretAtTheEnd()):null==p.parent.parent.parent||this.document.NotifyPlugin(Q.DELETE_TOP,p),!0)):(p.RemoveCharAt(o),e=""==p.text&&(null==(c=p.previous)?n?null!=p.parent.previous?(d=!0,null!=p.parent.previous.GetPluginType()&&(d=!(d=this.document.NotifyPlugin(Q.DELETE_FROM_BOTTOM,p.parent.previous))),d&&(this.DeleteNode(p),null!=(h=p.parent.previous.Merge(p.parent,!1))&&h.SetCarretAtTheEnd())):null==p.parent.parent.parent||(this.document.IsNodeInsidePlugin(p)?this.document.NotifyPlugin(Q.DELETE_TOP,p):this._consolidateCommaNodes(p)):null!=p.next&&p.next.isTextNode()?(this.DeleteNode(p),p.next.SetFocus()):(p.SetZeroWidthChar(),p.SetFocus()):c.isInlineNode()?n?this.document.NotifyPlugin(Q.DELETE_BEFORE_INLINE,p.previous)||(f=c.previous,this.DeleteNode(c),this.DeleteNode(p),null!=f&&f.SetCarretAtTheEnd()):(p.SetZeroWidthChar(),p.SetFocus(),e=!0):(this.DeleteNode(p),c.SetCarretAtTheEnd()),!0))):e=!0}else e=this.DeleteSelection();return e}},{key:"_adjustAndSetFocus",value:function(e,t,n){var o,i;""==e.text&&""==t.text?null!=e.previous?(this.DeleteNode(e),this.DeleteNode(t),e.previous.isTextNode()?e.previous.SetCarretAtTheEnd():e.previous.isInlineNode()&&(null!=(o=e.previous).next&&o.next.isTextNode()?o.next.isTextNode()&&o.next.SetFocus():(i=_.CreateNew(o.document,"span","",e.nodeStyle.Copy()),o.parent.AppendAfter(o,i),i.SetFocus()))):null!=t.next?(this.DeleteNode(e),this.DeleteNode(t),t.next.SetFocus()):(this.DeleteNode(t),e.SetFocus()):""==e.text?(this.DeleteNode(e),t.SetFocus()):""==t.text?(this.DeleteNode(t),e.SetCarretAtTheEnd()):e.nodeStyle.Equals(t.nodeStyle)?(e.Merge(t),e.SetFocus(n)):t.SetFocus()}},{key:"_consolidateCommaNodes",value:function(e){var t=this._removeSubBlock(this.document.rootNode,e);0==this.document.rootNode.children.length&&this.document.InitEmptyDoc(),null!=t&&t.SetFocus()}},{key:"_removeSubBlock",value:function(e,n){var o=this,i=void 0,r=!0;return e.children.forEach(function(e){var t;e.Contains(n.id)&&(r=!1,e.isEmpty()?o.document.DeleteNode(e):null!=(t=o._removeSubBlock(e,n))&&(i=t)),r&&(i=e.GetLastTextNode())}),i}}])&&ee(e.prototype,n),o&&ee(e,o),t}();function ne(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var oe=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.rtf=e,this.pictures={},this.counter=0,this.allPictures=[],this.indexNextToGet=0}var e,n,o;return e=t,(n=[{key:"GetAll",value:function(){return this.allPictures}},{key:"GetNextPicture",value:function(){var e=this.allPictures[this.indexNextToGet];return this.indexNextToGet++,e}},{key:"ResetGetNext",value:function(){this.indexNextToGet=0}},{key:"ParseRtf",value:function(){var e=this.rtf;this.ExtractNextPicture(e),this.allPictures=Object.values(this.pictures)}},{key:"ExtractNextPicture",value:function(e){var t=e.indexOf("{\\pict");if(!(-1<t))return!1;var n=this.GetPic(e,t);!1!==n&&this.ExtractNextPicture(n)}},{key:"GetPicId",value:function(e){var t=e.indexOf("\\blipuid"),n=e.substring(t).replace("\\blipuid",""),o="";for(var i in n){var r=n[i];if("}"==r)break;o+=r}return o.trim()}},{key:"GetMimeType",value:function(e){var t="";return-1<e.indexOf("jpegblip")?t="image/jpeg":-1<e.indexOf("emfblip")?t="emf":-1<e.indexOf("pngblip")?t="image/png":-1<e.indexOf("macpict")&&(t="pict"),t}},{key:"GetContent",value:function(e){for(var t=e.replace(/({?.*})/gi,"").replace(/[\W_]+/g,""),n="",o=0;o<t.length;o+=2)n+=String.fromCharCode(parseInt(t.substr(o,2),16));return btoa(n)}},{key:"AnalizePicChunk",value:function(e){var t,n=this.GetPicId(e);null==this.pictures[n]&&((t={}).id=n,t.positionInDocument=this.counter,this.counter++,t.mimeType=this.GetMimeType(e),t.content=this.GetContent(e),t.srcReady="data:"+t.mimeType+";base64,"+t.content,this.pictures[n]=t)}},{key:"GetPic",value:function(e,t){for(var n=t,o=!1,i=0,r="",s=t;n<e.length;){var a=e[n];"{"==a&&i++,"}"==a&&i--,0<i&&!o&&(r+=a,s=n),0==i&&(o=!0),n++}return this.AnalizePicChunk(r),e.substring(s)}}])&&ne(e.prototype,n),o&&ne(e,o),t}();function ie(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var re=["address","article","blockquote","br","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","iframe","li","main","nav","output","p","pre","section","td","tr","video"],se=["b","i","u"],ae=["table","ul","ol","img","a"],le=function(){function i(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.document=e,this.pastedDocument=t,this.pluginsManager=e.pluginsManager,this.rtf=n,this.fromRtf=!1,null!=this.rtf&&""!=this.rtf&&(this.rtfPictures=new oe(n),this.rtfPictures.ParseRtf(),this.fromRtf=!0),this.pastedDocumentInBrowser=void 0;var o=document.createElement("div");o.style.display="none",o.appendChild(t.documentElement),document.body.appendChild(o),this.pastedDocumentInBrowser=o,this.newNodes=[],this.currentLine=void 0,this.Parse(),o.parentElement.removeChild(o)}var e,t,n;return e=i,(t=[{key:"ExtactAttributes",value:function(e){var t=[];if(e.hasAttributes())for(var n=e.attributes,o=n.length-1;0<=o;o--){var i=n[o].name,r=n[o].value;"style"!=i.toLowerCase()&&"cm-id"!=i.toLowerCase()&&"cm-type"!=i.toLowerCase()&&"cm-plugin"!=i.toLowerCase()&&t.push({name:i,value:r})}return t}},{key:"isBlock",value:function(e){return!(re.indexOf(e.toLowerCase())<0)}},{key:"isTagWithSpecialNeeds",value:function(e){return!(ae.indexOf(e.toLowerCase())<0)}},{key:"isFormattingTag",value:function(e){return!(se.indexOf(e.toLowerCase())<0)}},{key:"GenerateNewTextNode",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:void 0;return null==n&&(n=this.document.GetDefaultNodeStyle().Copy()),_.CreateNew(this.document,"span",e,n)}},{key:"GenerateNewBlockLine",value:function(){var e=H.CreateNew(this.document,"div"),t=_.CreateNew(this.document,"span","",this.document.GetDefaultNodeStyle().Copy());return e.Append(t),e}},{key:"ParseNode",value:function(e){var t,n,o,i,r,s,a,l,u=this,c=void 0;return e.nodeType===e.TEXT_NODE?"O:P"===e.parentNode.tagName||(t=e.textContent,console.log(t),""!=t.trim()&&(n=E.CalculateStylesForExternalHTML(this.document,e.parentNode),c=this.GenerateNewTextNode(t.replace(/\n|\r/g," "),n))):e.nodeType===e.ELEMENT_NODE&&("O:P"==e.tagName?c=this.GenerateNewBlockLine():(o=e.tagName.toLowerCase(),i=this.ExtactAttributes(e),r=void 0,"body"==o?o="div":r=E.CalculateStylesForExternalHTML(this.document,e),this.isBlock(o)?"br"==o.toLowerCase()||(c=H.CreateNew(this.document,o,r,i),e.childNodes.forEach(function(e){var t=u.ParseNode(e);null!=t&&(null!=t.length&&0<t.length?t.forEach(function(e){null!=e.length?e.forEach(function(e){}):c.Append(e)}):c.Append(t))})):this.isTagWithSpecialNeeds(o)?("img"==o.toLowerCase()&&this.fromRtf&&(s=this.rtfPictures.GetNextPicture(),e.src=s.srcReady),c=this.pluginsManager.PasteContentToPlugin(e.tagName.toLowerCase(),e)):1<e.childNodes.length?(c=[],e.childNodes.forEach(function(e){var t=u.ParseNode(e);null!=t&&c.push(t)})):(this.isFormattingTag(o)&&(o="span"),a=E.CalculateStylesForExternalHTML(this.document,e),c=_.CreateNew(this.document,o,e.textContent.replace("\n"," ").replace(/[\u200B-\u200D\uFEFF]/g,""),a),"b"==o?c.ToggleStyle("bold","",!0,!0):"i"==o?c.ToggleStyle("italic","",!0,!0):"u"==o&&c.ToggleStyle("underlined","",!0,!0),l=[c],e.childNodes.forEach(function(e){var t;e.nodeType===e.TEXT_NODE||null!=(t=u.ParseNode(e))&&l.push(t)}),1<l.length&&(c=l)))),c}},{key:"Parse",value:function(){var e,t=this,n=this.pastedDocumentInBrowser.firstChild.getElementsByTagName("body")[0];null!=n&&(null!=(e=this.ParseNode(n))&&(null!=e.length&&0<e.length?e.forEach(function(e){t.newNodes.push(e)}):this.newNodes.push(e)),0<this.newNodes.length&&this._pasteInPlace(this.newNodes))}},{key:"_pasteInPlace",value:function(e){var u=void 0,t=this.document.selectionManager.GetCurrent(),c=t.startOffset,n=t.startNode,d=n.parent,o=[],i=[],r=!0;d.children.forEach(function(e){e.id==n.id?(u=e,r=!1):r?o.push(e):i.push(e)}),d.children=o;var s=n.text.substring(0,c),a=n.text.substring(c,n.text.length);n.ForceTextContent(s);var l,h=n,f=c,p=!1;e.forEach(function(e){var t,n,o,i,r,s,a,l=!0;e.isTextNode()?h.isTextNode()&&h.nodeStyle.Equals(e.nodeStyle)&&(e.parent=h.parent,h.Merge(e,c),u=h,l=!1,c+=e.text.length,f=c,p=!1):e.isBlockNode()&&(l=!1,p||d.Append(h),p=!0,t=d.parent,i=[],r=[],s=!(o=n=0),t.children.forEach(function(e){s?i.push(e):r.push(e),e.id==d.id&&(n=o,s=!1),o++}),n+=1,t.children=i,(a=e).parent=t,a.previous=d,a.next=d.next,null!=d.next&&(d.next.previous=a),d.next=a,d=a,t.domElement.insertBefore(a.domElement,t.domElement.children[n]),t.Append(a),r.forEach(function(e){t.Append(e)}),a.children.forEach(function(e){"text"==e.type&&(f=e.text.length,u=h=e)})),l&&(e.parent=h.parent,e.next=h.next,(h.next=e).previous=h,d.Append(h),p=!(p=!0),"text"==(h=e).type&&(f=(u=e).text.length))}),p||d.Append(h),""!=a&&(l=_.CreateNew(this.document,"span",a,n.nodeStyle.Copy()),d.Append(l),f=0,u=l),i.forEach(function(e){d.Append(e)}),u.SetFocus(f)}}])&&ie(e.prototype,t),n&&ie(e,n),i}();function ue(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ce=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e}var e,n,o;return e=t,(n=[{key:"HtmlToNode",value:function(e,t){var n=!(1<arguments.length&&void 0!==t)||t,o=(new DOMParser).parseFromString(e,"text/html").body.firstElementChild,i=this.ParseNode(o);return n&&(i=this.Optimize(i)),i}},{key:"Optimize",value:function(e){var i,r=this;return null!=e.children&&(i=[],e.children.forEach(function(e){var t,n,o;e.isTextNode()?(n=!0,null!=(t=e.previous)&&t.isTextNode()&&t.tagName.toLowerCase()==e.tagName.toLowerCase()&&t.HasSameAttributes(e)&&(o=!1,!t.HasSameStyle(e)&&""!=e.text||(o=!0),o&&(""!=e.text&&t.AppendTextContent(e.text),t.next=e.next,null!=t.next&&(t.next.previous=t),t.document.UnregisterNode(e),e.domElement.parentNode.removeChild(e.domElement),n=!1)),n&&i.push(e)):e.isBlockNode()?i.push(r.Optimize(e)):e.isInlineNode()&&i.push(e)}),e.children=i),e}},{key:"ParseNode",value:function(e){e.getAttribute("cm-id");var t=e.getAttribute("cm-type"),n=void 0;if("block"==t.toLowerCase())n=this.ParseBlockNode(e);else if("inline"==t.toLowerCase())n=this.ParseInlineNode(e);else{if("text"!=t.toLowerCase())throw console.log("U.F.O. NODE"),"UNKNON NODE TYPE [1]: "+e.outerHTML;n=this.ParseTextNode(e)}return n}},{key:"ExtactAttributes",value:function(e){var t=[];if(e.hasAttributes())for(var n=e.attributes,o=n.length-1;0<=o;o--){var i=n[o].name,r=n[o].value;"style"!=i.toLowerCase()&&"cm-id"!=i.toLowerCase()&&"cm-type"!=i.toLowerCase()&&"cm-plugin"!=i.toLowerCase()&&"xmlns"!=i.toLowerCase()&&t.push({name:i,value:r})}return t}},{key:"ParseBlockNode",value:function(r){var e,t,n,o,i,s=this,a=r.getAttribute("cm-type"),l=void 0;return"block"==a.toLowerCase()&&(e=r.getAttribute("cm-id"),t=r.getAttribute("cm-plugin"),n=null!=(n=r.getAttribute("cm-has-text-content"))&&JSON.parse(n),o=E.CalculateStyles(this.document,r),i=s.ExtactAttributes(r),null==e?l=H.CreateNew(this.document,r.tagName.toLowerCase(),o.Copy(),i,n,r.textContent):(e=this.document.VerifyAndRegisterNodeId(e),l=new H(this.document,e,r.tagName.toLowerCase(),o.Copy(),i,n,r.textContent),this.document.RegisterNode(l)),r.childNodes.forEach(function(e){if(1==e.nodeType){e.getAttribute("cm-id");var t=e.getAttribute("cm-type");if(null!=t)if("block"==t.toLowerCase()){var n=s.ParseBlockNode(e);l.Append(n)}else if("inline"==t.toLowerCase()){var o=s.ParseInlineNode(e);l.Append(o)}else{if("text"!=t.toLowerCase())throw console.log("UFO NODE"),"UNKNON NODE TYPE [2]: "+r.outerHTML;var i=s.ParseTextNode(e);l.Append(i)}}}),null!=t&&""!=t&&this.document.CreatePluginInstance(t,l)),l}},{key:"ParseInlineNode",value:function(r){var e,t,n,o,s=this,i=r.getAttribute("cm-id"),a=r.getAttribute("cm-type"),l=void 0;return"inline"==a.toLowerCase()&&(e=r.getAttribute("cm-plugin"),t=E.CalculateStyles(this.document,r),n=s.ExtactAttributes(r),o=r.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""),0<r.childNodes.length&&1==r.childNodes[0].nodeType&&(o=""),null==i?l=z.CreateNew(this.document,r.tagName.toLowerCase(),o,t.Copy(),n):(i=this.document.VerifyAndRegisterNodeId(i),l=new z(this.document,i,r.tagName.toLowerCase(),o,t.Copy(),n),this.document.RegisterNode(l)),r.childNodes.forEach(function(e){if(1==e.nodeType){e.getAttribute("cm-id");var t=e.getAttribute("cm-type");if("block"==t.toLowerCase()){var n=s.ParseBlockNode(e);l.Append(n)}else if("inline"==t.toLowerCase()){var o=s.ParseInlineNode(e);l.Append(o)}else{if("text"!=t.toLowerCase())throw console.log("UFO NODE"),"UNKNON NODE TYPE [3]: "+r.outerHTML;var i=s.ParseTextNode(e);l.Append(i)}}}),null!=e&&""!=e&&this.document.CreatePluginInstance(e,l)),l}},{key:"ParseTextNode",value:function(e){var t,n,o,i,r=e.getAttribute("cm-id"),s=void 0;return"text"==e.getAttribute("cm-type").toLowerCase()&&(t=e.getAttribute("cm-plugin"),n=E.CalculateStyles(this.document,e),o=this.ExtactAttributes(e),i=e.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""),null==r?s=_.CreateNew(this.document,e.tagName.toLowerCase(),i,n.Copy(),o):(r=this.document.VerifyAndRegisterNodeId(r),s=new _(this.document,r,e.tagName.toLowerCase(),n.Copy(),i,o),this.document.RegisterNode(s)),null!=t&&""!=t&&this.document.CreatePluginInstance(t,s)),s}},{key:"stringIsUrl",value:function(e){return-1<e.indexOf("http://")||-1<e.indexOf("https://")}},{key:"stringIsEmail",value:function(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}},{key:"PasteSimpleString",value:function(e){var t,n=[];this.stringIsUrl(e)?n=this.document.pluginsManager.PasteContentToPlugin("a",e):this.stringIsEmail(e)?n=this.document.pluginsManager.PasteContentToPlugin("a","mailTo:"+e):(t=_.CreateNew(this.document,"span",e.replace(/[\u200B-\u200D\uFEFF]/g,""),this.document.GetDefaultNodeStyle().Copy()),n.push(t)),this._pasteInPlace(n)}},{key:"PasteContentInPlace",value:function(e,t){var n,o,i,r=1<arguments.length&&void 0!==t?t:"",s=(new DOMParser).parseFromString(e.replace(/\n/g,""),"text/html"),a=s.body.firstElementChild,l=!0;null!=a&&(null!=(n=a.getAttribute("comma"))&&"comma-content"==n?l=!1:(o=a.getAttribute("cm-id"),i=a.getAttribute("cm-type"),null!=o&&""!=o&&null!=i&&""!=i&&(l=!1))),l?this._pasteExternalContent(s,r):this._pasteOurContent(a)}},{key:"_pasteExternalContent",value:function(e,t){new le(this.document,e,t)}},{key:"_pasteOurContent",value:function(e){var o=this,i=[];e.childNodes.forEach(function(e){var t,n=void 0;3==e.nodeType?n=_.CreateNew(this.document,e.tagName.toLowerCase(),e.textContent.replace(/[\u200B-\u200D\uFEFF]/g,"")):"block"==(t=e.getAttribute("cm-type"))?n=o.ParseBlockNode(e):"inline"==t?n=o.ParseInlineNode(e):"text"==t&&(n=o.ParseTextNode(e)),i.push(n)}),this._pasteInPlace(i)}},{key:"_pasteInPlace",value:function(e){var u=void 0,t=this.document.selectionManager.GetCurrent(),c=t.startOffset,n=t.startNode,d=n.parent,o=[],i=[],r=!0;d.children.forEach(function(e){e.id==n.id?(u=e,r=!1):r?o.push(e):i.push(e)}),d.children=o;var s=n.text.substring(0,c),a=n.text.substring(c,n.text.length);n.ForceTextContent(s);var l,h=n,f=c,p=!1;e.forEach(function(e){var t,n,o,i,r,s,a,l=!0;e.isTextNode()?h.isTextNode()&&h.nodeStyle.Equals(e.nodeStyle)&&(e.parent=h.parent,h.Merge(e,c),u=h,l=!1,c+=e.text.length,f=c,p=!1):e.isBlockNode()&&(l=!1,p||d.Append(h),p=!0,t=d.parent,i=[],r=[],s=!(o=n=0),t.children.forEach(function(e){s?i.push(e):r.push(e),e.id==d.id&&(n=o,s=!1),o++}),n+=1,t.children=i,(a=e).parent=t,a.previous=d,a.next=d.next,null!=d.next&&(d.next.previous=a),d.next=a,d=a,t.domElement.insertBefore(a.domElement,t.domElement.children[n]),t.Append(a),r.forEach(function(e){t.Append(e)}),a.children.forEach(function(e){"text"==e.type&&(f=e.text.length,u=h=e)})),l&&(e.parent=h.parent,e.next=h.next,(h.next=e).previous=h,d.Append(h),p=!(p=!0),"text"==(h=e).type&&(f=(u=e).text.length))}),p||d.Append(h),""!=a&&(l=_.CreateNew(this.document,"span",a,n.nodeStyle.Copy()),d.Append(l),f=0,u=l),i.forEach(function(e){d.Append(e)}),u.SetFocus(f)}}])&&ue(e.prototype,n),o&&ue(e,o),t}();function de(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var he=function(){function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.document=e,this.selectionManager=new R(this.document)}var e,t,n;return e=a,n=[{key:"_CleanDomNode",value:function(n,t){var o,i=!0,r=n.getAttribute("cm-id");return t.childNodes.forEach(function(e){var t=e.getAttribute("cm-id");r==t&&(i=!1,n.parentNode.replaceChild(e.cloneNode(!0),n))}),i&&(n.hasChildNodes()?(o=[],n.childNodes.forEach(function(e){3!=e.nodeType&&(i=a._CleanDomNode(e,t))&&o.push(e)}),o.forEach(function(e){try{n.removeChild(e)}catch(e){console.log("#23-239",e)}})):n.remove()),i}},{key:"_fallbackCopyTextToClipboard",value:function(e){var t,n,o=document.createElement("textarea");o.value=e,document.body.appendChild(o),o.focus(),navigator.userAgent.match(/ipad|iphone/i)?((t=document.createRange()).selectNodeContents(o),(n=window.getSelection()).removeAllRanges(),n.addRange(t),o.setSelectionRange(0,999999)):o.select();try{document.execCommand("copy")}catch(e){console.error("ClipboardManager[205]",e)}document.body.removeChild(o)}},{key:"_copyTextToClipboard",value:function(e){navigator.clipboard?navigator.clipboard.writeText(e).then(function(){},function(e){console.error("ClipboardManager[205]",e)}):a._fallbackCopyTextToClipboard(e)}}],(t=[{key:"Paste",value:function(e,t){t.do(pe.DELETE_SELECTION);var n=e.clipboardData.getData("text/rtf"),o=e.clipboardData.getData("text/html"),i=e.clipboardData.getData("text/plain"),r=Array.from(e.clipboardData.files||[]);return!o&&0<r.length||(null==o||""==o?new ce(this.document).PasteSimpleString(i):new ce(this.document).PasteContentInPlace(o,n)),!0}},{key:"Copy",value:function(e){var t=e,n=this.GetSelectedContent(!1);return t.clipboardData.setData("text/html",n),t.clipboardData.setData("text/plain",this._getPlainText(n)),!0}},{key:"Cut",value:function(e,t){var n=e,o=this.GetSelectedContent(!0,t);return n.clipboardData.setData("text/html",o),n.clipboardData.setData("text/plain",this._getPlainText(o)),!0}},{key:"_getPlainText",value:function(e){var t=document.createElement("div");return t.innerHTML=e,Array.from(t.getElementsByTagName("div")).forEach(function(e){"block"==e.getAttribute("cm-type")&&(e.innerHTML="\r\n"+e.innerHTML)}),t.textContent||t.innerText}},{key:"GetSelectedContent",value:function(e,t){var n,o=this.selectionManager.GetCurrent(),l=o.startNode,u=(o.startOffset,o.endNode),i=(o.endOffset,this.selectionManager.GetRange().cloneContents()),c=!0,d="",h=new XMLSerializer,r=!0,s=this.selectionManager.FindCommonNodeContainer(l,u);return null!=s&&null!=s.pluginName&&""!=s.pluginName&&(n=s.domElement.cloneNode(!0),a._CleanDomNode(n,i),d=h.serializeToString(n),r=!1),r&&i.childNodes.forEach(function(e){var t,n,o,i,r,s,a;3==e.nodeType?(o=n=t="",c?(c=!1,t='id="'+l.id+'" cm-id="'+l.id+'"',""!=(i=l.nodeStyle.toStringForStyleTag())&&(n='style="'+i+'"'),""!=(r=l.nodeStyle.toStringForClassTag())&&(o='class="'+r+'"')):(t='id="'+u.id+'" cm-id="'+u.id+'"',""!=(s=u.nodeStyle.toStringForStyleTag())&&(n='style="'+s+'"'),""!=(a=u.nodeStyle.toStringForClassTag())&&(o='class="'+a+'"')),d=d+'<span cm-type="text" '+t+" "+o+" "+n+">"+h.serializeToString(e)+"</span>"):e.getAttribute("cm-id")==l.parent.id?e.childNodes.forEach(function(e){d+=h.serializeToString(e)}):d+=h.serializeToString(e)}),e&&t.do(pe.DELETE_SELECTION),d='<div comma="comma-content">'+d+"</div>"}},{key:"ForceClipboardContent",value:function(e){var t=(new XMLSerializer).serializeToString(e);a._copyTextToClipboard('<div comma="comma-content">'+t+"</div>")}}])&&de(e.prototype,t),n&&de(e,n),a}();function fe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var pe={GET_STYLES_AT_CARRET:"getStyleAtCurrentCursorPosition",TOGGLE_STYLE_ON_LINE:"toggleStyleOnLine",TOGGLE_STYLE_ON_SELECTION:"toggleStyleOnSelection",INSERT_CHAR:"addChar",ENTER:"enter",DELETE:"delete",DELETE_SELECTION:"deleteSelection",BACKSPACE:"backspace",TAB:"tab",CUT:"cut",COPY:"copy",PASTE:"paste",ESC:"esc"},ye=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.document=e,this.selectionManager=new R(this.document),this.stylesManager=new Z(this.document),this.enterManager=new $(this.document),this.deleteManager=new te(this.document),this.clipboardManager=new he(this.document),this.catchUserInput=!1,null!=t&&(this.catchUserInput=!0,this.charactersToCacth=t.characters,this.onCharacterEntered=t.onCharacterEntered)}var e,t,o;return e=n,(t=[{key:"do",value:function(e,t){var n,o=void 0,i=!1;if(this.catchUserInput&&(n="",-1<this.charactersToCacth.indexOf(e)?n=this.charactersToCacth[this.charactersToCacth.indexOf(e)]:"addChar"==e&&-1<this.charactersToCacth.indexOf(t.character)&&(n=t.character),""!=n&&this.onCharacterEntered(n)&&(o=i=!0)),!i){var r=this.selectionManager.GetStartNode();if(null!=r&&r.isTextNode())switch(e){case pe.INSERT_CHAR:o=this._insertCharacter(t.character);break;case pe.TOGGLE_STYLE_ON_LINE:o=(o=this.document.NotifyPlugin(Q.APPLY_STYLE_ON_LINE,r,t))||this.stylesManager.ToggleStyleOnLine(t.styleName,t.value);break;case pe.TOGGLE_STYLE_ON_SELECTION:o=(o=this.document.NotifyPlugin(Q.APPLY_STYLE_ON_TEXT,r,t))||this.stylesManager.ToggleStyleOnSelection(t.styleName,t.value);break;case pe.GET_STYLES_AT_CARRET:o=this.stylesManager.GetStyleAtCurrentCursorPosition();break;case pe.ENTER:o=this.enterManager.Insert();break;case pe.DELETE:o=this.deleteManager.Delete();break;case pe.DELETE_SELECTION:o=this.deleteManager.DeleteSelection();break;case pe.BACKSPACE:o=this.deleteManager.Backspace();break;case pe.TAB:o=this.stylesManager.ToggleStyleOnLine("indent","add"),o=!0;break;case pe.COPY:o=this.clipboardManager.Copy(t);break;case pe.CUT:o=this.clipboardManager.Cut(t,this);break;case pe.PASTE:o=this.clipboardManager.Paste(t,this);break;default:return}else switch(e){case pe.TOGGLE_STYLE_ON_LINE:this.document.NotifyPlugin(Q.APPLY_STYLE_ON_LINE,void 0,t);break;case pe.TOGGLE_STYLE_ON_SELECTION:this.document.NotifyPlugin(Q.APPLY_STYLE_ON_TEXT,void 0,t);break;case pe.BACKSPACE:o=!0,null!=r&&(r.document.IsNodeInsidePlugin(r)?void 0===(o=this.document.NotifyPlugin(Q.DELETE,void 0,t))&&(o=!0):this.document.NotifyPlugin(Q.DELETE,void 0,t));break;case pe.DELETE:this.document.NotifyPlugin(Q.DELETE,void 0,t),o=!0;break;case pe.ENTER:o=!0;break;default:o=!this.document.IsNodeInsidePlugin(r)}}return o}},{key:"_insertCharacter",value:function(e){var t=!1;this.selectionManager.IsCollapsed()||this.document.DeleteSelection();var n=this.selectionManager.GetStartNode();return null!=n&&n.isTextNode()?t=n.InsertCharacter(e):(t=!0,console.log(this.selectionManager.GetCurrent()),console.log("entering text on empty node",n)),t}},{key:"ForceClipboardContent",value:function(e){this.clipboardManager.ForceClipboardContent(e)}}])&&fe(e.prototype,t),o&&fe(e,o),n}(),ge={},me=function(e,t,n){if("s"!=e)return ge[t];ge[t]=n},ve={isProduction:!0,version:"snqned"},Ce="98.71.57.106.89.87.120.111.98.51.78.48",Ne="77.67.52.119.76.106.65.117.77.65.61.61",Ee="77.84.73.51.76.106.65.117.77.67.52.120",Se="97.72.82.48.99.68.111.118.76.122.65.117.77.67.52.119.76.106.65.54.77.122.65.119.77.67.57.112.80.119.61.61";ve.isProduction&&(Se="97.72.82.48.99.72.77.54.76.121.57.51.100.51.99.117.89.50.57.116.98.87.70.113.99.121.53.106.98.50.48.118.97.84.56.61");var Te="98.71.57.106.89.88.82.112.98.50.52.61",be="97.71.57.122.100.71.53.104.98.87.85.61",Ae="90.87.53.106.98.50.82.108.86.86.74.74.81.50.57.116.99.71.57.117.90.87.53.48";function xe(e){for(var t=e.split("."),n="",o=0;o<t.length;o++)n+=String.fromCharCode(t[o]);return atob(n)}var ke=!1,Pe=!1;function Oe(){var e=function(e){if(null!=e&&""!=e){var t=window[xe(Te)][xe(be)];4==t.split(".").length||(t=t.split(".").slice(-2).join("."));for(var n=(e+"#"+ve.version+"#"+t).toString().split(""),o=0;o<n.length;o++){n[o].charCodeAt(0)<=126&&(n[o]=String.fromCharCode((n[o].charCodeAt(0)+13)%126))}e=btoa(n.join(""))}return window[xe(Ae)](e)}(me("g","l"));if(null==e)return new Promise(function(e,t){navigator.onLine?Pe=!(ke=!1):ke=Pe=!0,e()});var n=new Image;navigator.onLine&&me("g","f")(n,xe(Se)+e);var o=!1;return n[xe("99.51.74.106")].indexOf(e)<0&&(o=!0),new Promise(function(e,t){o?Pe=!(ke=!1):navigator.onLine?(n[xe("98.50.53.115.98.50.70.107")]=function(e){Pe=!(ke=!1)},n[xe("98.50.53.108.99.110.74.118.99.103.61.61")]=function(e){Pe=ke=!0}):ke=Pe=!0,e()})}var _e,we,Fe=0,Ie=(_e=20,we=500,Math.floor(Math.random()*(we-_e+1)+_e)),Re=!0;function De(){var e=!1;return!function(){if(!Re){var e=window[xe(Te)][xe(be)],t=!1;return e!=xe(Ce)&&e!=xe(Ne)&&e!=xe(Ee)||(t=!0),t}}()?Ie<++Fe?Pe?e=ke:(e=!0,Oe()):e=(me("g","v")&&me("g","vv"),!0):(""==me("g","l")||null==me("g","l")||me("g","v")&&me("g","vv"))&&(e=!0),e}var Le=De;function Ge(e){return function(e){if(Array.isArray(e))return Me(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Me(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Me(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function Be(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var He=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e,this.allPlugins={},this.allInstances={},this.catchSpecialChars=[],this.specialCharToPlugin={},this.selectionManager=new R(this.document),this.idInstanceInFocus=void 0}var e,n,o;return e=t,(n=[{key:"Register",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:void 0,o=e.GetName();if(null!=this.allPlugins[o])throw"Plugin or plugin's name already registered: '"+o+"'";var i={name:o,class:e,options:n};this.allPlugins[o]=i,null!=n&&n.fireOnChar&&null!=n.charForFire&&""!=n.charForFire&&(this.catchSpecialChars.push(n.charForFire),null==this.specialCharToPlugin[n.charForFire]&&(this.specialCharToPlugin[n.charForFire]=[]),this.specialCharToPlugin[n.charForFire].push(o))}},{key:"GetAllPluginInstances",value:function(e){var n=0<arguments.length&&void 0!==e?e:void 0,o=[],i=this;return Object.keys(this.allInstances).forEach(function(e){var t=i.allInstances[e];null!=n&&t.rootNode.GetPluginType().toLowerCase()!=n.toLowerCase()||o.push(t)}),o}},{key:"GetPluginOptions",value:function(e){var t=this.allPlugins[e];return null!=t?t.options:void 0}},{key:"NotifyPluginOnSpecialChar",value:function(e){var n=this,t=!1;return-1<this.catchSpecialChars.indexOf(e)&&this.specialCharToPlugin[e].forEach(function(e){var t=n.allPlugins[e];null!=t.options&&(t.options.fireCreateNew?n.InsertPluginAtSection(e):t.class[t.options.fireStaticFunction](n.document,t.options))}),Le()||(t=!0),t}},{key:"IsNodeInsidePlugin",value:function(e){return null!=this.FindNodesInstance(e)}},{key:"NotifyPlugin",value:function(e,t,n){if(null!=t){var o,i,r=this.FindNodesInstance(t);return null!=r?(this.idInstanceInFocus!=r.id&&(null!=(o=this.allInstances[this.idInstanceInFocus])&&o.Fire(Q.LOST_FOCUS),this.idInstanceInFocus=r.id),this.idInstanceInFocus=r.id,r.Fire(e,t,this,n)):(null==this.idInstanceInFocus||null!=(i=this.allInstances[this.idInstanceInFocus])&&i.Fire(Q.LOST_FOCUS),this.idInstanceInFocus=void 0,!1)}if(null!=this.idInstanceInFocus){var s=this.allInstances[this.idInstanceInFocus];if(null!=s)return s.Fire(e,t,this,n)}}},{key:"CallPluginStaticMethod",value:function(e,t,n){var o=this.allPlugins[e];if(null==o||null==o.class)throw"Unknown plugin: '"+e+"'";o.class[t](this.document,n)}},{key:"FindNodesInstance",value:function(e){var t=void 0;return null!=e.GetPluginType()&&""!=e.GetPluginType()?t=this.allInstances[e.id]:null!=e.parent&&(t=this.FindNodesInstance(e.parent)),t}},{key:"RegisterPluginInstance",value:function(e){this.allInstances[e.id]=e}},{key:"DeletePluginInstance",value:function(e){delete this.allInstances[e.id]}},{key:"RemovePluginInstance",value:function(e){var t=this.allInstances[e];null!=t&&(null!=t.rootNode&&t.rootNode.RemovePluginType(),delete this.allInstances[e])}},{key:"ChangePluginInstanceId",value:function(e,t){var n=this.allInstances[e];null!=n&&(n.id=t,delete this.allInstances[e],this.RegisterPluginInstance(n))}},{key:"InsertPluginAtSection",value:function(t,e){var n=this.allPlugins[t];if(null==n||null==n.class)throw"Unknown plugin: '"+t+"'";var o,i=n.class.CreateNew(this.document,e);return null!=i&&(Array.isArray(i)?(o=this,i.forEach(function(e){e.rootNode.SetPluginType(t),o.RegisterPluginInstance(e)})):(i.rootNode.SetPluginType(t),this.RegisterPluginInstance(i))),i}},{key:"CreatePluginInstance",value:function(e,t){var n=this.allPlugins[e];if(null==n||null==n.class)throw"Unknown plugin: '"+e+"'";var o=new n.class(t);o.rootNode.SetPluginType(e),this.RegisterPluginInstance(o)}},{key:"FindPluginForPasteByTagName",value:function(n){var o=void 0,i=this;return Object.keys(this.allPlugins).forEach(function(e){var t=i.allPlugins[e];-1<t.class.GetTagToParseOnPaste().indexOf(n.toLowerCase())&&(o=t)}),o}},{key:"PasteContentToPlugin",value:function(e,t){var n=this.FindPluginForPasteByTagName(e);if(null!=n){var o=n.class.CreateNewFromPastedNode(this.document,t);if(null!=o.mustArrangeNodes&&o.mustArrangeNodes){var i=o.pluginNode,r=o.nodesBefore,s=o.nodesAfter;return i.rootNode.SetPluginType(n.name),this.RegisterPluginInstance(i),[].concat(Ge(r),[i.rootNode],Ge(s))}return o.rootNode.SetPluginType(n.name),this.RegisterPluginInstance(o),o.rootNode}}}])&&Be(e.prototype,n),o&&Be(e,o),t}();function je(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ue=function(){function d(e,t,n,o,i,r,s,a,l){var u=this,c=9<arguments.length&&void 0!==arguments[9]?arguments[9]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),this.readOnly=e,this.nodeContainer=n,this.allStyles=o,this.onStyleChanged=s,this.onDocChanged=a,this.IdManager=new g,this.actionsManager=new ye(this,c),this.pluginsManager=new He(this),this.selectionManager=new R(this),this.historyManager=void 0,this.rootNode=void 0,this.allNodesById={},null!=l&&l.forEach(function(e){u.pluginsManager.Register(e.pClass,e.options)}),this.defaultNodeStyle=E.ParseDefaultFormat(this,i),null==t||""==t?this.InitEmptyDoc(this.defaultNodeStyle):this.LoadContent(t)}var e,t,n;return e=d,(t=[{key:"SetHistoryManager",value:function(e){this.historyManager=e}},{key:"PushToHistory",value:function(){null!=this.onDocChanged&&this.onDocChanged(),this.historyManager.Push(this.GetContent(),this.GetCursorPosition())}},{key:"LoadContent",value:function(e,t){var n,o,i=!(1<arguments.length&&void 0!==t)||t;for(this.rootNode=void 0,this.allNodesById={},this.IdManager.Reset();this.nodeContainer.firstChild;)this.nodeContainer.removeChild(this.nodeContainer.firstChild);null==e||""==e?this.InitEmptyDoc():(n=new ce(this),this.rootNode=n.HtmlToNode(e,i),this.nodeContainer.appendChild(this.rootNode.domElement),null!=(o=this.rootNode.GetFirstTextNode())?o.SetFocus():console.log("#01-01"))}},{key:"AddDevContent",value:function(){var e=this;setTimeout(function(){e.InsertPluginAtSection("table",{rows:3,cols:4})},200)}},{key:"ForceClipboardContent",value:function(e){var t=this,n=this.GetCursorPosition();this.actionsManager.ForceClipboardContent(e),setTimeout(function(){t.SetCursorPosition(n)},1)}},{key:"InitEmptyDoc",value:function(){for(;this.nodeContainer.firstChild;)this.nodeContainer.removeChild(this.nodeContainer.firstChild);this.rootNode=H.CreateNew(this,"div");var e=void 0;null!=this.defaultLineStyle&&(e=this.defaultLineStyle.Copy());var t=H.CreateNew(this,"div",e),n=void 0;null!=this.defaultNodeStyle&&(n=this.defaultNodeStyle.Copy());var o=_.CreateNew(this,"span","",n);t.Append(o),this.rootNode.Append(t),this.nodeContainer.appendChild(this.rootNode.domElement),o.SetFocus()}},{key:"Focus",value:function(){this.rootNode.GetFirstTextNode().SetFocus()}},{key:"FocusAtTheEnd",value:function(){this.rootNode.GetLastTextNode().SetFocusAtTheEnd()}},{key:"isContentEmpty",value:function(){return this.rootNode.isEmpty()}},{key:"GetFloatingContainer",value:function(){var e,t,n=void 0,o=this.rootNode.children[this.rootNode.children.length-1];return o.isBlockNode()&&(n=null==(e=o.domElement.getAttribute("cm-floating-container"))||""==e?(t=H.CreateNew(this,"div",void 0,[{name:"contentEditable",value:!1},{name:"cm-floating-container",value:!0}]),this.rootNode.Append(t),t):o),n}},{key:"GetDefaultNodeStyle",value:function(){return this.defaultNodeStyle.Copy()}},{key:"GenereateNewNodeId",value:function(){return this.IdManager.GetNew()}},{key:"VerifyAndRegisterNodeId",value:function(e){return this.IdManager.VerifyAndRegister(e)}},{key:"RegisterNode",value:function(e){this.allNodesById[e.id]=e}},{key:"GetNodeById",value:function(e){return this.allNodesById[e]}},{key:"UnregisterNode",value:function(e){this.pluginsManager.NotifyPlugin(Q.NODE_UNREGISTERED,e),delete this.allNodesById[e.id]}},{key:"GetAllPluginInstances",value:function(e){return this.pluginsManager.GetAllPluginInstances(e)}},{key:"DeleteNode",value:function(e,t,n,o){var i=2<arguments.length?n:void 0,r=3<arguments.length?o:void 0;1<arguments.length&&void 0!==t&&t?(e.domElement.remove(),this.UnregisterNode(e)):F.ReplaceNode(this,e,[],!1,i,r)}},{key:"GetNodeAtCursor",value:function(){return this.selectionManager.GetStartNode()}},{key:"GetSelectionBoundingClientRect",value:function(){return this.selectionManager.GetBoundingClientRect()}},{key:"ManagerSpecialActions",value:function(e,t){var n=!1;switch(e){case"newCharAdded":this.NotifyPlugin(Q.NEW_CHAR_ADDED,this.selectionManager.GetStartNode(),t);break;case"enter":n=(n=this.NotifyPlugin(Q.ENTER,this.selectionManager.GetStartNode()))||this.actionsManager.do(pe.ENTER);break;case"backspace":n=this.actionsManager.do(pe.BACKSPACE);break;case"delete":n=(n=this.NotifyPlugin(Q.DELETE,this.selectionManager.GetStartNode()))||this.actionsManager.do(pe.DELETE);break;case"tab":n=(n=this.NotifyPlugin(Q.TAB,this.selectionManager.GetStartNode()))||this.actionsManager.do(pe.TAB);break;case"BEFORE_COPY":n=this.NotifyPlugin(Q.BEFORE_COPY,this.selectionManager.GetStartNode(),t);break;case"BEFORE_CUT":n=this.NotifyPlugin(Q.BEFORE_CUT,this.selectionManager.GetStartNode(),t);break;case"BEFORE_PASTE":n=this.NotifyPlugin(Q.BEFORE_PASTE,this.selectionManager.GetStartNode(),t);break;case"copy":n=this.actionsManager.do(pe.COPY,t);break;case"cut":n=this.actionsManager.do(pe.CUT,t);break;case"paste":n=this.actionsManager.do(pe.PASTE,t);break;case"click":var o=this.GetNodeById(t.srcElement.getAttribute("cm-id"));null!=o&&(n=this.NotifyPlugin(Q.CLICK,o));break;case"ARROW_UP":n=this.NotifyPlugin(Q.ARROW_UP,this.selectionManager.GetStartNode(),t);break;case"ARROW_DOWN":n=this.NotifyPlugin(Q.ARROW_DOWN,this.selectionManager.GetStartNode(),t);break;case"ARROW_LEFT":n=this.NotifyPlugin(Q.ARROW_LEFT,this.selectionManager.GetStartNode(),t);break;case"ARROW_RIGHT":n=this.NotifyPlugin(Q.ARROW_RIGHT,this.selectionManager.GetStartNode(),t);break;case"SHIFT_ARROW_UP":n=this.NotifyPlugin(Q.SHIFT_ARROW_UP,this.selectionManager.GetStartNode(),t);break;case"SHIFT_ARROW_DOWN":n=this.NotifyPlugin(Q.SHIFT_ARROW_DOWN,this.selectionManager.GetStartNode(),t);break;case"SHIFT_ARROW_LEFT":n=this.NotifyPlugin(Q.SHIFT_ARROW_LEFT,this.selectionManager.GetStartNode(),t);break;case"SHIFT_ARROW_RIGHT":n=this.NotifyPlugin(Q.SHIFT_ARROW_RIGHT,this.selectionManager.GetStartNode(),t);break;case"SHIFT_DOWN":n=this.NotifyPlugin(Q.SHIFT_DOWN,this.selectionManager.GetStartNode(),t);break;case"SHIFT_UP":n=this.NotifyPlugin(Q.SHIFT_UP,this.selectionManager.GetStartNode(),t);break;case"SELECT_ALL":n=this.NotifyPlugin(Q.SELECT_ALL,this.selectionManager.GetStartNode(),t);break;case"ESC":n=this.NotifyPlugin(Q.ESC,this.selectionManager.GetStartNode()),this.actionsManager.do(pe.ESC);break;case"SELECTION_CHANGED":break;default:return}return n}},{key:"SaveCursorPositonBeforeClick",value:function(){this.cursorPositonBeforeClick=this.GetCursorPosition()}},{key:"RestoreCursorPositionBeforeClick",value:function(){this.SetCursorPosition(this.cursorPositonBeforeClick)}},{key:"DeleteSelection",value:function(){return this.actionsManager.do(pe.DELETE_SELECTION)}},{key:"InsertCharacter",value:function(e){if(this.pluginsManager.NotifyPluginOnSpecialChar(e))return!0;var t={character:e};return this.actionsManager.do(pe.INSERT_CHAR,t)}},{key:"ToggleStyleOnSelection",value:function(e,t){var n={styleName:e,value:t};return this.actionsManager.do(pe.TOGGLE_STYLE_ON_SELECTION,n)}},{key:"ToggleStyleOnLine",value:function(e,t){var n={styleName:e,value:t};return this.actionsManager.do(pe.TOGGLE_STYLE_ON_LINE,n)}},{key:"GetStyleAtCurrentCursorPosition",value:function(){return this.actionsManager.do(pe.GET_STYLES_AT_CARRET)}},{key:"GetCurrentStyle",value:function(){return new E(this,this.actionsManager.do(pe.GET_STYLES_AT_CARRET).nodeStyle).Copy()}},{key:"GetContent",value:function(){return this.content=this.nodeContainer.innerHTML,this.content}},{key:"GetCursorPosition",value:function(){var e=window.getSelection(),t=void 0;e.rangeCount?t=e.getRangeAt(0):(t=document.createRange()).collapse(!0);var n,o,i=t.startContainer.parentNode,r=t.startOffset,s=t.endContainer.parentNode,a=t.endOffset;return null!=i&&null!=s&&(n=i.getAttribute("cm-id"),o=s.getAttribute("cm-id")),{idStartNode:n,startOffset:r,idEndNode:o,endOffset:a}}},{key:"SetCursorPosition",value:function(e){var t,n,o=this.GetNodeById(e.idStartNode),i=this.GetNodeById(e.idEndNode);null!=o&&null!=i&&(t=window.getSelection(),(n=document.createRange()).setStart(o.domElement.firstChild,e.startOffset),n.setEnd(i.domElement.firstChild,e.endOffset),t.removeAllRanges(),t.addRange(n))}},{key:"VerifyCursorPosition",value:function(e){this.selectionManager.VerifyCursorPosition(e)}},{key:"IsNodeInsidePlugin",value:function(e){var t=!1;return null!=e&&(null==this.pluginsManager.FindNodesInstance(e)||(t=!0)),t}},{key:"GetPluginOptions",value:function(e){return this.pluginsManager.GetPluginOptions(e)}},{key:"CreatePluginInstance",value:function(e,t){return this.pluginsManager.CreatePluginInstance(e,t)}},{key:"RemovePluginInstance",value:function(e){return this.pluginsManager.RemovePluginInstance(e)}},{key:"InsertPluginAtSection",value:function(e,t){var n=void 0;return this.selectionManager.GetCurrent().hasFocus&&(n=this.pluginsManager.InsertPluginAtSection(e,t)),this.PushToHistory(),n}},{key:"CallPluginStaticMethod",value:function(e,t,n){this.pluginsManager.CallPluginStaticMethod(e,t,n)}},{key:"NotifyPlugin",value:function(e,t,n){return this.pluginsManager.NotifyPlugin(e,t,n)}},{key:"InsertNodeAtCursor",value:function(e){F.InsertNodeAtCursor(this,e)}},{key:"ChangePluginInstanceId",value:function(e,t){this.pluginsManager.ChangePluginInstanceId(e,t)}},{key:"AppendTextAtCursor",value:function(e,t){this.DeleteSelection();var n,o,i=this.GetCursorPosition(),r=this.GetNodeById(i.idStartNode);null==r&&(i=t,r=this.GetNodeById(i.idStartNode)),r.isTextNode()&&(n=i.startOffset,o=r.text,r.ForceTextContent([o.slice(0,n),e,o.slice(n)].join("")),r.SetFocus(n+e.length),this.PushToHistory())}},{key:"AppendHtmlAtCursor",value:function(e){this.DeleteSelection(),new ce(this).PasteContentInPlace(e)}},{key:"Autocorrect",value:function(e){var t,o,i;null!=e&&0<e.length&&(t=this.GetCursorPosition(),(o=this.GetNodeById(t.idStartNode)).isTextNode()&&(i=o.text,e.forEach(function(e){var t,n=i.indexOf(e.string);-1<n&&(t=n+e.replaceWith.length,o.ForceTextContent(i.replace(e.string,e.replaceWith)),t>o.text.length?t=o.text.length:t<0&&(t=0),o.SetFocus(t))})))}},{key:"GetSelectedLines",value:function(){return this.selectionManager.GetSelectedLines()}},{key:"IsolateAndReturnSelectedTextNodes",value:function(){return this.selectionManager.IsolateAndReturnSelectedTextNodes()}},{key:"GetSelectedTextNodes",value:function(){return this.selectionManager.GetSelectedTextNodes()}},{key:"FireStyleChanged",value:function(){null!=this.onStyleChanged&&this.onStyleChanged(this.GetStyleAtCurrentCursorPosition())}},{key:"Test",value:function(){console.log("Hi!")}}])&&je(e.prototype,t),n&&je(e,n),d}(),We=!1,Ke=!1,Ye="",ze="eXxwbnl1fAID",Je="PTs9Oz07PQ==",Xe="Pj9EOz07PTs+",Ve="dnsCcgEDT3JzfAFy",Ze="c3YBAgNQdXZ5cQ==",qe="dQMDfUc8PD07PTs9Oz1HQD09PTx2TA==";ve.isProduction&&(qe="dQMDfQJHPDwGBgY7cHx6em53AjtwfHo8dkw=");var $e="UHx6em5XYEctfXlybgJyLX0BfAV2cXItbi0Fbnl2cS15dnBye3ByLXhyCA==",Qe="b25weHQBfAR7cTpwfHl8AUcBcnFIfW5xcXZ7dEc+PX0HSHB8eXwBRzBzc3Nzc3NI";function et(e,t){if(me("s","l",t),t=function(e){if(null!=e&&""!=e){var t=window.location.hostname;4==t.split(".").length||(t=t.split(".").slice(-2).join("."));for(var n=(e+"#"+ve.version+"#"+t).toString().split(""),o=0;o<n.length;o++){n[o].charCodeAt(0)<=126&&(n[o]=String.fromCharCode((n[o].charCodeAt(0)+13)%126))}e=btoa(n.join(""))}return window.encodeURIComponent(e)}(t),We)return new Promise(function(e,t){Ke?t(!0):e(!1)});if(null==t)return We=!0,new Promise(function(e,t){navigator.onLine?(me("s","vv",!(Ke=!1)),e(!1)):(me("s","vv",Ke=!0),t(!0))});We=!0;var n=new Image,o=!1;return navigator.onLine&&e(n,ot(qe)+t),n[ot("AgFw")].indexOf(t)<0&&(o=!0),new Promise(function(e,t){navigator.onLine?o?(me("s","vv",!(Ke=!1)),e(!1)):(n.onload=function(){me("s","vv",!(Ke=!1)),e(!1)},n.onerror=function(e){me("s","vv",Ke=!0),t(!0)}):(me("s","vv",Ke=!0),t(!0))})}function tt(){me("s","v",!0)}function nt(){me("s","v",!1);var e=document.getElementById(me("g","i")).parentElement,t=document.createElement("div");t.setAttribute("style",ot(Qe)),t.textContent=ot($e),e[ot(Ve)](t,e[ot(Ze)])}function ot(e){return function(e,t,n){var o=1<arguments.length&&void 0!==t?t:13,i=2<arguments.length&&void 0!==n&&n;if("number"!=typeof o||o%1!=0||"number"!=typeof o||o%1!=0)return e.toString();for(var r=e.toString().split(""),s=0;s<r.length;s++){r[s].charCodeAt(0)<=126&&(r[s]=String.fromCharCode((r[s].charCodeAt(0)+o)%126))}return i?btoa(r.join("")):r.join("")}(e=atob(e),113)}var it=!1;function rt(e){me("s","i",e.idContainerOrDomElement),!function(){if(!it){var e=!1;return(Ye=window.location.hostname)!=ot(ze)&&Ye!=ot(Je)&&Ye!=ot(Xe)||(e=!0),e}}()?(me("s","f",e.InitSrc),et(e.InitSrc,e.e).then(function(e){nt()}).catch(function(e){(e?tt:nt)()})):tt()}var st=function(e){rt(e)},at=function(e,t){e.src=t};function lt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ut=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.id=e.id,this.rootNode=e,t||this.InitializeDomElements()}var e,t,o;return e=n,o=[{key:"GetName",value:function(){return""}},{key:"CreateNew",value:function(){throw"CreateNew: Not implemented"}},{key:"CreateNewFromPastedNode",value:function(){throw"CreateNewFromPastedNode: Not implemented"}},{key:"GetTagToParseOnPaste",value:function(){return[]}}],(t=[{key:"Fire",value:function(){}},{key:"InitializeDomElements",value:function(e){var t;null!=this.PluginDidMount&&(null==this.rootNode.parent?(null==e?e=0:e++,e<50?(t=this,setTimeout(function(){t.InitializeDomElements(e)},100)):console.log("#345-23")):this.readOnly||this.PluginDidMount())}}])&&lt(e.prototype,t),o&&lt(e,o),n}(),ct={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,o,i,r,s,a,l="",u=0;for(e=ct._utf8_encode(e);u<e.length;)i=(t=e.charCodeAt(u++))>>2,r=(3&t)<<4|(n=e.charCodeAt(u++))>>4,s=(15&n)<<2|(o=e.charCodeAt(u++))>>6,a=63&o,isNaN(n)?s=a=64:isNaN(o)&&(a=64),l=l+this._keyStr.charAt(i)+this._keyStr.charAt(r)+this._keyStr.charAt(s)+this._keyStr.charAt(a);return l},decode:function(e){var t,n,o,i,r,s,a="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=this._keyStr.indexOf(e.charAt(l++))<<2|(i=this._keyStr.indexOf(e.charAt(l++)))>>4,n=(15&i)<<4|(r=this._keyStr.indexOf(e.charAt(l++)))>>2,o=(3&r)<<6|(s=this._keyStr.indexOf(e.charAt(l++))),a+=String.fromCharCode(t),64!=r&&(a+=String.fromCharCode(n)),64!=s&&(a+=String.fromCharCode(o));return a=ct._utf8_decode(a)},_utf8_encode:function(e){var t="";e=e.replace(/\r\n/g,"\n");for(var n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):(127<o&&o<2048?t+=String.fromCharCode(o>>6|192):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128)),t+=String.fromCharCode(63&o|128))}return t},_utf8_decode:function(e){for(var t,n,o="",i=0,r=t=0;i<e.length;)(r=e.charCodeAt(i))<128?(o+=String.fromCharCode(r),i++):191<r&&r<224?(t=e.charCodeAt(i+1),o+=String.fromCharCode((31&r)<<6|63&t),i+=2):(t=e.charCodeAt(i+1),n=e.charCodeAt(i+2),o+=String.fromCharCode((15&r)<<12|(63&t)<<6|63&n),i+=3);return o}},dt=ct;function ht(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ft(e){for(var t,n="",o=[107,101,121],i=0;i<o.length;i++)n+=(t=o[i],String.fromCharCode(t));return e[n]}var pt=function(){function o(e,t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.a.Init(),this.idContainerOrDomElement=e,this.document=void 0,t=this.ValidateUserOptions(t),this.readOnly=t.readOnly,this.onChange=t.onChange,this.onStyleChanged=t.onStyleChanged,this.onFilesPasted=t.onFilesPasted,this.onSelectinChange=t.onSelectinChange,this.styleMonitoring=t.styleMonitoring,this.content=t.content,this.defaultStyle=t.defaultStyle,this.allStyles=t.styles,this.caretColor=t.caretColor,this.defaultLineStyle=t.defaultLineStyle,this.catchUserInput=t.catchUserInput,this.e=ft(t),this.eventsManager=new p(this),this.historyManager=new s,this.plugins=[],null!=t.plugins&&(this.plugins=t.plugins),this.shortcutManager=new u(this),this.SetUserSettings(t),this._initContainer(),this.str="$#22#5#1975#$",setTimeout(function(){st(n)},300)}var e,t,n;return e=o,(t=[{key:"InitSrc",value:function(e,t){return at(e,t)}},{key:"ValidateUserOptions",value:function(e){return null==e&&(e={}),null==e.readOnly&&(e.readOnly=!1),null==e.onChange&&(e.onChange=function(){}),null==e.onStyleChanged&&(e.onStyleChanged=function(){}),null==e.onSelectinChange&&(e.onSelectinChange=function(){}),null==e.styleMonitoring&&(e.styleMonitoring=function(){}),null==e.content&&(e.content=""),null==e.defaultStyle&&(e.defaultStyle={bold:!1,fontSize:"14px",fontColor:"#39434d"}),null==e.defaultLineStyle&&(e.defaultLineStyle={align:"left"}),e}},{key:"SetUserSettings",value:function(e){null!=e&&""!=e||(e={}),this.shortcuts=[],this.autocorrect=[],this.useAutocorrect=!1,null!=e.userSettings?(null!=e.userSettings.shortcuts&&(this.shortcuts=e.userSettings.shortcuts),null!=e.userSettings.autocorrect&&0<e.userSettings.autocorrect.length&&(this.useAutocorrect=!0,this.autocorrect=e.userSettings.autocorrect)):(null!=e.shortcuts&&(this.shortcuts=e.shortcuts),null!=e.autocorrect&&0<e.autocorrect.length&&(this.useAutocorrect=!0,this.autocorrect=e.autocorrect)),this.shortcutManager.SetShortcuts(this.shortcuts)}},{key:"_KeyDown",value:function(e){this.eventsManager.KeyDown(e)}},{key:"_KeyUp",value:function(e){this.eventsManager.KeyUp(e),this.SelectionChanged()}},{key:"_Paste",value:function(e){this.eventsManager.OnPaste(e),this.FireStyleMonitoring()}},{key:"_Cut",value:function(e){this.eventsManager.OnCut(e),this.FireStyleMonitoring()}},{key:"_Copy",value:function(e){this.eventsManager.OnCopy(e),this.FireStyleMonitoring()}},{key:"_Click",value:function(e){this.eventsManager.OnClick(e),this.FireStyleMonitoring()}},{key:"_Mousedown",value:function(){this.SaveCursorPositonBeforeClick()}},{key:"_Mouseup",value:function(){this.SelectionChanged()}},{key:"_initContainer",value:function(){var t=this;"string"==typeof this.idContainerOrDomElement?this.mainContainer=document.getElementById(this.idContainerOrDomElement):this.mainContainer=this.idContainerOrDomElement,this.mainContainer.style.outline="none",this.mainContainer.style.opacity=0,this.mainContainer.style.whiteSpace="pre-wrap",null==this.caretColor||""==this.caretColor?this.mainContainer.style.caretColor="#475666":this.mainContainer.style.caretColor=this.caretColor,null!=this.defaultStyle.fontColor&&""!=this.defaultStyle.fontColor&&(this.mainContainer.style.color=this.defaultStyle.fontColor,delete this.defaultStyle.fontColor),this.readOnly?(this.mainContainer.setAttribute("contenteditable",!1),this.document=new Ue(this.readOnly,this.content,this.mainContainer,this.allStyles,this.defaultStyle,this.defaultLineStyle,this.styleMonitoring,function(e){return t.FireDocChanged(e)},this.plugins)):(this.mainContainer.setAttribute("contenteditable",!0),this.eventsFunctions={keydown:this._KeyDown.bind(this),keyup:this._KeyUp.bind(this),paste:this._Paste.bind(this),cut:this._Cut.bind(this),copy:this._Copy.bind(this),click:this._Click.bind(this),mousedown:this._Mousedown.bind(this),mouseup:this._Mouseup.bind(this)},this.mainContainer.addEventListener("keydown",this.eventsFunctions.keydown),this.mainContainer.addEventListener("keyup",this.eventsFunctions.keyup),this.mainContainer.addEventListener("paste",this.eventsFunctions.paste),this.mainContainer.addEventListener("cut",this.eventsFunctions.cut),this.mainContainer.addEventListener("copy",this.eventsFunctions.copy),this.mainContainer.addEventListener("click",this.eventsFunctions.click),this.mainContainer.addEventListener("mousedown",this.eventsFunctions.mousedown),null!=this.mainContainer.parentNode&&this.mainContainer.parentNode.addEventListener("mouseup",this.eventsFunctions.mouseup),this.document=new Ue(this.readOnly,this.content,this.mainContainer,this.allStyles,this.defaultStyle,this.defaultLineStyle,this.styleMonitoring,function(e){return t.FireDocChanged(e)},this.plugins,this.catchUserInput),this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),this.document.SetHistoryManager(this.historyManager),this.FireStyleMonitoring(),this.latestCursorPosition=this.document.GetCursorPosition()),this.mainContainer.style.opacity=1}},{key:"Destroy",value:function(){this.readOnly||(this.mainContainer.removeEventListener("keydown",this.eventsFunctions.keydown),this.mainContainer.removeEventListener("keyup",this.eventsFunctions.keyup),this.mainContainer.removeEventListener("paste",this.eventsFunctions.paste),this.mainContainer.removeEventListener("cut",this.eventsFunctions.cut),this.mainContainer.removeEventListener("copy",this.eventsFunctions.copy),this.mainContainer.removeEventListener("click",this.eventsFunctions.click),this.mainContainer.removeEventListener("mousedown",this.eventsFunctions.mousedown),null!=this.mainContainer.parentNode&&this.mainContainer.parentNode.removeEventListener("mouseup",this.eventsFunctions.mouseup))}},{key:"Fire",value:function(e,t){var n=!1,o=!0;switch(e){case f.CUR_POS_CHANGED:this.document.VerifyCursorPosition(t),n=o=!1;break;case f.ENTER:this.useAutocorrect&&this.Autocorrect(),this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),n=this.document.ManagerSpecialActions("enter");break;case f.BACKSPACE:this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),n=this.document.ManagerSpecialActions("backspace");break;case f.DELETE:this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),n=this.document.ManagerSpecialActions("delete");break;case f.TAB:n=this.document.ManagerSpecialActions("tab");break;case f.BEFORE_COPY:n=this.document.ManagerSpecialActions("BEFORE_COPY",t),o=!1;break;case f.BEFORE_CUT:n=this.document.ManagerSpecialActions("BEFORE_CUT",t),o=!1;break;case f.BEFORE_PASTE:n=this.document.ManagerSpecialActions("BEFORE_PASTE",t),o=!1;break;case f.COPY:n=this.document.ManagerSpecialActions("copy",t),o=!1;break;case f.CUT:this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),n=this.document.ManagerSpecialActions("cut",t);break;case f.PASTE:this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),n=this.document.ManagerSpecialActions("paste",t);break;case f.CLICK:n=this.document.ManagerSpecialActions("click",t),o=!1;break;case f.AFTER_CHAR_ADDED:this.document.ManagerSpecialActions("newCharAdded",t),o=!1;break;case f.ARROW_UP:n=this.document.ManagerSpecialActions("ARROW_UP",t),o=!1;break;case f.ARROW_DOWN:n=this.document.ManagerSpecialActions("ARROW_DOWN",t),o=!1;break;case f.ARROW_LEFT:n=this.document.ManagerSpecialActions("ARROW_LEFT",t),o=!1;break;case f.ARROW_RIGHT:n=this.document.ManagerSpecialActions("ARROW_RIGHT",t),o=!1;break;case f.SHIFT_ARROW_UP:n=this.document.ManagerSpecialActions("SHIFT_ARROW_UP",t),o=!1;break;case f.SHIFT_ARROW_DOWN:n=this.document.ManagerSpecialActions("SHIFT_ARROW_DOWN",t),o=!1;break;case f.SHIFT_ARROW_LEFT:n=this.document.ManagerSpecialActions("SHIFT_ARROW_LEFT",t),o=!1;break;case f.SHIFT_ARROW_RIGHT:n=this.document.ManagerSpecialActions("SHIFT_ARROW_RIGHT",t),o=!1;break;case f.SHIFT_DOWN:n=this.document.ManagerSpecialActions("SHIFT_DOWN",t),o=!1;break;case f.SHIFT_UP:n=this.document.ManagerSpecialActions("SHIFT_UP",t),o=!1;break;case f.SELECT_ALL:n=this.document.ManagerSpecialActions("SELECT_ALL",t),o=!1;break;case f.ESC:n=this.document.ManagerSpecialActions("ESC",t),o=!1;break;case f.BOLD:this.ToggleStyleOnSelection("bold",void 0),o=n=!1;break;case f.ITALIC:this.ToggleStyleOnSelection("italic",void 0),o=n=!1;break;case f.UNDERLINED:this.ToggleStyleOnSelection("underlined",void 0),o=n=!1;break;case f.SELECTION_CHANGED:this.document.ManagerSpecialActions("SELECTION_CHANGED"),o=!1;break;default:return}return o&&(this.FireDocChanged(),this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition())),n}},{key:"Undo",value:function(){var e=this.historyManager.GetUndo();this.document.LoadContent(e.content,!1),this.document.SetCursorPosition(e.cursorPosition),this.FireStyleMonitoring(),this.FireDocChanged()}},{key:"Redo",value:function(){var e=this.historyManager.GetRedo();this.document.LoadContent(e.content,!1),this.document.SetCursorPosition(e.cursorPosition),this.FireStyleMonitoring(),this.FireDocChanged()}},{key:"InsertCharacter",value:function(e){return this.charAdded=!0,this.document.InsertCharacter(e)}},{key:"Focus",value:function(){this.document.Focus()}},{key:"FocusAtTheEnd",value:function(){this.document.FocusAtTheEnd()}},{key:"isContentEmpty",value:function(){return this.document.isContentEmpty()}},{key:"DoneInsertCharacter",value:function(e){this.charAdded&&(this.charAdded=!1," "==e?(this.useAutocorrect&&this.Autocorrect(),this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition())):this.historyManager.PushChar(this.document.GetContent(),this.document.GetCursorPosition()),this.FireDocChanged())}},{key:"FireDocChanged",value:function(){var e=this;null!=this.onChange&&setTimeout(function(){e.onChange(e.mainContainer.innerHTML)}),this.latestCursorPosition=this.document.GetCursorPosition()}},{key:"FireStyleChanged",value:function(){var e=this.document.GetStyleAtCurrentCursorPosition();this.FireStyleMonitoring(),null!=this.onStyleChanged&&this.onStyleChanged(e)}},{key:"FireStyleMonitoring",value:function(){var e=this.document.GetStyleAtCurrentCursorPosition();null!=this.styleMonitoring&&this.styleMonitoring(e)}},{key:"ToggleStyleOnSelection",value:function(e,t){this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),this.document.ToggleStyleOnSelection(e,t),this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),this.FireDocChanged(),this.FireStyleMonitoring(),this.FireStyleChanged()}},{key:"ToggleStyleOnLine",value:function(e,t){this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),this.document.ToggleStyleOnLine(e,t),this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),this.FireDocChanged(),this.FireStyleMonitoring(),this.FireStyleChanged()}},{key:"SetContent",value:function(e){this.mainContainer.style.opacity=0,this.content=e,this.document.LoadContent(this.content),this.mainContainer.style.opacity=1}},{key:"GetContent",value:function(){return this.mainContainer.innerHTML}},{key:"GetStyleAtCarret",value:function(){return this.document.GetStyleAtCurrentCursorPosition()}},{key:"StoreCursorPosition",value:function(){this.storedCursorPosition=this.document.GetCursorPosition()}},{key:"RestoreCursorPosition",value:function(){this.document.SetCursorPosition(this.storedCursorPosition)}},{key:"SaveCursorPositonBeforeClick",value:function(){this.document.SaveCursorPositonBeforeClick()}},{key:"AppendTextAtCursor",value:function(e){this.document.AppendTextAtCursor(e,this.latestCursorPosition)}},{key:"AppendHtmlAtCursor",value:function(e){this.document.AppendHtmlAtCursor(e,this.latestCursorPosition)}},{key:"SelectionChanged",value:function(){var o=this;setTimeout(function(){var e,t,n=o.document.GetCursorPosition();null==n.idStartNode||null!=(e=o.document.GetNodeById(n.idStartNode))&&(n.startNode=e.domElement),null==n.idEndNode||null!=(t=o.document.GetNodeById(n.idEndNode))&&(n.endNode=t.domElement),n.selectionBoundingRectangle=o.document.GetSelectionBoundingClientRect(),null!=o.onSelectinChange&&o.onSelectinChange(n)},10)}},{key:"InsertPluginAtSection",value:function(e,t){this.document.InsertPluginAtSection(e,t)}},{key:"CallPluginStaticMethod",value:function(e,t,n){this.document.CallPluginStaticMethod(e,t,n)}},{key:"ManageUserShortcuts",value:function(e){var t=this.shortcutManager.Fire(e);return t&&this.document.PushToHistory(),t}},{key:"Autocorrect",value:function(){this.document.Autocorrect(this.autocorrect)}},{key:"IsolateSelectedText",value:function(){this.document.ToggleStyleOnSelection("splitSelection");var e=this.document.rootNode.domElement.querySelectorAll(".splitSelectionDummy");return this.document.ToggleStyleOnSelection("splitSelection"),e}},{key:"GetNodesByAttr",value:function(e,t){return this.document.rootNode.domElement.querySelectorAll("["+e+'="'+t+'"]')}},{key:"SetAttribute",value:function(e,t,n){var o,i=e.getAttribute("cm-id");null==i||""==i||(o=this.document.GetNodeById(i)).isTextNode()&&o.AddAttribute(t,n)}},{key:"RemoveAttribute",value:function(o,e){var i=this;this.GetNodesByAttr(o,e).forEach(function(e){var t,n=e.getAttribute("cm-id");null==n||""==n||(t=i.document.GetNodeById(n)).isTextNode()&&t.RemoveAttribute(o)})}},{key:"_debugPrintNode",value:function(e,t){var n=this;null==t&&(t="");var o="noParent";null!=e.parent&&(o=e.parent.id);var i="";null!=e.pluginName&&(i=e.pluginName);var r="noPrevious";null!=e.previous&&(r=e.previous.id),e.isTextNode()?console.log(t+e.id+" %c"+e.tagName+" %c"+e.type+" %c=> [%c"+e.text+"%c] %c"+o+" %c"+r+" %c"+i,"color:red","color:#ad0c9d","color:black","color:#129957","color:black","color:#ffffff","color:#eeeeee","color:red"):console.log(t+e.id+" %c"+e.tagName+" %c"+e.type+" %c"+o+" %c"+r+" %c"+i,"color:red","color:#ad0c9d","color:#ffffff","color:#eeeeee","color:red"),e.children.forEach(function(e){n._debugPrintNode(e,t+"   ")})}},{key:"Debug",value:function(e){var t;e?(t=this.document.rootNode,this._debugPrintNode(t)):console.log(this.document.rootNode)}},{key:"Test",value:function(){this.document.InsertPluginAtSection("image",{link:"/img/devImgTag.jpg"})}}])&&ht(e.prototype,t),n&&ht(e,n),o}();t.default=pt}],i.c=o,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i(i.s=3);function i(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var n,o});