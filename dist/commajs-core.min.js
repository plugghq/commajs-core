!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CommaJS=t():e.CommaJS=t()}(window,function(){return i={},o.m=n=[function(e,t,a){"use strict";(function(n){function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var r={polyfill:function(){var e=0<navigator.userAgent.indexOf("MSIE ")||!!navigator.userAgent.match(/Trident.*rv\:11\./)||0<navigator.userAgent.indexOf("Edge/");if(!("KeyboardEvent"in window)||"key"in KeyboardEvent.prototype&&!e)return!1;var t={get:function(){var e=r.keys[this.which||this.keyCode];return Array.isArray(e)&&(e=e[+this.shiftKey]),e},enumerable:!0,configurable:!0};return Object.defineProperty(KeyboardEvent.prototype,"key",t),t},keys:{3:"Cancel",6:"Help",8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",28:"Convert",29:"NonConvert",30:"Accept",31:"ModeChange",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",41:"Select",42:"Print",43:"Execute",44:"PrintScreen",45:"Insert",46:"Delete",48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],91:"OS",93:"ContextMenu",106:"*",107:"+",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",181:"VolumeMute",182:"VolumeDown",183:"VolumeUp",186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"'],224:"Meta",225:"AltGraph",246:"Attn",247:"CrSel",248:"ExSel",249:"EraseEof",250:"Play",251:"ZoomOut"}};function s(){var e,t=this.parentNode,n=arguments.length;if(t)for(n||t.removeChild(this);n--;)"object"!==i(e=arguments[n])?e=this.ownerDocument.createTextNode(e):e.parentNode&&e.parentNode.removeChild(e),n?t.insertBefore(this.previousSibling,e):t.replaceChild(e,this)}!function(){for(var e=1;e<25;e++)r.keys[111+e]="F"+e;var t="";for(e=65;e<91;e++)t=String.fromCharCode(e),r.keys[e]=[t.toLowerCase(),t.toUpperCase()];for(e=96;e<106;e++)t=String.fromCharCode(e-48),r.keys[e]=t;"function"==typeof define&&a(2)?define("keyboardevent-key-polyfill",r):"undefined"!=typeof exports&&void 0!==n?n.exports=r:window&&(window.keyboardeventKeyPolyfill=r)}();var e=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"Init",value:function(){r.polyfill(),Element.prototype.replaceWith||(Element.prototype.replaceWith=s),CharacterData.prototype.replaceWith||(CharacterData.prototype.replaceWith=s),DocumentType.prototype.replaceWith||(DocumentType.prototype.replaceWith=s)}}],(n=null)&&o(t.prototype,n),i&&o(t,i),e}();t.a=e}).call(this,a(1)(e))},function(e,t){e.exports=function(e){var t;return e.webpackPolyfill||((t=Object.create(e)).children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1),t}},function(t,e){(function(e){t.exports=e}).call(this,{})},function(e,t,n){"use strict";n.r(t),n.d(t,"BlockNode",function(){return G}),n.d(t,"InlineNode",function(){return K}),n.d(t,"TextNode",function(){return P}),n.d(t,"PluginActions",function(){return q}),n.d(t,"Plugin",function(){return at}),n.d(t,"NodeStyle",function(){return C}),n.d(t,"Base64",function(){return ut});var o=n(0);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.history=[],this.index=0,this.wordCounter=0}var t,n,i;return t=e,(n=[{key:"PushChar",value:function(e,t){this.wordCounter++,2<this.wordCounter&&this.Push(e,t)}},{key:"Push",value:function(e,t){this.wordCounter=0;var n={content:e,cursorPosition:t};this.history[this.index]=n,this.index++,this.history=this.history.slice(0,this.index)}},{key:"GetUndo",value:function(){this.wordCounter=0;var e=this.index-2,t={content:"",cursorPosition:0};return e<0?(e=0,this.index=1,t=this.history[e]):(t=this.history[e],this.index--),t}},{key:"GetRedo",value:function(){this.wordCounter=0;var e=this.index;e>this.history.length-1&&(e=this.history.length-1);var t=this.history[e];return this.index=e+1,t}}])&&r(t.prototype,n),i&&r(t,i),e}();function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=["Meta+1","Meta+2","Meta+3","Meta+4","Meta+5","Meta+6","Meta+7","Meta+8","Meta+9","Meta+0","Ctrl+q","Ctrl+w","Ctrl+e","Ctrl+r","Ctrl+t","Ctrl+y","Ctrl+o","Ctrl+p","Ctrl+s","Ctrl+d","Ctrl+f","Ctrl+g","Ctrl+h","Ctrl+j","Ctrl+k","Ctrl+l","Ctrl+n","Ctrl+m"],u=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.editor=e,this.shortcutsByKey={},this.SetShortcuts(t)}var e,t,i;return e=n,i=[{key:"FormatKeyboardInput",value:function(e){var t=e.key,n="";return e.metaKey&&(""==n?n="Meta":n+="+Meta"),e.ctrlKey&&(""==n?n="Ctrl":n+="+Ctrl"),e.altKey&&(""==n?n="Alt":n+="+Alt"),n+="+"+t,l.indexOf(n)<0&&(n="_protected_"),n}}],(t=[{key:"SetShortcuts",value:function(e){var n=this;this.shortcuts=e,null!=this.shortcuts&&this.shortcuts.forEach(function(e){var t={action:e.action,params:e.params};n.shortcutsByKey[e.shortcut.toLowerCase()]=t})}},{key:"Fire",value:function(e){var t,n=!1;return"_protected_"==e||null!=(t=this.shortcutsByKey[e.toLowerCase()])&&(n=!0,this._performAction(t.action,t.params)),n}},{key:"_performAction",value:function(e,t){"insertText"==e?this.editor.AppendTextAtCursor(t.text):"insertPlugin"==e?this.editor.InsertPluginAtSection(t.pluginName,t.pluginParams):"function"==e&&null!=t&&t()}}])&&a(e.prototype,t),i&&a(e,i),n}();function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d={ENTER:"enter",ESC:"esc",BACKSPACE:"backspace",DELETE:"delete",TAB:"tab",CUT:"cut",COPY:"copy",PASTE:"paste",CUR_POS_CHANGED:"cursorPositionHasChanged",AFTER_CHAR_ADDED:"afterCharacterIsAdded",ARROW_UP:"arrowUp",ARROW_DOWN:"arrowDown",ARROW_LEFT:"arrowLeft",ARROW_RIGHT:"arrowRight",SHIFT_ARROW_UP:"shiftArrowUp",SHIFT_ARROW_DOWN:"shiftArrowDown",SHIFT_ARROW_LEFT:"shiftArrowLeft",SHIFT_ARROW_RIGHT:"shiftArrowRight",SHIFT_DOWN:"SHIFT_DOWN",SHIFT_UP:"SHIFT_UP",SELECT_ALL:"SELECT_ALL",BEFORE_COPY:"BEFORE_COPY",BEFORE_CUT:"BEFORE_CUT",BEFORE_PASTE:"BEFORE_PASTE",BOLD:"BOLD",ITALIC:"ITALIC",UNDERLINED:"UNDERLINED",SELECTION_CHANGED:"SELECTION_CHANGED"},h=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=e,this.stopClipboardEvent=!1}var e,n,i;return e=t,(n=[{key:"OnClick",value:function(e){this.editor.FireStyleMonitoring(),this.editor.Fire(d.CUR_POS_CHANGED,e),this.editor.Fire(d.CLICK,e),e.preventDefault(),e.stopPropagation()}},{key:"KeyDown",value:function(e){var t=e.key;switch(t){case"Tab":this.editor.Fire(d.TAB,e)&&(e.preventDefault(),e.stopPropagation());break;case"Meta":break;case"Shift":this.editor.Fire(d.SHIFT_DOWN,e)&&(e.preventDefault(),e.stopPropagation());break;case"Alt":case"Control":break;case"Down":case"ArrowDown":(e.shiftKey?this.editor.Fire(d.SHIFT_ARROW_DOWN,e):this.editor.Fire(d.ARROW_DOWN,e))&&(e.preventDefault(),e.stopPropagation());break;case"Up":case"ArrowUp":(e.shiftKey?this.editor.Fire(d.SHIFT_ARROW_UP,e):this.editor.Fire(d.ARROW_UP,e))&&(e.preventDefault(),e.stopPropagation());break;case"Left":case"ArrowLeft":(e.shiftKey?this.editor.Fire(d.SHIFT_ARROW_LEFT,e):this.editor.Fire(d.ARROW_LEFT,e))&&(e.preventDefault(),e.stopPropagation());break;case"Right":case"ArrowRight":(e.shiftKey?this.editor.Fire(d.SHIFT_ARROW_RIGHT,e):this.editor.Fire(d.ARROW_RIGHT,e))&&(e.preventDefault(),e.stopPropagation());break;case"CapsLock":break;case"Enter":this.editor.Fire(d.ENTER,e)&&(e.preventDefault(),e.stopPropagation());break;case"Esc":case"Escape":this.editor.Fire(d.ESC,e)&&(e.preventDefault(),e.stopPropagation());break;case"Backspace":this.editor.Fire(d.BACKSPACE,e)&&(e.preventDefault(),e.stopPropagation());break;case"Delete":this.editor.Fire(d.DELETE,e)&&(e.preventDefault(),e.stopPropagation());break;default:e.metaKey&&!e.shiftKey&&"z"==t?(this.editor.Undo(),e.preventDefault(),e.stopPropagation()):e.shiftKey&&e.metaKey&&"z"==t?(this.editor.Redo(),e.preventDefault(),e.stopPropagation()):e.ctrlKey&&!e.shiftKey&&"z"==t?(this.editor.Undo(),e.preventDefault(),e.stopPropagation()):e.ctrlKey&&e.shiftKey&&"z"==t?(this.editor.Redo(),e.preventDefault(),e.stopPropagation()):(e.metaKey||e.ctrlKey)&&"a"==t?this.editor.Fire(d.SELECT_ALL,e)&&(e.preventDefault(),e.stopPropagation()):(e.metaKey||e.ctrlKey)&&"c"==t?this.stopClipboardEvent=this.editor.Fire(d.BEFORE_COPY,e):(e.metaKey||e.ctrlKey)&&"x"==t?this.stopClipboardEvent=this.editor.Fire(d.BEFORE_CUT,e):(e.metaKey||e.ctrlKey)&&"b"==t?(this.stopClipboardEvent=this.editor.Fire(d.BOLD,e),e.preventDefault(),e.stopPropagation()):(e.metaKey||e.ctrlKey)&&"i"==t?(this.stopClipboardEvent=this.editor.Fire(d.ITALIC,e),e.preventDefault(),e.stopPropagation()):(e.metaKey||e.ctrlKey)&&"u"==t?(this.stopClipboardEvent=this.editor.Fire(d.UNDERLINED,e),e.preventDefault(),e.stopPropagation()):(e.metaKey||e.ctrlKey||e.altKey)&&""!=t&&this.editor.ManageUserShortcuts(u.FormatKeyboardInput(e))&&(e.preventDefault(),e.stopPropagation()),e.metaKey||e.ctrlKey||e.altKey||""!=t&&this.editor.InsertCharacter(t)&&(e.preventDefault(),e.stopPropagation())}this.editor.Fire(d.AFTER_CHAR_ADDED,e)}},{key:"KeyUp",value:function(e){var t=e.key;switch(t){case"Meta":break;case"Shift":this.editor.Fire(d.SHIFT_UP,e)&&(e.preventDefault(),e.stopPropagation());break;case"Alt":case"Control":break;case"Down":case"ArrowDown":this.editor.FireStyleMonitoring(),this.editor.Fire(d.CUR_POS_CHANGED,e);break;case"Up":case"ArrowUp":this.editor.FireStyleMonitoring(),this.editor.Fire(d.CUR_POS_CHANGED,e);break;case"Left":case"ArrowLeft":this.editor.FireStyleMonitoring(),this.editor.Fire(d.CUR_POS_CHANGED,e);break;case"Right":case"ArrowRight":this.editor.FireStyleMonitoring(),this.editor.Fire(d.CUR_POS_CHANGED,e)}e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||""!=t&&this.editor.DoneInsertCharacter(t)}},{key:"OnPaste",value:function(e){var t=e.clipboardData.getData("text/html"),n=Array.from(e.clipboardData.files||[]);!t&&0<n.length?(null!=this.editor.onFilesPasted?this.editor.onFilesPasted(n):console.log("Files paste not supported: add onFilesPasted implementation"),e.preventDefault(),e.stopPropagation()):(this.stopClipboardEvent=this.editor.Fire(d.BEFORE_PASTE,e),(this.stopClipboardEvent||this.editor.Fire(d.PASTE,e))&&(e.preventDefault(),e.stopPropagation()),this.stopClipboardEvent=!1)}},{key:"OnCut",value:function(e){(this.stopClipboardEvent||this.editor.Fire(d.CUT,e))&&(e.preventDefault(),e.stopPropagation()),this.stopClipboardEvent=!1}},{key:"OnCopy",value:function(e){(this.stopClipboardEvent||this.editor.Fire(d.COPY,e))&&(e.preventDefault(),e.stopPropagation()),this.stopClipboardEvent=!1}}])&&c(e.prototype,n),i&&c(e,i),t}();function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.allKeys={},null!=e&&e.forEach(function(e){this.allKeys[e]=!0})}var e,n,i;return e=t,(n=[{key:"GetNew",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=!1,n="";!t;){for(var i=0;i<5;i++)n+=e.charAt(Math.floor(Math.random()*e.length));null==this.allKeys[n]&&(t=this.allKeys[n]=!0)}return n}},{key:"Release",value:function(e){delete this.allKeys[e]}},{key:"VerifyAndRegister",value:function(e){return this.allKeys[e]&&(e=this.GetNew()),this.allKeys[e]=!0,e}},{key:"Reset",value:function(){this.allKeys={}}}])&&f(e.prototype,n),i&&f(e,i),t}(),i={exampleClass:{applyAs:"class",classes:["ex1","ex2"]},margin:{applyAs:"style",name:"margin",on:"set#by#user",off:"",isToggle:!1},width:{applyAs:"style",name:"width",on:"set#by#user",off:"",isToggle:!1},height:{applyAs:"style",name:"height",on:"set#by#user",off:"",isToggle:!1},border:{applyAs:"style",name:"border",on:"set#by#user",off:"",isToggle:!1},bold:{applyAs:"style",name:"fontWeight",on:"bold",off:"normal",isToggle:!0},italic:{applyAs:"style",name:"fontStyle",on:"italic",off:"normal",isToggle:!0},underlined:{applyAs:"style",name:"textDecorationLine",on:"underline",off:"none",preserve:!0,isToggle:!0},strike:{applyAs:"style",name:"textDecorationLine",on:"line-through",off:"none",preserve:!0,isToggle:!0},fontSize:{applyAs:"style",name:"fontSize",on:"set#by#user",off:"initial",isToggle:!1},fontFamily:{applyAs:"style",name:"fontFamily",on:"set#by#user",off:"initial",isToggle:!1},fontColor:{applyAs:"style",name:"color",on:"set#by#user",off:"initial",isToggle:!1,isColor:!0},backgroundColor:{applyAs:"style",name:"backgroundColor",on:"set#by#user",off:"initial",isToggle:!1,isColor:!0},align:{applyAs:"style",name:"textAlign",on:"set#by#user",off:"left",isToggle:!0},indent:{applyAs:"style",name:"paddingLeft",step:40,preserve:!1,calculated:!0,unit:"px",on:0,off:0,isToggle:!1},lineSpacing:{applyAs:"style",name:"lineHeight",on:"set#by#user",off:"normal",isToggle:!1},horizontalRule:{applyAs:"style",name:"borderBottom",on:"1px solid #8c8c8c",off:"none"},headerOne:{applyAs:"class",classes:["headerOne"]},headerTwo:{applyAs:"class",classes:["headerTwo"]},headerThree:{applyAs:"class",classes:["headerThree"]},superscript:{applyAs:"class",classes:["scplSup"],isToggle:!0},subscript:{applyAs:"class",classes:["scplSub"],isToggle:!0},splitSelection:{applyAs:"class",classes:["splitSelectionDummy"]},quote:{applyAs:"class",classes:["commaQuoteContainer"],isToggle:!0}};function y(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function g(o){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?y(Object(r),!0).forEach(function(e){var t,n,i;t=o,i=r[n=e],n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(r,e))})}return o}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function v(e,t,n){var i,o;return e.classList?n?e.classList.toggle(t,!0):e.classList.toggle(t):0<=(o=(i=e.className.split(" ")).indexOf(t))&&!n?i.splice(o,1):(i.push(t),e.className=i.join(" ")),e}var C=function(){function f(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),this.document=e,null!=t&&(t=JSON.parse(JSON.stringify(t))),this.styles=t,null==this.styles&&(this.styles={}),this.additionalStyles={},this.additionalClasses={}}var e,t,n;return e=f,n=[{key:"GetAllStyles",value:function(e){var t=i;return null!=e.allStyles&&(t=g(g({},i),e.allStyles)),t}},{key:"cssNameToJsName",value:function(e){for(var t=e.split("-"),n="",i=0;i<t.length;i++)0<i&&0<t[i].length&&(1!=i||"ms"!=t[i])&&(t[i]=t[i].substr(0,1).toUpperCase()+t[i].substr(1)),n+=t[i];return n}},{key:"jsNameToCssName",value:function(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}},{key:"ParseDefaultFormat",value:function(e,n){var i=new f(e);return null!=n&&Object.keys(n).forEach(function(e){var t=n[e];t&&i.Toggle(e,t)}),i}},{key:"parseStyle",value:function(e){var t={};if(3!=e.nodeType&&8!=e.nodeType&&null!=e.getAttribute("cm-plugin"))for(var n=0,i=e.style.length;n<i;n++){var o=e.style[n].replace(/-([a-z])/g,function(e){return e[1].toUpperCase()}),r=e.style[o];t[o]=r}return t}},{key:"CalculateStylesForExternalHTML",value:function(e,t){var n=window.getComputedStyle(t),i=f.GetAllStyles(e),o=Object.keys(i),r={},s=new f(e);o.forEach(function(e){var t;"height"==e.toLowerCase()||"width"==e.toLowerCase()||"style"==(t=JSON.parse(JSON.stringify(i[e]))).applyAs&&(r[t.name]=e)});for(var a=n.length;a--;){var l,u,c=n[a],d=n.getPropertyValue(c),h=r[f.cssNameToJsName(c)];null==h||""==h||null!=(l=JSON.parse(JSON.stringify(i[h])))&&("set#by#user"==l.on?(l.on=d,s.styles[h]=l):l.preserve?d.indexOf(l.on)<0||(s.styles[h]=l):(l.calculated?(u=null!=(u=d.replace(l.unit,""))&&""!=u?parseInt(u):0,l.on=u):l.on==d||(l.on=d),s.styles[h]=l))}return s}},{key:"CalculateStyles",value:function(e,a){var l=f.parseStyle(a),u=new f(e),c=f.GetAllStyles(e);return Object.keys(c).forEach(function(e){var t,n,i,o,r,s=JSON.parse(JSON.stringify(c[e]));"style"==s.applyAs?null==a.style||null!=(t=a.style[s.name])&&""!=t&&(null!=l[s.name]&&delete l[s.name],"set#by#user"==s.on?(s.on=t,u.styles[e]=s):s.preserve?t.indexOf(s.on)<0||(u.styles[e]=s):s.calculated?(n=null!=(n=t.replace(s.unit,""))&&""!=n?parseInt(n):0,s.on=n,u.styles[e]=s):s.on==t&&(u.styles[e]=s)):"class"==s.applyAs&&(a.classList?(i=!0,s.classes.forEach(function(e){a.classList.contains(e)||(i=!1)}),i&&(u.styles[e]=s)):null!=a.className&&(o=a.className.split(" "),r=!0,s.classes.forEach(function(e){o.indexOf(e)<0&&(r=!1)}),r&&(u.styles[e]=s)))}),u.additionalStyles=l,u.additionalClasses={},u}}],(t=[{key:"isEmpty",value:function(){var e=!1,t=Object.keys(this.styles).length,n=Object.keys(this.additionalStyles).length,i=Object.keys(this.additionalStyles).length;return 0==t&&0==n&&0==i&&(e=!0),e}},{key:"toStringForStyleTag",value:function(){var o="",r=this,e=Object.keys(this.styles),s={};return e.forEach(function(e){var t,n,i=r.styles[e];"style"==i.applyAs&&(i.preserve?(null==s[i.name]&&(s[i.name]=[]),s[i.name].push(i)):(t=i.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=i.on,o=o+t+": "+n.replace(/"/g,"'")+";"))}),Object.keys(s).forEach(function(e){var t=s[e],n="",i="";t.forEach(function(e){"style"==e.applyAs&&e.preserve&&(n=e.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=""==i?e.on:i+" "+e.on)}),o=o+n+": "+i.replace(/"/g,"'")+";"}),o}},{key:"toStringForClassTag",value:function(){var n="",i=this;return Object.keys(this.styles).forEach(function(e){var t=i.styles[e];"class"==t.applyAs&&t.classes.forEach(function(e){n=""==n?e:n+" "+e})}),n}},{key:"toJSON",value:function(){return{style:this.styles}}},{key:"Copy",value:function(){var e=new f(this.document);return e.styles=JSON.parse(JSON.stringify(this.styles)),e.additionalStyles=JSON.parse(JSON.stringify(this.additionalStyles)),e.additionalClasses=JSON.parse(JSON.stringify(this.additionalClasses)),e}},{key:"Equals",value:function(i){var o=!0,r=this,t=Object.keys(i.styles),e=Object.keys(r.styles);return t.length!=e.length?o=!1:(e.forEach(function(e){t.indexOf(e)<0&&(o=!1)}),o&&e.every(function(e){var t=r.styles[e],n=i.styles[e];return t.on!=n.on&&(o=!1,t.isColor&&n.isColor&&r.AreSameColors(t.on,n.on)&&(o=!0)),o})),o}},{key:"AreSameColors",value:function(e,t){return(e=this._parseColor(e))==(t=this._parseColor(t))}},{key:"_parseColor",value:function(e){var t,n=e;return null!=e&&(-1<e.toLowerCase().indexOf("rgb")||-1<e.toLowerCase().indexOf("rgba"))&&(t=(e=e.toLowerCase()).split("(")[1].split(")")[0].split(","),n="#"+this._rgbToHex(t[0].split(" ").join(""))+this._rgbToHex(t[1].split(" ").join(""))+this._rgbToHex(t[2].split(" ").join(""))),n}},{key:"_rgbToHex",value:function(e){var t=Number(e).toString(16);return t.length<2&&(t="0"+t),t}},{key:"isAlreadyApplied",value:function(e){var t=f.GetAllStyles(this.document);if(null==t[e])return console.log("Unknown style: "+e),!1;var n=JSON.parse(JSON.stringify(t[e])),i=!1;return"style"==n.applyAs?null!=this.styles[e]&&(i="set#by#user"!=n.on):"class"==n.applyAs&&null!=this.styles[e]&&(i=!0),i}},{key:"Apply",value:function(o){var r=this;o.style="",Object.keys(r.styles).forEach(function(e){var t,n,i=r.styles[e];"style"==i.applyAs?"set#by#user"==i.on?o.style[i.name]=i.on:i.preserve?(t=o.style[i.name],n="",t.split(" ").forEach(function(e){e!=i.on&&"none"!=e&&(n+=" "+e)}),n+=" "+i.on,o.style[i.name]=n):i.calculated?o.style[i.name]=i.on.toString()+i.unit:o.style[i.name]=i.on:"class"==i.applyAs&&i.classes.forEach(function(e){o=v(o,e,!0)})}),Object.keys(r.additionalStyles).forEach(function(e){o.style[e]=r.additionalStyles[e]})}},{key:"Toggle",value:function(e,t,n){var i=2<arguments.length&&void 0!==n&&n,o=f.GetAllStyles(this.document);if(null==o[e])return console.log("Unknown style: "+e),!1;var r=JSON.parse(JSON.stringify(o[e])),s=!0;return this.isAlreadyApplied(e)&&!i?(s=!1,delete this.styles[e]):"style"==r.applyAs?("set#by#user"==r.on&&(r.on=t),this.styles[e]=r):"class"==r.applyAs&&(this.styles[e]=r),s}},{key:"CalculateStyle",value:function(e,t){return"style"==e.applyAs&&e.calculated&&("add"==t?e.on=e.on+e.step:"subtract"==t&&(e.on=e.on-e.step,e.on<e.off&&(e.on=e.off))),e}},{key:"ToggleOnDomElement",value:function(t,e,n,i){var o=3<arguments.length&&void 0!==i&&i,r=f.GetAllStyles(this.document);if(null==r[e])return console.log("Unknown style: "+e),!1;if(null==r[e])throw"Style '"+e+"' is not defined";var s,a,l,u,c,d=JSON.parse(JSON.stringify(r[e])),h=!0;return this.isAlreadyApplied(e)&&!o?(h=!1,"style"==d.applyAs?"set#by#user"==d.on?t.style[d.name]=d.off:d.calculated?(null==(s=this.styles[e])&&(s=JSON.parse(JSON.stringify(d))),s=this.CalculateStyle(s,n),t.style[d.name]=s.on.toString()+s.unit):(d.preserve?(a=t.style[d.name],l="",a.split(" ").forEach(function(e){e!=d.on&&(l+=" "+e)}),""==l&&(l+=" "+d.off),t.style[d.name]=l):t.style[d.name]=d.off,delete this.styles[e]):"class"==d.applyAs&&(delete this.styles[e],d.classes.forEach(function(e){t=v(t,e)}))):"style"==d.applyAs?("set#by#user"==d.on?((d=JSON.parse(JSON.stringify(d))).on=n,t.style[d.name]=n):d.preserve?(u=t.style[d.name],c="",u.split(" ").forEach(function(e){e!=d.on&&"none"!=e&&(c+=" "+e)}),c+=" "+d.on,t.style[d.name]=c):d.calculated?(d=this.CalculateStyle(d,n),t.style[d.name]=d.on.toString()+d.unit):t.style[d.name]=d.on,this.styles[e]=d):"class"==d.applyAs&&(d.classes.forEach(function(e){t=v(t,e)}),this.styles[e]=d),h}}])&&m(e.prototype,t),n&&m(e,n),f}();function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var E={BLOCK:"block",INLINE:"inline",TEXT:"text"},S=function(){function r(e,t,n,i){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),null==o&&(o=new C(e)),this.document=e,this.id=t,this.tagName=n,this.type=i,this.nodeStyle=o,this.attributes=[],this.children=[],this.previous=void 0,this.next=void 0,this.parent=void 0,this.domElement=void 0}var e,t,n;return e=r,(t=[{key:"AddAttribute",value:function(e,t){var n={name:e,value:t};this.attributes.push(n),null!=this.domElement&&this.domElement.setAttribute(e,t)}},{key:"GetAttribute",value:function(t){var e,n=void 0;return this.attributes.forEach(function(e){e.name==t&&(n=e.value)}),null!=n||null!=(e=this.domElement.getAttribute(t))&&(n=e),n}},{key:"RemoveAttribute",value:function(t){var n=this,i=[];this.attributes.forEach(function(e){e.name==t?null!=n.domElement&&n.domElement.removeAttribute(t):i.push(e)}),this.attributes=i}},{key:"_isType",value:function(e){var t=!1;return this.type==e&&(t=!0),t}},{key:"isBlockNode",value:function(){return this._isType(E.BLOCK)}},{key:"isInlineNode",value:function(){return this._isType(E.INLINE)}},{key:"isTextNode",value:function(){return this._isType(E.TEXT)}},{key:"IsStyleApplied",value:function(e){return this.nodeStyle.isAlreadyApplied(e)}},{key:"ToggleStyle",value:function(e,t,n,i){var o=!(2<arguments.length&&void 0!==n)||n,r=3<arguments.length&&void 0!==i&&i;return null!=this.nodeStyle&&null!=this.nodeStyle.styles||(this.nodeStyle=new C(this.document)),o?this.nodeStyle.ToggleOnDomElement(this.domElement,e,t,r):this.nodeStyle.Toggle(e,t,r)}},{key:"GetBlockContainer",value:function(){return this.isBlockNode()?this:this.parent.GetBlockContainer()}},{key:"SetPluginType",value:function(e){this.pluginName=e,this.domElement.setAttribute("cm-plugin",e)}},{key:"RemovePluginType",value:function(){this.pluginName="",this.domElement.removeAttribute("cm-plugin")}},{key:"GetPluginType",value:function(){return this.pluginName}},{key:"Delete",value:function(e){e?this.document.DeleteNode(this):this.document.DeleteNode(this,!0)}},{key:"Contains",value:function(t){var n=!1;return null!=this.children&&this.children.forEach(function(e){n=n||(e.id==t||e.Contains(t))}),n}}])&&N(e.prototype,t),n&&N(e,n),r}();function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(r){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,i,o=k(r);return t=s?(e=k(this).constructor,Reflect.construct(o,arguments,e)):o.apply(this,arguments),n=this,!(i=t)||"object"!==T(i)&&"function"!=typeof i?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(n):i}}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var P=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(l,S);var e,t,n,a=x(l);function l(e,t,n,i,o){var r,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:[];return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(r=a.call(this,e,t,n,E.TEXT,i)).attributes=s,null==o&&(o=""),r.text=o,r.GenerateDomElement(),r}return e=l,n=[{key:"CreateNew",value:function(e,t,n,i,o){var r=new l(e,e.GenereateNewNodeId(),t,i,n,o);return e.RegisterNode(r),r}}],(t=[{key:"Copy",value:function(){return new l(this.document,"",this.tagName,this.nodeStyle.Copy(),this.text,JSON.parse(JSON.stringify(this.attributes)))}},{key:"Append",value:function(){throw new Exception("Text nodes cannot contain any other node")}},{key:"GenerateDomElement",value:function(){this.domElement=void 0;var t=document.createElement(this.tagName);t.setAttribute("cm-id",this.id),t.setAttribute("cm-type",this.type),this.attributes.forEach(function(e){""!=e.name&&t.setAttribute(e.name,e.value)}),""==this.text?t.appendChild(document.createTextNode("\ufeff")):t.appendChild(document.createTextNode(this.text)),this.domElement=t,null!=this.nodeStyle&&this.nodeStyle.Apply(this.domElement)}},{key:"ApplyNodeStyle",value:function(e){null!=e&&(this.nodeStyle=e,this.nodeStyle.Apply(this.domElement))}},{key:"SetAttributes",value:function(e){var t=this;this.attributes=e,this.attributes.forEach(function(e){""!=e.name&&t.domElement.setAttribute(e.name,e.value)})}},{key:"AddAttribute",value:function(e,t){var n={name:e,value:t};this.attributes.push(n),this.domElement.setAttribute(n.name,n.value)}},{key:"RemoveAttribute",value:function(t){var n=[];this.attributes.forEach(function(e){e.name!=t&&n.push(e)}),this.attributes=n,this.domElement.removeAttribute(t)}},{key:"SetFocusAtTheEnd",value:function(){this.SetCarretAtTheEnd()}},{key:"SetCarretAtTheEnd",value:function(){this.SelectText(this.text.length,this.text.length)}},{key:"SelectText",value:function(e,t){var n,i;e==t?this.SetFocus(e):(n=window.getSelection(),(i=document.createRange()).setStart(this.domElement.firstChild,e),i.setEnd(this.domElement.firstChild,t),n.removeAllRanges(),n.addRange(i))}},{key:"SetFocus",value:function(e){null==e&&(e=0),""==this.text&&(e=1);var t=document.createRange(),n=window.getSelection();if(null!=this.domElement.firstChild){this.domElement.firstChild.length<e&&(e=this.domElement.firstChild.length),t.setStart(this.domElement.firstChild,e),t.collapse(!0),n.removeAllRanges();try{n.addRange(t)}catch(e){console.log(e)}}}},{key:"HasSameStyle",value:function(e){return this.nodeStyle.Equals(e.nodeStyle)}},{key:"HasSameAttributes",value:function(e){var t,n=!0,i=e.attributes;return this.attributes.length!=i.length?n=!1:(t={},i.forEach(function(e){t[e.name]=e.value}),this.attributes.forEach(function(e){(null==t[e.name]||t[e.name]!=e.value)&&(n=!1)})),n}},{key:"SetZeroWidthChar",value:function(){this.text="",this.domElement.removeChild(this.domElement.firstChild),this.domElement.appendChild(document.createTextNode("\ufeff"))}},{key:"TrimTextContent",value:function(e,t){this.ForceTextContent(this.text.substring(e,t))}},{key:"DeleteText",value:function(e,t){var n,i,o,r;"string"!=typeof this.text&&(this.text=JSON.stringify(this.text)),""==this.text||(0==e&&t==this.text.length?this.text="":e==t||(0<e?t<this.text.length?(n=this.text.substring(0,e),this.text.substring(e,t),i=this.text.substring(t,this.text.length),this.text=n+i):t==this.text.length&&(o=this.text.substring(0,e),this.text.substring(e,t),this.text=o):0==e&&t<this.text.length&&(this.text.substring(e,t),r=this.text.substring(t,this.text.length),this.text=r)))}},{key:"RemoveCharAt",value:function(e,t){var n=this.domElement.textContent.replace(/[\u200B-\u200D\uFEFF]/g,"");this.text=n.slice(0,e)+n.slice(e+1),null!=t&&t&&this.ForceTextContent(this.text)}},{key:"AppendTextContent",value:function(e){this.text=this.text+e,this.ForceTextContent(this.text)}},{key:"ForceTextContent",value:function(e){this.text=e,""==this.text?(this.domElement.removeChild(this.domElement.firstChild),this.domElement.appendChild(document.createTextNode("\ufeff"))):(this.domElement.removeChild(this.domElement.firstChild),this.domElement.appendChild(document.createTextNode(this.text)))}},{key:"ForceInsertString",value:function(e){var t,n;""==this.text?(this.text=e,this.domElement.textContent=this.text,this.SetFocus(e.length)):null!=e&&""!=e&&(t=document.getSelection().getRangeAt(0).startOffset,n=this.domElement.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""),this.text=[n.slice(0,t),e,n.slice(t)].join(""),"\n"==e&&""==n.slice(t)&&(this.text=this.text+" "),this.domElement.textContent=this.text,this.SetFocus(t+e.length))}},{key:"InsertCharacter",value:function(e){var t,n,i,o,r,s,a=!1;return""==this.text?(" "==e&&(e=" "),t=document.createTextNode(e),this.domElement.removeChild(this.domElement.firstChild),this.domElement.appendChild(t),(i=(n=document.getSelection()).getRangeAt(0)).selectNodeContents(this.domElement.firstChild),i.collapse(),n.removeAllRanges(),n.addRange(i),a=!0,this.text=this.domElement.textContent.replace(/[\u200B-\u200D\uFEFF]/g,"")):(null==e&&(e=""),o=document.getSelection().getRangeAt(0),r=this.domElement.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""),s=o.startOffset,this.text=[r.slice(0,s),e,r.slice(s)].join(""),a=!1),a}},{key:"Split",value:function(e,t){var n,i,o,r,s,a,l,u,c,d,h,f,p,y,g,m,v,C,N,E,S,T,b,A=[];return""==this.text||0==e&&t==this.text.length?A.push(this):e==t?0==e?((n=this.Copy()).text="",A.push(n),i=this.Copy(),A.push(i)):e==this.text.length?(o=this.Copy(),A.push(o),(r=this.Copy()).text="",A.push(r)):(s=this.text.substring(0,e),a=this.text.substring(e,this.text.length),(l=this.Copy()).text=s,A.push(l),(u=this.Copy()).text="",A.push(u),(c=this.Copy()).text=a,A.push(c)):0<e?t<this.text.length?(d=this.text.substring(0,e),h=this.text.substring(e,t),f=this.text.substring(t,this.text.length),(p=this.Copy()).text=d,A.push(p),(y=this.Copy()).text=h,A.push(y),(g=this.Copy()).text=f,A.push(g)):t==this.text.length&&(m=this.text.substring(0,e),v=this.text.substring(e,t),(C=this.Copy()).text=m,A.push(C),(N=this.Copy()).text=v,A.push(N)):0==e&&t<this.text.length&&(E=this.text.substring(e,t),S=this.text.substring(t,this.text.length),(T=this.Copy()).text=E,A.push(T),(b=this.Copy()).text=S,A.push(b)),A}},{key:"Merge",value:function(t,e){if(!t.isTextNode())throw console.log("87-16"),"Fatal error: 87-16";var n,i,o,r=this;null==e?r.text=r.text+t.text:(n=r.text,i=t.text,r.text=[n.slice(0,e),i,n.slice(e)].join("")),r.ForceTextContent(r.text),r.next=t.next,t.domElement.remove(),this.document.UnregisterNode(t),null!=t.parent&&(o=[],t.parent.children.forEach(function(e){e.id!=t.id&&o.push(e)}),t.parent.children=o)}},{key:"ChangeTagName",value:function(e){this.tagName=e;for(var t=this.domElement,n=document.createElement(e),i=0,o=t.attributes.length;i<o;++i){var r=t.attributes.item(i).nodeName,s=t.attributes.item(i).nodeValue;n.setAttribute(r,s)}for(;t.hasChildNodes();)n.appendChild(t.removeChild(t.firstChild));t.parentNode.replaceChild(n,t),this.domElement=n}}])&&b(e.prototype,t),n&&b(e,n),l}();function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _=function(){function g(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),this.document=e}var e,t,n;return e=g,n=[{key:"PrintToConsole",value:function(e,t){var n=new g(e);t?n._debugPrintNode(n.document.rootNode):console.log(n.document.rootNode)}},{key:"DeleteNodesBetween",value:function(e,t,n){return new g(e)._DeleteNodesBetween(t,n)}},{key:"GetAllTextNodes",value:function(e,t,n,i){return new g(e)._getAllTextNodes(t,n,i)}},{key:"InsertNodeAtCursor",value:function(e,t){e.selectionManager.IsCollapsed()||e.DeleteSelection();var n,i,o=e.selectionManager.GetCurrent(),r=o.startNode,s=o.startOffset,a=o.endOffset;r.isTextNode()&&(n=[],2==(i=r.Split(s,a)).length?0==s?(t.isInlineNode()&&n.push(P.CreateNew(e,"span","",r.nodeStyle.Copy())),n.push(t),n.push(i[1])):(n.push(i[0]),n.push(t)):3==i.length?(n.push(i[0]),n.push(t),n.push(i[2])):1==i.length&&(t.isInlineNode()&&n.push(P.CreateNew(e,"span","",r.nodeStyle.Copy())),n.push(t)),g.ReplaceNode(e,r,n,!1,!0,r.nodeStyle.Copy()),t.next.SetFocus())}},{key:"ReplaceNode",value:function(n,i,o,r,e,s){var a=n;null==r&&(r=!1);var l,u,c,d,t,h,f,p=i.parent,y=!0;(null==p||1==o.length&&o[0].id==i.id)&&(y=!1),y&&(u=void 0,d=c=!(l=[]),p.children.forEach(function(e){var t;e.id==i.id?(o.forEach(function(e){var t;e.id=a.GenereateNewNodeId(),e.GenerateDomElement(),null!=u&&(u.next=e,u.isInlineNode()&&e.isInlineNode()&&((t=P.CreateNew(n,"span","",s.Copy())).previous=u,t.parent=u.parent,u.next=t,u.domElement.parentNode.insertBefore(t.domElement,u.domElement.nextSibling),l.push(t),u=t)),e.previous=u,e.next=void 0,e.parent=p,e.document=p.document,u=e,l.push(e),a.RegisterNode(e)}),c=!0,r&&(d=!0)):d||(c&&(null!=u&&(u.isInlineNode()&&e.isInlineNode()?(null==s&&(s=n.GetDefaultNodeStyle()),(t=P.CreateNew(n,"span","",s.Copy())).previous=u,t.parent=u.parent,u.next=t,u=t,e.domElement.parentNode.insertBefore(t.domElement,e.domElement),l.push(t)):u.next=e),e.previous=u,c=!1),null!=(u=e).next&&e.next.id==i.id&&(e.next=void 0),l.push(e))}),p.children=l,t=!0,h=void 0,o.forEach(function(e){h=(t?(t=!1,i.domElement.replaceWith(e.domElement)):h.domElement.parentNode.insertBefore(e.domElement,h.domElement.nextSibling),e)}),t&&i.domElement.remove(),a.UnregisterNode(i),e?(f=P.CreateNew(n,"span","",s.Copy()),p.Append(f)):p.isBlockNode()&&0==p.children?g.ReplaceNode(n,p,[],r):i.isBlockNode()&&i.children.forEach(function(e){g.ReplaceNode(n,e,[])}))}}],(t=[{key:"_debugPrintNode",value:function(e,t){var n=this;null==t&&(t=""),e.isTextNode()?console.log(t+e.id+" "+e.tagName+" %c"+e.type+" %c=> [%c"+e.text+"%c]","color:#ad0c9d","color:black","color:#129957","color:black"):console.log(t+e.id+" "+e.tagName+" %c"+e.type,"color:#ad0c9d"),e.children.forEach(function(e){n._debugPrintNode(e,t+"   ")})}},{key:"_recursive_getAllTextNodes",value:function(e){var t;this.adding?this.toNode.id==e.id?(this.adding=!1,this.includeFromAndToInResults&&e.isTextNode()&&this.opResults.push(e),this.completed=!0):e.isTextNode()&&this.opResults.push(e):this.fromNode.id==e.id&&(this.adding=!0,this.includeFromAndToInResults&&e.isTextNode()&&this.opResults.push(e)),this.completed||(t=this,e.children.every(function(e){return t._recursive_getAllTextNodes(e),!t.completed}))}},{key:"_getAllTextNodes",value:function(e,t,n){this.fromNode=e,this.toNode=t,this.includeFromAndToInResults=n,this.adding=!1,this.completed=!1,this.opResults=[];var i=this;return this.document.rootNode.children.every(function(e){return i._recursive_getAllTextNodes(e),!i.completed}),this.opResults}},{key:"_deleteNode_DNB",value:function(e){var n=[],i=this;e.children.forEach(function(e){var t=!0;e.id==i.fromNode.id?i.deleting=!0:e.id==i.toNode.id?(i.deleting=!1,i.doneDeleting=!0):i.deleting?t=!i._deleteNode_DNB(e):i.doneDeleting||i._deleteNode_DNB(e),t&&n.push(e)});return i.deleting&&0==n.length?(e.domElement.remove(),i.document.UnregisterNode(e),null!=e.previous&&(e.previous.next=e.next),null!=e.next&&(e.next.previous=e.previous),!0):(e.children=n,!1)}},{key:"_DeleteNodesBetween",value:function(e,t){this.fromNode=e,this.toNode=t,this.deleting=!1,this.doneDeleting=!1,this._deleteNode_DNB(this.document.rootNode)}}])&&O(e.prototype,t),n&&O(e,n),g}();function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var F=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e}var e,n,i;return e=t,(n=[{key:"GetRange",value:function(e){null==e&&(e=document.getSelection());var t=void 0;return e.rangeCount?t=e.getRangeAt(0):(t=document.createRange()).collapse(!0),t}},{key:"GetStartNode",value:function(e){var t;null==e&&(t=document.getSelection(),e=this.GetRange(t));var n=e.startContainer.parentNode;if(null!=n){var i=n.getAttribute("cm-id");return this.document.GetNodeById(i)}}},{key:"GetEndNode",value:function(e){var t;null==e&&(t=document.getSelection(),e=this.GetRange(t));var n=e.startContainer.parentNode.getAttribute("cm-id");return this.document.GetNodeById(n)}},{key:"IsCollapsed",value:function(){return document.getSelection().isCollapsed}},{key:"GetBoundingClientRect",value:function(){var e=document.getSelection(),t=this.GetRange(e),n=t.getBoundingClientRect(),i=navigator.userAgent.toLowerCase();return-1!=i.indexOf("safari")&&(-1<i.indexOf("chrome")||(n=t.getClientRects()[0])),n}},{key:"GetCurrent",value:function(){var e,t,n,i=document.getSelection(),o=this.GetRange(i),r=o.startContainer.parentNode,s=o.startOffset,a=o.endContainer.parentNode,l=o.endOffset,u={hasFocus:!1,startNode:void 0,startOffset:0,endNode:void 0,endOffset:0};return null!=r&&null!=a&&(e=r.getAttribute("cm-id"),t=a.getAttribute("cm-id"),n=this.document.GetNodeById(e),u={hasFocus:null!=r&&null!=n?!0:!1,startNode:n,startOffset:s,endNode:this.document.GetNodeById(t),endOffset:l}),u}},{key:"SelectText",value:function(e,t,n,i){var o=window.getSelection(),r=document.createRange();r.setStart(e.domElement.firstChild,t),r.setEnd(n.domElement.firstChild,i),o.removeAllRanges(),o.addRange(r)}},{key:"_parents",value:function(e){for(var t=[e];e;e=e.parent)t.unshift(e);return t}},{key:"FindCommonNodeContainer",value:function(e,t){var n=this._parents(e),i=this._parents(t);if(n[0].id!=i[0].id)throw"No common ancestor";for(var o=0;o<n.length;o++)if(n[o].id!=i[o].id)return n[o-1]}},{key:"GetSelectedLines",value:function(){var t,n,e,i,o=this.GetCurrent(),r=[];return o.hasFocus&&(t=o.startNode,n=o.endNode,null!=t&&null==n?n=t:null==t&&null!=n&&(t=n),this.IsCollapsed()||t.parent.id==n.parent.id?r.push(t.GetBlockContainer()):t.isTextNode()&&n.isTextNode()&&(e=this.FindCommonNodeContainer(t,n),i=!1,e.children.forEach(function(e){e.Contains(t.id)?(i=!0,r.push(e)):i&&(r.push(e),e.Contains(n.id)&&(i=!1))}))),r}},{key:"GetSelectedTextNodes",value:function(){var e,t,n,i=[];return document.getSelection().isCollapsed||(t=(e=this.GetCurrent()).startNode,e.startOffset,n=e.endNode,e.endOffset,(i=_.GetAllTextNodes(this.document,t,n,!1)).unshift(t),n.id!=t.id&&i.push(n)),i}},{key:"_extractSelection",value:function(e,t,n){var i=e.Split(t,n);return 1==i.length?e:(_.ReplaceNode(this.document,e,i),2==i.length&&0==t?i[0]:i[1])}},{key:"IsolateAndReturnSelectedTextNodes",value:function(){var t=[];if(!document.getSelection().isCollapsed){var e,n,i,o,r=this.GetCurrent(),s=r.startNode,a=r.startOffset,l=r.endNode,u=r.endOffset;if(!s.isTextNode()||!l.isTextNode())return void console.log("#84-22");s.id==l.id?(e=this._extractSelection(s,a,u),t.push(e)):(n=_.GetAllTextNodes(this.document,s,l,!1),i=this._extractSelection(s,a,s.text.length),t.push(i),n.forEach(function(e){t.push(e)}),o=this._extractSelection(l,0,u),t.push(o))}return t}},{key:"_getNextTextNode",value:function(e){return null==e.next?this._getNextTextNode(e.parent):e.next.isTextNode()?e.next:this._getNextTextNode(e.next.parent)}},{key:"VerifyCursorPosition",value:function(){}}])&&w(e.prototype,n),i&&w(e,i),t}();function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(r){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,i,o=M(r);return t=s?(e=M(this).constructor,Reflect.construct(o,arguments,e)):o.apply(this,arguments),n=this,!(i=t)||"object"!==I(i)&&"function"!=typeof i?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(n):i}}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var G=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(u,S);var e,t,n,l=L(u);function u(e,t,n,i){var o,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[],s=5<arguments.length&&void 0!==arguments[5]&&arguments[5],a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(o=l.call(this,e,t,n,E.BLOCK,i)).attributes=r,o.hasTextContent=s,o.textContent=a,o.GenerateDomElement(),o.firstTextNode=void 0,o.lastTextNode=void 0,o}return e=u,n=[{key:"CreateNew",value:function(e,t,n,i,o,r){var s=4<arguments.length&&void 0!==o&&o,a=5<arguments.length&&void 0!==r?r:"",l=new u(e,e.GenereateNewNodeId(),t,n,i,s,a);return e.RegisterNode(l),l}}],(t=[{key:"Copy",value:function(){var t=new u(this.document,this.document.GenereateNewNodeId(),this.tagName,this.nodeStyle.Copy(),this.attributes,this.hasTextContent,this.textContent);return t.firstTextNode=this.firstTextNode,t.lastTextNode=this.lastTextNode,t.GenerateDomElement(),this.children.forEach(function(e){t.Append(e.Copy())}),t}},{key:"UpdateTextContent",value:function(e){this.hasTextContent=!0,this.textContent=e,this.domElement.setAttribute("cm-has-text-content",!0),this.domElement.textContent=this.textContent}},{key:"GenerateDomElement",value:function(){this.domElement=void 0;var t=document.createElement(this.tagName);t.setAttribute("cm-id",this.id),t.setAttribute("cm-type",this.type),this.attributes.forEach(function(e){""!=e.name&&t.setAttribute(e.name,e.value)}),this.domElement=t,this.hasTextContent&&(t.setAttribute("cm-has-text-content",!0),this.domElement.textContent=this.textContent),null!=this.nodeStyle&&this.nodeStyle.Apply(this.domElement)}},{key:"ChangeTagName",value:function(e){this.tagName=e;var t=document.createElement(this.tagName);t.setAttribute("cm-id",this.id),t.setAttribute("cm-type",this.type),this.attributes.forEach(function(e){""!=e.name&&t.setAttribute(e.name,e.value)}),this.children.forEach(function(e){t.appendChild(e.domElement)}),this.hasTextContent&&(t.setAttribute("cm-has-text-content",!0),this.domElement.textContent=this.textContent),null!=this.nodeStyle&&this.nodeStyle.Apply(t),this.domElement.parentNode.replaceChild(t,this.domElement),this.domElement=t}},{key:"SetAttributes",value:function(e,t){var n,i=1<arguments.length&&void 0!==t&&t;this.attributes=e,i||(n=this).attributes.forEach(function(e){""!=e.name&&n.domElement.setAttribute(e.name,e.value)})}},{key:"AppendAfter",value:function(t,e){var n=0,i=0;return this.children.forEach(function(e){i++,e.id==t.id&&(n=i)}),this.Append(e,n)}},{key:"Append",value:function(i,o){var e,t,n,r,s,a,l,u,c,d,h,f,p;i.parent=this,null!=o&&o>=this.children.length&&(o=void 0),null==o?i.isInlineNode()?(t=void 0,null!=this.document.GetStyleAtCurrentCursorPosition()&&(t=(e=new C(this.document,this.document.GetStyleAtCurrentCursorPosition().nodeStyle)).isEmpty()?this.document.GetDefaultNodeStyle().Copy():e.Copy()),n=void 0,0<this.children.length&&(n=this.children[this.children.length-1]),null!=n&&n.isTextNode()||((r=P.CreateNew(this.document,"span","",t)).parent=this,r.next=i,null!=n&&(n.next=r),r.previous=n,n=r,this.children.push(r),this.domElement.appendChild(r.domElement)),(n.next=i).previous=n,(i.parent=this).children.push(i),this.domElement.appendChild(i.domElement),(s=P.CreateNew(this.document,"span","",t)).parent=this,(s.previous=i).next=s,this.children.push(s),this.domElement.appendChild(s.domElement)):(0<(i.parent=this).children.length&&(((a=this.children[this.children.length-1]).next=i).previous=a),this.children.push(i),this.domElement.appendChild(i.domElement)):(l=void 0,u=[],d=void(c=0),null!=this.document.GetStyleAtCurrentCursorPosition()&&(d=new C(this.document,this.document.GetStyleAtCurrentCursorPosition().nodeStyle)),f=[],p=void 0,(h=this).children.forEach(function(e){var t,n;o==c&&(p=l,!i.isInlineNode()||null!=l&&l.isTextNode()||((t=P.CreateNew(h.document,"span","",d.Copy())).parent=h,null!=l&&(l.next=t),t.previous=l,l=t,u.push(t),f.push(t)),null!=(i.previous=l)&&(l.next=i),u.push(i),l=i,f.push(i),i.isInlineNode()&&!e.isTextNode()&&((n=P.CreateNew(h.document,"span","",d.Copy())).parent=h,(l.next=n).previous=l,(n.next=e).previous=n,u.push(n),l=n,f.push(n))),null!=(e.previous=l)&&(l.next=e),u.push(e),l=e,c++}),this.children=u,null!=p?f.forEach(function(e){p.domElement.parentNode.insertBefore(e.domElement,p.domElement.nextSibling),p=e}):null==i.next?this.domElement.appendChild(i.domElement):this.domElement.insertBefore(i.domElement,i.next.domElement))}},{key:"InsertTextNodeAtCursor",value:function(e){if(e.isTextNode()){var t=new F(this.document).GetCurrent();if(!t.hasFocus)return;var n=t.startNode,i=t.startOffset,o=t.endNode,r=t.endOffset;if(!n.isTextNode()||!o.isTextNode())return void console.log("#10-22");var s,a,l,u=n.GetBlockContainer(),c=o.GetBlockContainer();u.id!=c.id&&console.log("#10-33"),n.id==o.id&&(1==(a=(s=n).Split(i,r)).length?this.Append(e,0):(2==a.length?0==i?a.unshift(e):a.push(e):((l=[]).push(a[0]),l.push(e),l.push(a[2]),a=l),_.ReplaceNode(this.document,s,a)))}}},{key:"_parseIsEmpty",value:function(e){var t=this,n=!0;return e.children.forEach(function(e){n&&(e.isTextNode()?""==e.text||(n=!1):n=!e.isInlineNode()&&t._parseIsEmpty(e))}),n}},{key:"isEmpty",value:function(){return this._parseIsEmpty(this)}},{key:"_parseGetFirstTextNode",value:function(e){var t=this;return e.children.every(function(e){return e.isTextNode()&&null==t.firstTextNode?(t.firstTextNode=e,!1):t._parseGetFirstTextNode(e)}),!0}},{key:"SelectWholeTextContent",value:function(){var e=this.GetFirstTextNode(),t=this.GetLastTextNode();this.document.selectionManager.SelectText(e,0,t,t.text.length)}},{key:"GetFirstTextNode",value:function(){return this.firstTextNode=void 0,this._parseGetFirstTextNode(this),this.firstTextNode}},{key:"_parseGetLastTextNode",value:function(e){var t=this;return e.children.every(function(e){return e.isTextNode()?void(t.lastTextNode=e):t._parseGetLastTextNode(e)}),!0}},{key:"GetLastTextNode",value:function(){return this.lastTextNode=void 0,this._parseGetLastTextNode(this),this.lastTextNode}},{key:"_parseDeleteButReturnTextNodes",value:function(e){var t=this;e.children.every(function(e){return e.isTextNode()?(t.tmpAllTextNodes.push(e),!1):t._parseDeleteButReturnTextNodes(e)}),e.Delete()}},{key:"DeleteButReturnTextNodes",value:function(){return this.tmpAllTextNodes=[],this._parseDeleteButReturnTextNodes(this),this.tmpAllTextNodes}},{key:"Delete",value:function(){this.domElement.remove(),this.document.UnregisterNode(this)}},{key:"InsertEmptyBlockNodeBefore",value:function(e){return this._InsertEmptyLine("before",e)}},{key:"InsertEmptyBlockNodeAfter",value:function(e){return this._InsertEmptyLine("after",e)}},{key:"_InsertEmptyLine",value:function(t,e){var n=this;null==e&&(e="div");var i=this.parent,o=u.CreateNew(this.document,e),r=i.children;return i.children=[],r.forEach(function(e){"before"==t?(e.id==n.id&&i.Append(o),i.Append(e)):"after"==t&&(i.Append(e),e.id==n.id&&i.Append(o))}),o}},{key:"Merge",value:function(t,e){var n,i=this,o=void 0,r=void 0;null==i.children||0<=(n=i.children.length-1)&&(r=i.children[n]),t.children.forEach(function(e){"text"==e.type?(i.Append(e),null==o&&(o=e)):e.DeleteButReturnTextNodes().forEach(function(e){i.Append(e)})}),t.domElement.remove(),this.document.UnregisterNode(t),i.next=t.next,null!=i.next&&(i.next.previous=i);var s=[];return i.parent.children.forEach(function(e){e.id!=t.id&&s.push(e)}),i.parent.children=s,e?o:r}}])&&R(e.prototype,t),n&&R(e,n),u}();function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(r){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,i,o=W(r);return t=s?(e=W(this).constructor,Reflect.construct(o,arguments,e)):o.apply(this,arguments),n=this,!(i=t)||"object"!==B(i)&&"function"!=typeof i?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(n):i}}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var K=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(l,S);var e,t,n,a=j(l);function l(e,t,n,i,o){var r,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:[];return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(r=a.call(this,e,t,n,E.INLINE,o)).attributes=s,null==i&&(i=""),r.text=i,r.GenerateDomElement(),r}return e=l,n=[{key:"CreateNew",value:function(e,t,n,i,o){var r=new l(e,e.GenereateNewNodeId(),t,n,i,o);return e.RegisterNode(r),r}}],(t=[{key:"Copy",value:function(){var t=new l(this.document,this.document.GenereateNewNodeId(),this.tagName,this.text,this.nodeStyle.Copy(),this.attributes);return this.GenerateDomElement(),this.children.forEach(function(e){t.Append(e.Copy())}),t}},{key:"GenerateDomElement",value:function(){this.domElement=void 0;var t=document.createElement(this.tagName);t.setAttribute("cm-id",this.id),t.setAttribute("cm-type",this.type),this.attributes.forEach(function(e){""!=e.name&&t.setAttribute(e.name,e.value)}),""!=this.text&&t.appendChild(document.createTextNode(this.text)),this.domElement=t,null!=this.nodeStyle&&this.nodeStyle.Apply(this.domElement)}},{key:"Append",value:function(i,o){if(i.isBlockNode())throw"Inline nodes cannot contain block nodes";var e,t,n,r,s,a,l,u;null==o&&(o=this.children.length),0==this.children.length||this.children.length==o?i.isInlineNode()?(e=void 0,0<this.children.length&&(e=this.children[this.children.length-1]),null!=e&&e.isTextNode()||((t=TextNode.CreateNew(this.document,"span","",this.nodeStyle.Copy())).parent=this,t.next=i,null!=e&&(e.next=t),t.previous=e,e=t,this.children.push(t),this.domElement.appendChild(t.domElement)),i.previous=e,(i.parent=this).children.push(i),this.domElement.appendChild(i.domElement),(n=TextNode.CreateNew(this.document,"span","",this.nodeStyle.Copy())).parent=this,(n.previous=i).next=n,this.children.push(n),this.domElement.appendChild(n.domElement)):((i.parent=this).children.push(i),this.domElement.appendChild(i.domElement)):(r=void 0,a=0,l=!(s=[]),this.children.forEach(function(e){var t,n;r=o==a?(!i.isInlineNode()||null!=r&&r.isTextNode()||((t=TextNode.CreateNew(this.document,"span","",this.nodeStyle.Copy())).parent=this,null!=r&&(r.next=t),t.previous=r,r=t,s.push(t)),null!=(i.previous=r)&&(r.next=i),l=!0,i.parent=this,s.push(i),i):(l&&(l=!1,i.isInlineNode()&&!e.isTextNode()?((n=TextNode.CreateNew(this.document,"span","",this.nodeStyle.Copy())).parent=this,(r.next=n).previous=r,(n.next=e).previous=n,s.push(n)):(e.previous=i).next=e),e),s.push(e),a++}),l&&i.isInlineNode()&&((u=TextNode.CreateNew(this.document,"span","",this.nodeStyle.Copy())).parent=this,(r.next=u).previous=r,u.next=void 0,s.push(u)),this.children=s,null==i.next?this.domElement.appendChild(i.domElement):this.domElement.insertBefore(i.domElement,i.next.domElement))}},{key:"Delete",value:function(){this.domElement.remove(),this.document.UnregisterNode(this)}}])&&H(e.prototype,t),n&&H(e,n),l}();function Y(e){return function(e){if(Array.isArray(e))return z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function J(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var X=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e,this.selectionManager=new F(this.document)}var e,n,i;return e=t,(n=[{key:"GetStyleAtCurrentCursorPosition",value:function(){var e=this.selectionManager.GetCurrent();if(!e.hasFocus)return{};var t=e.startNode;if(null==t)return{};var n=this._getFirstParentBlockNode(t);return{nodeStyle:t.nodeStyle.styles,lineStyle:n.nodeStyle.styles,plugin:void 0}}},{key:"ToggleStyleOnLine",value:function(t,n){var e,i,o,r,s,a,l,u,c=this.selectionManager.GetCurrent();c.hasFocus&&(e=c.startNode,i=c.startOffset,o=c.endNode,r=c.endOffset,e.isTextNode()&&o.isTextNode()?e.id==o.id?(this._getFirstParentBlockNode(e).ToggleStyle(t,n,!0),e.SelectText(i,r)):(s=this._getFirstParentBlockNode(e),a=this._getFirstParentBlockNode(o),s.id==a.id?(s.ToggleStyle(t,n,!0),this.selectionManager.SelectText(e,i,o,r)):(l=s.parent).id==a.parent.id?(u=!1,l.children.forEach(function(e){e.id==s.id&&(u=!0),u&&(e.ToggleStyle(t,n,!0),e.id==a.id&&(u=!1))})):console.log("#10-03")):console.log("#10-02"))}},{key:"_getFirstParentBlockNode",value:function(e){var t=e.parent;return t.isBlockNode()||(t=this._getFirstParentBlockNode(t)),t}},{key:"ToggleStyleOnSelection",value:function(t,n){var e=this.selectionManager.GetCurrent();if(e.hasFocus){var i,o,r,s,a,l,u,c=e.startNode,d=e.startOffset,h=e.endNode,f=e.endOffset;if(!c.isTextNode()||!h.isTextNode())if(console.log("Possible #10-01",c,h),c.isTextNode()&&!h.isTextNode())f=(h=c).text.length;else{if(c.isTextNode()||!h.isTextNode())return void console.log("#10-01");c=h,d=0}c.id==h.id?this._toggleStyleOnNode(c,d,f,t,n).SelectText(0,f-d):(i=_.GetAllTextNodes(this.document,c,h,!1),o=!1,r=[],c.IsStyleApplied(t)?r.push(!0):r.push(!1),i.forEach(function(e){e.IsStyleApplied(t)?r.push(!0):r.push(!1)}),h.IsStyleApplied(t)?r.push(!0):r.push(!1),1<(r=Y(new Set(r))).length&&(o=!0),o?((s=c).IsStyleApplied(t)||(s=this._toggleStyleOnNode(c,d,c.text.length,t,n)),i.forEach(function(e){e.IsStyleApplied(t)||e.ToggleStyle(t,n,!0)}),(a=h).IsStyleApplied(t)||this._toggleStyleOnNode(h,0,f,t,n),this.selectionManager.SelectText(s,0,a,f)):(l=this._toggleStyleOnNode(c,d,c.text.length,t,n),i.forEach(function(e){e.ToggleStyle(t,n,!0)}),u=this._toggleStyleOnNode(h,0,f,t,n),this.selectionManager.SelectText(l,0,u,f)))}}},{key:"_toggleStyleOnNode",value:function(e,t,n,i,o){var r=e.Split(t,n);if(1==r.length)return e.ToggleStyle(i,o,!0),e;var s=void 0;return(s=0==t?r[0]:r[1]).ToggleStyle(i,o,!1),_.ReplaceNode(this.document,e,r),s}}])&&J(e.prototype,n),i&&J(e,i),t}();function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Z=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e,this.selectionManager=new F(this.document)}var e,n,i;return e=t,(n=[{key:"Insert",value:function(){if(this.selectionManager.IsCollapsed()||this.document.DeleteSelection(),this.selectionManager.IsCollapsed()){var e=this.selectionManager.GetCurrent();if(!e.hasFocus)return{};var t,n,i,o,r,s,a,l,u,c,d,h=e.startNode,f=e.startOffset,p=e.endOffset;null!=h&&h.isTextNode()?(t=h.parent).isBlockNode()?(i=!(n=[]),o=[],s=r=void 0,t.children.forEach(function(e){e.id==h.id?i=!0:i?n.push(e):(o.push(e),(r=e).isTextNode()&&(s=e.nodeStyle))}),a=h.Split(f,p),l=!0,u=[],a.forEach(function(e){""==e.text?l=!1:l?u.push(e):n.unshift(e)}),0<u.length||0<o.length?(_.ReplaceNode(this.document,h,u,!0),this.InsertNewRootLine("after",h.parent,!0,h.parent.nodeStyle,h.nodeStyle,n)):(c=void 0,null!=h.parent&&(c=h.parent.nodeStyle),this.InsertNewRootLine("before",h.parent,!1,c,h.nodeStyle,u)),null!=r&&r.isInlineNode()&&(d=P.CreateNew(this.document,"span","",s),t.Append(d))):console.log("#20-03"):console.log("#20-02")}else console.log("Selection not collapsed"),console.log("#20-01");return!0}},{key:"InsertNewRootLine",value:function(e,t,n,i,o,r){var s,a,l,u,c,d,h,f=t.parent;null!=f&&(a=s=0,f.children.forEach(function(e){e.id==t.id&&(s=a),a++}),null==i&&(i=new C(this.document)),(l=G.CreateNew(this.document,t.tagName,i.Copy(),t.attributes)).parent=f,"before"==e?(l.previous=t.previous,null!=t.previous&&(t.previous.next=l),(l.next=t).previous=l):(s+=1,l.previous=t,l.next=t.next,null!=t.next&&(t.next.previous=l),t.next=l),u=void 0,0==r.length?(c=P.CreateNew(this.document,"span","",o.Copy()),l.Append(c),u=c):(d=this.document,h=void 0,r.forEach(function(e){""==e.id&&(e.id=d.GenereateNewNodeId(),e.GenerateDomElement(),d.RegisterNode(e));var t=!0;e.isTextNode()&&(null!=h?h.HasSameStyle(e)&&h.HasSameAttributes(e)?(t=!1,h.AppendTextContent(e.text),h.next=e.next,d.UnregisterNode(e),e.domElement.parentNode.removeChild(e.domElement)):h=e:(e.previous=void 0,h=e)),t&&(l.Append(e),null==u&&(e.isTextNode()?u=e:e.isInlineNode()&&(u=e.previous)))})),f.domElement.insertBefore(l.domElement,f.domElement.children[s]),f.children.splice(s,0,l),"after"==e&&n&&u.SetFocus())}}])&&V(e.prototype,n),i&&V(e,i),t}(),q={DELETE:"delete",DELETE_TOP:"deleteTop",DELETE_FROM_BOTTOM:"deleteFromBottom",CANCEL_FROM_TOP:"cancelFromTop",CANCEL_FROM_BOTTOM:"cancelFromBottom",ENTER:"enter",APPLY_STYLE_ON_LINE:"applyStyleOnLine",APPLY_STYLE_ON_TEXT:"applyStyleOnText",CLICK:"click",DELETE_BEFORE_INLINE:"DELETE_BEFORE_INLINE",CANCEL_BEFORE_INLINE:"CANCEL_BEFORE_INLINE",NODE_UNREGISTERED:"NODE_UNREGISTERED",TAB:"TAB",NEW_CHAR_ADDED:"newCharAdded",ARROW_UP:"arrowUp",ARROW_DOWN:"arrowDown",ARROW_LEFT:"arrowLeft",ARROW_RIGHT:"arrowRight",SHIFT_ARROW_UP:"shiftArrowUp",SHIFT_ARROW_DOWN:"shiftArrowDown",SHIFT_ARROW_LEFT:"shiftArrowLeft",SHIFT_ARROW_RIGHT:"shiftArrowRight",SHIFT_DOWN:"SHIFT_DOWN",SHIFT_UP:"SHIFT_UP",SELECT_ALL:"SELECT_ALL",BEFORE_COPY:"BEFORE_COPY",BEFORE_CUT:"BEFORE_CUT",BEFORE_PASTE:"BEFORE_PASTE",LOST_FOCUS:"LOST_FOCUS",ESC:"esc"};function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var $=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e,this.selectionManager=new F(this.document)}var e,n,i;return e=t,(n=[{key:"DeleteNode",value:function(e){return _.ReplaceNode(this.document,e,[],!1)}},{key:"DeleteSelection",value:function(){var n,e,t,i,o,r=!1,s=this.selectionManager.GetCurrent(),a=s.startNode,l=s.startOffset,u=s.endNode,c=s.endOffset;return null!=a&&null!=u||console.log(a,u),u.isBlockNode()&&(n=!1,u.children.forEach(function(e){var t;e.id==a.id&&(n=!0),!n||null!=(t=e.domElement.getAttribute("contenteditable"))&&"false"==t&&(u=e.next,c=0)})),a.isTextNode()&&!u.isTextNode()?c=(u=a).text.length:!a.isTextNode()&&u.isTextNode()&&(a=u,l=0),a.isTextNode()&&u.isTextNode()?a.id==u.id?(a.DeleteText(l,c),r=!0,(e=this.selectionManager.GetRange()).deleteContents(),e.collapse(!0),(t=document.getSelection()).removeAllRanges(),t.addRange(e),""==a.text&&(null==a.previous&&null==a.next&&(a.SetZeroWidthChar(),a.SetFocus()),r=!0)):(_.DeleteNodesBetween(this.document,a,u),a.TrimTextContent(0,l),u.TrimTextContent(c),a.parent.id==u.parent.id?((a.next=u).previous=a,this._adjustAndSetFocus(a,u,l)):(i=a.parent,o=u.parent,i.parent.id==o.parent.id?(o.children.forEach(function(e){i.Append(e)}),o.children=[],this.DeleteNode(o),this._adjustAndSetFocus(a,u,l)):u.SetFocus()),r=!0):console.log("#30-01-01"),r}},{key:"Delete",value:function(){var e=!1;if(this.selectionManager.IsCollapsed()){var t=this.selectionManager.GetCurrent();if(!t.hasFocus)return!0;var n,i,o,r,s,a,l,u,c=t.startNode,d=t.startOffset;t.endOffset;if(!c.parent.isBlockNode())return console.log("#30-01"),!0;null!=c&&c.isTextNode()?(n=!1,d!=c.text.length&&""!=c.text||(n=!0),c.RemoveCharAt(d),d<c.text.length?e=!1:null==c.next?""==c.text?e=(null==c.parent.next?null!=c.previous&&c.previous.isTextNode()?(i=c.previous,this.DeleteNode(c),i.SetCarretAtTheEnd()):(c.SetZeroWidthChar(),c.SetFocus()):n?(o=!0,null!=c.parent.next.GetPluginType()&&(o=!(o=this.document.NotifyPlugin(q.CANCEL_FROM_TOP,c.parent.next))),o&&(this.DeleteNode(c),c.parent.next.isBlockNode()?null!=(r=c.parent.next.GetFirstTextNode())&&r.SetFocus():console.log("#72-28"))):(c.SetZeroWidthChar(),c.SetFocus()),!0):n?(null!=c.parent.next?(s=!0,null!=c.parent.next&&null!=c.parent.next.GetPluginType()&&(s=!(s=this.document.NotifyPlugin(q.CANCEL_FROM_TOP,c.parent.next))),!s||null!=(a=c.parent.Merge(c.parent.next,!0))&&a.SetFocus()):this.document.NotifyPlugin(q.CANCEL_FROM_BOTTOM,c),e=!0):""==c.text&&(c.SetZeroWidthChar(),c.SetFocus(),e=!0):(l=c.next).isInlineNode()?n?(this.document.NotifyPlugin(q.CANCEL_BEFORE_INLINE,l)||(u=l.next,this.DeleteNode(l),this.DeleteNode(c),null!=u&&u.SetFocus()),e=!0):""==c.text&&(c.SetZeroWidthChar(),c.SetFocus(),e=!0):l.isTextNode()&&(n?(l.RemoveCharAt(0,!0),e=(""==l.text?(this.DeleteNode(l),c.SetCarretAtTheEnd()):l.SetFocus(),!0)):""==c.text&&(this.DeleteNode(c),l.SetFocus(),e=!0))):e=!0}else e=this.DeleteSelection();return e}},{key:"Backspace",value:function(){var e=!1;if(this.selectionManager.IsCollapsed()){var t=this.selectionManager.GetCurrent();if(!t.hasFocus)return!0;var n,i,o,r,s,a,l,u,c,d,h,f,p=t.startNode,y=t.startOffset;t.endOffset;if(!p.parent.isBlockNode())return console.log("#30-23"),!0;null!=p&&p.isTextNode()?(n=!1,""==p.text&&(n=!0),(i=y-1)<0?(e=!0,o=p.previous,""==p.text?null!=o?o.isTextNode()?(this.DeleteNode(p),o.SetCarretAtTheEnd(),console.log("I DONT UNDERSTAND THIS (see next line)"),e=!0):o.isInlineNode()&&(r=o.previous,this.DeleteNode(o),this.DeleteNode(p),null!=r&&r.SetCarretAtTheEnd(),e=!0):e=(null!=p.parent.previous?(this.DeleteNode(p),null!=(s=p.parent.previous.Merge(p.parent,!1))&&s.SetCarretAtTheEnd()):null==p.parent.parent.parent||(this.document.IsNodeInsidePlugin(p)?this.document.NotifyPlugin(q.DELETE_TOP,p):this._consolidateCommaNodes(p)),!0):null!=o?o.isTextNode()?(null!=o&&o.SetCarretAtTheEnd(),console.log("WHY AM I HERE?!?",o)):o.isInlineNode()&&(this.document.NotifyPlugin(q.DELETE_BEFORE_INLINE,o)||(a=o.previous,this.DeleteNode(o),null!=a&&a.SetCarretAtTheEnd()),e=!0):e=(null!=p.parent.previous?(l=!0,null!=p.parent.previous.GetPluginType()&&(l=!(l=this.document.NotifyPlugin(q.DELETE_FROM_BOTTOM,p.parent.previous))),!l||null!=(u=p.parent.previous.Merge(p.parent,!1))&&u.SetCarretAtTheEnd()):null==p.parent.parent.parent||this.document.NotifyPlugin(q.DELETE_TOP,p),!0)):(p.RemoveCharAt(i),e=""==p.text&&(null==(c=p.previous)?n?null!=p.parent.previous?(d=!0,null!=p.parent.previous.GetPluginType()&&(d=!(d=this.document.NotifyPlugin(q.DELETE_FROM_BOTTOM,p.parent.previous))),d&&(this.DeleteNode(p),null!=(h=p.parent.previous.Merge(p.parent,!1))&&h.SetCarretAtTheEnd())):null==p.parent.parent.parent||(this.document.IsNodeInsidePlugin(p)?this.document.NotifyPlugin(q.DELETE_TOP,p):this._consolidateCommaNodes(p)):null!=p.next&&p.next.isTextNode()?(this.DeleteNode(p),p.next.SetFocus()):(p.SetZeroWidthChar(),p.SetFocus()):c.isInlineNode()?n?this.document.NotifyPlugin(q.DELETE_BEFORE_INLINE,p.previous)||(f=c.previous,this.DeleteNode(c),this.DeleteNode(p),null!=f&&f.SetCarretAtTheEnd()):(p.SetZeroWidthChar(),p.SetFocus(),e=!0):(this.DeleteNode(p),c.SetCarretAtTheEnd()),!0))):e=!0}else e=this.DeleteSelection();return e}},{key:"_adjustAndSetFocus",value:function(e,t,n){var i,o;""==e.text&&""==t.text?null!=e.previous?(this.DeleteNode(e),this.DeleteNode(t),e.previous.isTextNode()?e.previous.SetCarretAtTheEnd():e.previous.isInlineNode()&&(null!=(i=e.previous).next&&i.next.isTextNode()?i.next.isTextNode()&&i.next.SetFocus():(o=P.CreateNew(i.document,"span","",e.nodeStyle.Copy()),i.parent.AppendAfter(i,o),o.SetFocus()))):null!=t.next?(this.DeleteNode(e),this.DeleteNode(t),t.next.SetFocus()):(this.DeleteNode(t),e.SetFocus()):""==e.text?(this.DeleteNode(e),t.SetFocus()):""==t.text?(this.DeleteNode(t),e.SetCarretAtTheEnd()):e.nodeStyle.Equals(t.nodeStyle)?(e.Merge(t),e.SetFocus(n)):t.SetFocus()}},{key:"_consolidateCommaNodes",value:function(e){var t=this._removeSubBlock(this.document.rootNode,e);0==this.document.rootNode.children.length&&this.document.InitEmptyDoc(),null!=t&&t.SetFocus()}},{key:"_removeSubBlock",value:function(e,n){var i=this,o=void 0,r=!0;return e.children.forEach(function(e){var t;e.Contains(n.id)&&(r=!1,e.isEmpty()?i.document.DeleteNode(e):null!=(t=i._removeSubBlock(e,n))&&(o=t)),r&&(o=e.GetLastTextNode())}),o}}])&&Q(e.prototype,n),i&&Q(e,i),t}();function ee(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var te=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.rtf=e,this.pictures={},this.counter=0,this.allPictures=[],this.indexNextToGet=0}var e,n,i;return e=t,(n=[{key:"GetAll",value:function(){return this.allPictures}},{key:"GetNextPicture",value:function(){var e=this.allPictures[this.indexNextToGet];return this.indexNextToGet++,e}},{key:"ResetGetNext",value:function(){this.indexNextToGet=0}},{key:"ParseRtf",value:function(){var e=this.rtf;this.ExtractNextPicture(e),this.allPictures=Object.values(this.pictures)}},{key:"ExtractNextPicture",value:function(e){console.log(e);var t=e.indexOf("{\\pict");if(!(-1<t))return!1;var n=this.GetPic(e,t);!1!==n&&this.ExtractNextPicture(n)}},{key:"GetPicId",value:function(e){var t=e.indexOf("\\blipuid"),n=e.substring(t).replace("\\blipuid",""),i="";for(var o in n){var r=n[o];if("}"==r)break;i+=r}return i.trim()}},{key:"GetMimeType",value:function(e){var t="";return-1<e.indexOf("jpegblip")?t="image/jpeg":-1<e.indexOf("emfblip")?t="emf":-1<e.indexOf("pngblip")?t="image/png":-1<e.indexOf("macpict")&&(t="pict"),t}},{key:"GetContent",value:function(e){for(var t=e.replace(/({?.*})/gi,"").replace(/[\W_]+/g,""),n="",i=0;i<t.length;i+=2)n+=String.fromCharCode(parseInt(t.substr(i,2),16));return btoa(n)}},{key:"AnalizePicChunk",value:function(e){var t,n=this.GetPicId(e);null==this.pictures[n]&&((t={}).id=n,t.positionInDocument=this.counter,this.counter++,t.mimeType=this.GetMimeType(e),t.content=this.GetContent(e),t.srcReady="data:"+t.mimeType+";base64,"+t.content,this.pictures[n]=t)}},{key:"GetPic",value:function(e,t){for(var n=t,i=!1,o=0,r="",s=t;n<e.length;){var a=e[n];"{"==a&&o++,"}"==a&&o--,0<o&&!i&&(r+=a,s=n),0==o&&(i=!0),n++}return this.AnalizePicChunk(r),e.substring(s)}}])&&ee(e.prototype,n),i&&ee(e,i),t}();function ne(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ie=["address","article","blockquote","br","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","iframe","li","main","nav","output","p","pre","section","td","tr","video"],oe=["b","i","u"],re=["table","ul","ol","img","a"],se=function(){function o(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.document=e,this.pastedDocument=t,this.pluginsManager=e.pluginsManager,this.rtf=n,this.fromRtf=!1,null!=this.rtf&&""!=this.rtf&&(this.rtfPictures=new te(n),this.rtfPictures.ParseRtf(),this.fromRtf=!0),this.pastedDocumentInBrowser=void 0;var i=document.createElement("div");i.style.display="none",i.appendChild(t.documentElement),document.body.appendChild(i),this.pastedDocumentInBrowser=i,this.newNodes=[],this.currentLine=void 0,this.Parse(),i.parentElement.removeChild(i)}var e,t,n;return e=o,(t=[{key:"ExtactAttributes",value:function(e){var t=[];if(e.hasAttributes())for(var n=e.attributes,i=n.length-1;0<=i;i--){var o=n[i].name,r=n[i].value;"style"!=o.toLowerCase()&&"cm-id"!=o.toLowerCase()&&"cm-type"!=o.toLowerCase()&&"cm-plugin"!=o.toLowerCase()&&t.push({name:o,value:r})}return t}},{key:"isBlock",value:function(e){return!(ie.indexOf(e.toLowerCase())<0)}},{key:"isTagWithSpecialNeeds",value:function(e){return!(re.indexOf(e.toLowerCase())<0)}},{key:"isFormattingTag",value:function(e){return!(oe.indexOf(e.toLowerCase())<0)}},{key:"GenerateNewTextNode",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:void 0;return null==n&&(n=this.document.GetDefaultNodeStyle().Copy()),P.CreateNew(this.document,"span",e,n)}},{key:"GenerateNewBlockLine",value:function(){var e=G.CreateNew(this.document,"div"),t=P.CreateNew(this.document,"span","",this.document.GetDefaultNodeStyle().Copy());return e.Append(t),e}},{key:"ParseNode",value:function(e){var t,n,i,o,r,s,a,l=this,u=void 0;return e.nodeType===e.TEXT_NODE?"O:P"===e.parentNode.tagName||""!=(t=e.textContent).trim()&&(n=C.CalculateStylesForExternalHTML(this.document,e.parentNode),u=this.GenerateNewTextNode(t,n)):e.nodeType===e.ELEMENT_NODE&&("O:P"==e.tagName?u=this.GenerateNewBlockLine():("body"==(i=e.tagName.toLowerCase())&&(i="div"),o=this.ExtactAttributes(e),r=C.CalculateStylesForExternalHTML(this.document,e),this.isBlock(i)?"br"==i.toLowerCase()||(u=G.CreateNew(this.document,i,r,o),e.childNodes.forEach(function(e){var t=l.ParseNode(e);null!=t&&(null!=t.length&&0<t.length?t.forEach(function(e){u.Append(e)}):u.Append(t))})):this.isTagWithSpecialNeeds(i)?("img"==i.toLowerCase()&&this.fromRtf&&(s=this.rtfPictures.GetNextPicture(),e.src=s.srcReady),u=this.pluginsManager.PasteContentToPlugin(e.tagName.toLowerCase(),e)):1<e.childNodes.length?(u=[],e.childNodes.forEach(function(e){var t=l.ParseNode(e);null!=t&&u.push(t)})):(this.isFormattingTag(i)&&(i="span"),a=C.CalculateStylesForExternalHTML(this.document,e),u=P.CreateNew(this.document,i,e.textContent.replace("\n"," ").replace(/[\u200B-\u200D\uFEFF]/g,""),a),"b"==i?u.ToggleStyle("bold","",!0,!0):"i"==i?u.ToggleStyle("italic","",!0,!0):"u"==i&&u.ToggleStyle("underlined","",!0,!0)))),u}},{key:"Parse",value:function(){var e,t=this,n=this.pastedDocumentInBrowser.firstChild.getElementsByTagName("body")[0];null!=n&&(null!=(e=this.ParseNode(n))&&(null!=e.length&&0<e.length?e.forEach(function(e){t.newNodes.push(e)}):this.newNodes.push(e)),0<this.newNodes.length&&this._pasteInPlace(this.newNodes))}},{key:"_pasteInPlace",value:function(e){var u=void 0,t=this.document.selectionManager.GetCurrent(),c=t.startOffset,n=t.startNode,d=n.parent,i=[],o=[],r=!0;d.children.forEach(function(e){e.id==n.id?(u=e,r=!1):r?i.push(e):o.push(e)}),d.children=i;var s=n.text.substring(0,c),a=n.text.substring(c,n.text.length);n.ForceTextContent(s);var l,h=n,f=c,p=!1;e.forEach(function(e){var t,n,i,o,r,s,a,l=!0;e.isTextNode()?h.isTextNode()&&h.nodeStyle.Equals(e.nodeStyle)&&(e.parent=h.parent,h.Merge(e,c),u=h,l=!1,c+=e.text.length,f=c,p=!1):e.isBlockNode()&&(l=!1,p||d.Append(h),p=!0,t=d.parent,o=[],r=[],s=!(i=n=0),t.children.forEach(function(e){s?o.push(e):r.push(e),e.id==d.id&&(n=i,s=!1),i++}),n+=1,t.children=o,(a=e).parent=t,a.previous=d,a.next=d.next,null!=d.next&&(d.next.previous=a),d.next=a,d=a,t.domElement.insertBefore(a.domElement,t.domElement.children[n]),t.Append(a),r.forEach(function(e){t.Append(e)}),a.children.forEach(function(e){"text"==e.type&&(f=e.text.length,u=h=e)})),l&&(e.parent=h.parent,e.next=h.next,(h.next=e).previous=h,d.Append(h),p=!(p=!0),"text"==(h=e).type&&(f=(u=e).text.length))}),p||d.Append(h),""!=a&&(l=P.CreateNew(this.document,"span",a,n.nodeStyle.Copy()),d.Append(l),f=0,u=l),o.forEach(function(e){d.Append(e)}),u.SetFocus(f)}}])&&ne(e.prototype,t),n&&ne(e,n),o}();function ae(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var le=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e}var e,n,i;return e=t,(n=[{key:"HtmlToNode",value:function(e,t){var n=!(1<arguments.length&&void 0!==t)||t,i=(new DOMParser).parseFromString(e,"text/html").body.firstElementChild,o=this.ParseNode(i);return n&&(o=this.Optimize(o)),o}},{key:"Optimize",value:function(e){var o,r=this;return null!=e.children&&(o=[],e.children.forEach(function(e){var t,n,i;e.isTextNode()?(n=!0,null!=(t=e.previous)&&t.isTextNode()&&t.tagName.toLowerCase()==e.tagName.toLowerCase()&&t.HasSameAttributes(e)&&(i=!1,!t.HasSameStyle(e)&&""!=e.text||(i=!0),i&&(""!=e.text&&t.AppendTextContent(e.text),t.next=e.next,null!=t.next&&(t.next.previous=t),t.document.UnregisterNode(e),e.domElement.parentNode.removeChild(e.domElement),n=!1)),n&&o.push(e)):e.isBlockNode()?o.push(r.Optimize(e)):e.isInlineNode()&&o.push(e)}),e.children=o),e}},{key:"ParseNode",value:function(e){e.getAttribute("cm-id");var t=e.getAttribute("cm-type"),n=void 0;if("block"==t.toLowerCase())n=this.ParseBlockNode(e);else if("inline"==t.toLowerCase())n=this.ParseInlineNode(e);else{if("text"!=t.toLowerCase())throw console.log("U.F.O. NODE"),"UNKNON NODE TYPE [1]: "+e.outerHTML;n=this.ParseTextNode(e)}return n}},{key:"ExtactAttributes",value:function(e){var t=[];if(e.hasAttributes())for(var n=e.attributes,i=n.length-1;0<=i;i--){var o=n[i].name,r=n[i].value;"style"!=o.toLowerCase()&&"cm-id"!=o.toLowerCase()&&"cm-type"!=o.toLowerCase()&&"cm-plugin"!=o.toLowerCase()&&"xmlns"!=o.toLowerCase()&&t.push({name:o,value:r})}return t}},{key:"ParseBlockNode",value:function(r){var e,t,n,i,o,s=this,a=r.getAttribute("cm-type"),l=void 0;return"block"==a.toLowerCase()&&(e=r.getAttribute("cm-id"),t=r.getAttribute("cm-plugin"),n=null!=(n=r.getAttribute("cm-has-text-content"))&&JSON.parse(n),i=C.CalculateStyles(this.document,r),o=s.ExtactAttributes(r),null==e?l=G.CreateNew(this.document,r.tagName.toLowerCase(),i.Copy(),o,n,r.textContent):(e=this.document.VerifyAndRegisterNodeId(e),l=new G(this.document,e,r.tagName.toLowerCase(),i.Copy(),o,n,r.textContent),this.document.RegisterNode(l)),r.childNodes.forEach(function(e){if(1==e.nodeType){e.getAttribute("cm-id");var t=e.getAttribute("cm-type");if(null!=t)if("block"==t.toLowerCase()){var n=s.ParseBlockNode(e);l.Append(n)}else if("inline"==t.toLowerCase()){var i=s.ParseInlineNode(e);l.Append(i)}else{if("text"!=t.toLowerCase())throw console.log("UFO NODE"),"UNKNON NODE TYPE [2]: "+r.outerHTML;var o=s.ParseTextNode(e);l.Append(o)}}}),null!=t&&""!=t&&this.document.CreatePluginInstance(t,l)),l}},{key:"ParseInlineNode",value:function(r){var e,t,n,i,s=this,o=r.getAttribute("cm-id"),a=r.getAttribute("cm-type"),l=void 0;return"inline"==a.toLowerCase()&&(e=r.getAttribute("cm-plugin"),t=C.CalculateStyles(this.document,r),n=s.ExtactAttributes(r),i=r.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""),0<r.childNodes.length&&1==r.childNodes[0].nodeType&&(i=""),null==o?l=K.CreateNew(this.document,r.tagName.toLowerCase(),i,t.Copy(),n):(o=this.document.VerifyAndRegisterNodeId(o),l=new K(this.document,o,r.tagName.toLowerCase(),i,t.Copy(),n),this.document.RegisterNode(l)),r.childNodes.forEach(function(e){if(1==e.nodeType){e.getAttribute("cm-id");var t=e.getAttribute("cm-type");if("block"==t.toLowerCase()){var n=s.ParseBlockNode(e);l.Append(n)}else if("inline"==t.toLowerCase()){var i=s.ParseInlineNode(e);l.Append(i)}else{if("text"!=t.toLowerCase())throw console.log("UFO NODE"),"UNKNON NODE TYPE [3]: "+r.outerHTML;var o=s.ParseTextNode(e);l.Append(o)}}}),null!=e&&""!=e&&this.document.CreatePluginInstance(e,l)),l}},{key:"ParseTextNode",value:function(e){var t,n,i,o,r=e.getAttribute("cm-id"),s=void 0;return"text"==e.getAttribute("cm-type").toLowerCase()&&(t=e.getAttribute("cm-plugin"),n=C.CalculateStyles(this.document,e),i=this.ExtactAttributes(e),o=e.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""),null==r?s=P.CreateNew(this.document,e.tagName.toLowerCase(),o,n.Copy(),i):(r=this.document.VerifyAndRegisterNodeId(r),s=new P(this.document,r,e.tagName.toLowerCase(),n.Copy(),o,i),this.document.RegisterNode(s)),null!=t&&""!=t&&this.document.CreatePluginInstance(t,s)),s}},{key:"stringIsUrl",value:function(e){return-1<e.indexOf("http://")||-1<e.indexOf("https://")}},{key:"stringIsEmail",value:function(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}},{key:"PasteSimpleString",value:function(e){var t,n=[];this.stringIsUrl(e)?n=this.document.pluginsManager.PasteContentToPlugin("a",e):this.stringIsEmail(e)?n=this.document.pluginsManager.PasteContentToPlugin("a","mailTo:"+e):(t=P.CreateNew(this.document,"span",e.replace(/[\u200B-\u200D\uFEFF]/g,""),this.document.GetDefaultNodeStyle().Copy()),n.push(t)),this._pasteInPlace(n)}},{key:"PasteContentInPlace",value:function(e,t){var n,i,o,r=1<arguments.length&&void 0!==t?t:"",s=(new DOMParser).parseFromString(e.replace(/\n/g,""),"text/html"),a=s.body.firstElementChild,l=!0;null!=a&&(null!=(n=a.getAttribute("comma"))&&"comma-content"==n?l=!1:(i=a.getAttribute("cm-id"),o=a.getAttribute("cm-type"),null!=i&&""!=i&&null!=o&&""!=o&&(l=!1))),l?this._pasteExternalContent(s,r):this._pasteOurContent(a)}},{key:"_pasteExternalContent",value:function(e,t){new se(this.document,e,t)}},{key:"_pasteOurContent",value:function(e){var i=this,o=[];e.childNodes.forEach(function(e){var t,n=void 0;3==e.nodeType?n=P.CreateNew(this.document,e.tagName.toLowerCase(),e.textContent.replace(/[\u200B-\u200D\uFEFF]/g,"")):"block"==(t=e.getAttribute("cm-type"))?n=i.ParseBlockNode(e):"inline"==t?n=i.ParseInlineNode(e):"text"==t&&(n=i.ParseTextNode(e)),o.push(n)}),this._pasteInPlace(o)}},{key:"_pasteInPlace",value:function(e){var u=void 0,t=this.document.selectionManager.GetCurrent(),c=t.startOffset,n=t.startNode,d=n.parent,i=[],o=[],r=!0;d.children.forEach(function(e){e.id==n.id?(u=e,r=!1):r?i.push(e):o.push(e)}),d.children=i;var s=n.text.substring(0,c),a=n.text.substring(c,n.text.length);n.ForceTextContent(s);var l,h=n,f=c,p=!1;e.forEach(function(e){var t,n,i,o,r,s,a,l=!0;e.isTextNode()?h.isTextNode()&&h.nodeStyle.Equals(e.nodeStyle)&&(e.parent=h.parent,h.Merge(e,c),u=h,l=!1,c+=e.text.length,f=c,p=!1):e.isBlockNode()&&(l=!1,p||d.Append(h),p=!0,t=d.parent,o=[],r=[],s=!(i=n=0),t.children.forEach(function(e){s?o.push(e):r.push(e),e.id==d.id&&(n=i,s=!1),i++}),n+=1,t.children=o,(a=e).parent=t,a.previous=d,a.next=d.next,null!=d.next&&(d.next.previous=a),d.next=a,d=a,t.domElement.insertBefore(a.domElement,t.domElement.children[n]),t.Append(a),r.forEach(function(e){t.Append(e)}),a.children.forEach(function(e){"text"==e.type&&(f=e.text.length,u=h=e)})),l&&(e.parent=h.parent,e.next=h.next,(h.next=e).previous=h,d.Append(h),p=!(p=!0),"text"==(h=e).type&&(f=(u=e).text.length))}),p||d.Append(h),""!=a&&(l=P.CreateNew(this.document,"span",a,n.nodeStyle.Copy()),d.Append(l),f=0,u=l),o.forEach(function(e){d.Append(e)}),u.SetFocus(f)}}])&&ae(e.prototype,n),i&&ae(e,i),t}();function ue(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ce=function(){function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.document=e,this.selectionManager=new F(this.document)}var e,t,n;return e=a,n=[{key:"_CleanDomNode",value:function(n,t){var i,o=!0,r=n.getAttribute("cm-id");return t.childNodes.forEach(function(e){var t=e.getAttribute("cm-id");r==t&&(o=!1,n.parentNode.replaceChild(e.cloneNode(!0),n))}),o&&(n.hasChildNodes()?(i=[],n.childNodes.forEach(function(e){3!=e.nodeType&&(o=a._CleanDomNode(e,t))&&i.push(e)}),i.forEach(function(e){try{n.removeChild(e)}catch(e){console.log("#23-239",e)}})):n.remove()),o}},{key:"_fallbackCopyTextToClipboard",value:function(e){var t,n,i=document.createElement("textarea");i.value=e,document.body.appendChild(i),i.focus(),navigator.userAgent.match(/ipad|iphone/i)?((t=document.createRange()).selectNodeContents(i),(n=window.getSelection()).removeAllRanges(),n.addRange(t),i.setSelectionRange(0,999999)):i.select();try{document.execCommand("copy")}catch(e){console.error("ClipboardManager[205]",e)}document.body.removeChild(i)}},{key:"_copyTextToClipboard",value:function(e){navigator.clipboard?navigator.clipboard.writeText(e).then(function(){},function(e){console.error("ClipboardManager[205]",e)}):a._fallbackCopyTextToClipboard(e)}}],(t=[{key:"Paste",value:function(e,t){t.do(he.DELETE_SELECTION);var n=e.clipboardData.getData("text/rtf"),i=e.clipboardData.getData("text/html"),o=e.clipboardData.getData("text/plain"),r=Array.from(e.clipboardData.files||[]);return!i&&0<r.length||(null==i||""==i?new le(this.document).PasteSimpleString(o):new le(this.document).PasteContentInPlace(i,n)),!0}},{key:"Copy",value:function(e){var t=e,n=this.GetSelectedContent(!1);return t.clipboardData.setData("text/html",n),t.clipboardData.setData("text/plain",this._getPlainText(n)),!0}},{key:"Cut",value:function(e,t){var n=e,i=this.GetSelectedContent(!0,t);return n.clipboardData.setData("text/html",i),n.clipboardData.setData("text/plain",this._getPlainText(i)),!0}},{key:"_getPlainText",value:function(e){var t=document.createElement("div");return t.innerHTML=e,Array.from(t.getElementsByTagName("div")).forEach(function(e){"block"==e.getAttribute("cm-type")&&(e.innerHTML="\r\n"+e.innerHTML)}),t.textContent||t.innerText}},{key:"GetSelectedContent",value:function(e,t){var n,i=this.selectionManager.GetCurrent(),l=i.startNode,u=(i.startOffset,i.endNode),o=(i.endOffset,this.selectionManager.GetRange().cloneContents()),c=!0,d="",h=new XMLSerializer,r=!0,s=this.selectionManager.FindCommonNodeContainer(l,u);return null!=s&&null!=s.pluginName&&""!=s.pluginName&&(n=s.domElement.cloneNode(!0),a._CleanDomNode(n,o),d=h.serializeToString(n),r=!1),r&&o.childNodes.forEach(function(e){var t,n,i,o,r,s,a;3==e.nodeType?(i=n=t="",c?(c=!1,t='id="'+l.id+'" cm-id="'+l.id+'"',""!=(o=l.nodeStyle.toStringForStyleTag())&&(n='style="'+o+'"'),""!=(r=l.nodeStyle.toStringForClassTag())&&(i='class="'+r+'"')):(t='id="'+u.id+'" cm-id="'+u.id+'"',""!=(s=u.nodeStyle.toStringForStyleTag())&&(n='style="'+s+'"'),""!=(a=u.nodeStyle.toStringForClassTag())&&(i='class="'+a+'"')),d=d+'<span cm-type="text" '+t+" "+i+" "+n+">"+h.serializeToString(e)+"</span>"):e.getAttribute("cm-id")==l.parent.id?e.childNodes.forEach(function(e){d+=h.serializeToString(e)}):d+=h.serializeToString(e)}),e&&t.do(he.DELETE_SELECTION),d='<div comma="comma-content">'+d+"</div>"}},{key:"ForceClipboardContent",value:function(e){var t=(new XMLSerializer).serializeToString(e);a._copyTextToClipboard('<div comma="comma-content">'+t+"</div>")}}])&&ue(e.prototype,t),n&&ue(e,n),a}();function de(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var he={GET_STYLES_AT_CARRET:"getStyleAtCurrentCursorPosition",TOGGLE_STYLE_ON_LINE:"toggleStyleOnLine",TOGGLE_STYLE_ON_SELECTION:"toggleStyleOnSelection",INSERT_CHAR:"addChar",ENTER:"enter",DELETE:"delete",DELETE_SELECTION:"deleteSelection",BACKSPACE:"backspace",TAB:"tab",CUT:"cut",COPY:"copy",PASTE:"paste",ESC:"esc"},fe=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.document=e,this.selectionManager=new F(this.document),this.stylesManager=new X(this.document),this.enterManager=new Z(this.document),this.deleteManager=new $(this.document),this.clipboardManager=new ce(this.document),this.catchUserInput=!1,null!=t&&(this.catchUserInput=!0,this.charactersToCacth=t.characters,this.onCharacterEntered=t.onCharacterEntered)}var e,t,i;return e=n,(t=[{key:"do",value:function(e,t){var n,i=void 0,o=!1;if(this.catchUserInput&&(n="",-1<this.charactersToCacth.indexOf(e)?n=this.charactersToCacth[this.charactersToCacth.indexOf(e)]:"addChar"==e&&-1<this.charactersToCacth.indexOf(t.character)&&(n=t.character),""!=n&&this.onCharacterEntered(n)&&(i=o=!0)),!o){var r=this.selectionManager.GetStartNode();if(null!=r&&r.isTextNode())switch(e){case he.INSERT_CHAR:i=this._insertCharacter(t.character);break;case he.TOGGLE_STYLE_ON_LINE:i=(i=this.document.NotifyPlugin(q.APPLY_STYLE_ON_LINE,r,t))||this.stylesManager.ToggleStyleOnLine(t.styleName,t.value);break;case he.TOGGLE_STYLE_ON_SELECTION:i=(i=this.document.NotifyPlugin(q.APPLY_STYLE_ON_TEXT,r,t))||this.stylesManager.ToggleStyleOnSelection(t.styleName,t.value);break;case he.GET_STYLES_AT_CARRET:i=this.stylesManager.GetStyleAtCurrentCursorPosition();break;case he.ENTER:i=this.enterManager.Insert();break;case he.DELETE:i=this.deleteManager.Delete();break;case he.DELETE_SELECTION:i=this.deleteManager.DeleteSelection();break;case he.BACKSPACE:i=this.deleteManager.Backspace();break;case he.TAB:i=this.stylesManager.ToggleStyleOnLine("indent","add"),i=!0;break;case he.COPY:i=this.clipboardManager.Copy(t);break;case he.CUT:i=this.clipboardManager.Cut(t,this);break;case he.PASTE:i=this.clipboardManager.Paste(t,this);break;default:return}else switch(e){case he.TOGGLE_STYLE_ON_LINE:this.document.NotifyPlugin(q.APPLY_STYLE_ON_LINE,void 0,t);break;case he.TOGGLE_STYLE_ON_SELECTION:this.document.NotifyPlugin(q.APPLY_STYLE_ON_TEXT,void 0,t);break;case he.BACKSPACE:i=!0,null!=r&&(r.document.IsNodeInsidePlugin(r)?void 0===(i=this.document.NotifyPlugin(q.DELETE,void 0,t))&&(i=!0):this.document.NotifyPlugin(q.DELETE,void 0,t));break;case he.DELETE:this.document.NotifyPlugin(q.DELETE,void 0,t),i=!0;break;case he.ENTER:i=!0;break;default:i=!this.document.IsNodeInsidePlugin(r)}}return i}},{key:"_insertCharacter",value:function(e){var t=!1;this.selectionManager.IsCollapsed()||this.document.DeleteSelection();var n=this.selectionManager.GetStartNode();return null!=n&&n.isTextNode()?t=n.InsertCharacter(e):(t=!0,console.log(this.selectionManager.GetCurrent()),console.log("entering text on empty node",n)),t}},{key:"ForceClipboardContent",value:function(e){this.clipboardManager.ForceClipboardContent(e)}}])&&de(e.prototype,t),i&&de(e,i),n}(),pe={},ye=function(e,t,n){if("s"!=e)return pe[t];pe[t]=n},ge={isProduction:!0,version:"snqnee"},me="98.71.57.106.89.87.120.111.98.51.78.48",ve="77.67.52.119.76.106.65.117.77.65.61.61",Ce="77.84.73.51.76.106.65.117.77.67.52.120",Ne="97.72.82.48.99.68.111.118.76.122.65.117.77.67.52.119.76.106.65.54.77.122.65.119.77.67.57.112.80.119.61.61";ge.isProduction&&(Ne="97.72.82.48.99.72.77.54.76.121.57.51.100.51.99.117.89.50.57.116.98.87.70.113.99.121.53.106.98.50.48.118.97.84.56.61");var Ee="98.71.57.106.89.88.82.112.98.50.52.61",Se="97.71.57.122.100.71.53.104.98.87.85.61",Te="90.87.53.106.98.50.82.108.86.86.74.74.81.50.57.116.99.71.57.117.90.87.53.48";function be(e){for(var t=e.split("."),n="",i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return atob(n)}var Ae=!1,xe=!1;function ke(){var e=function(e){if(null!=e&&""!=e){var t=window[be(Ee)][be(Se)];4==t.split(".").length||(t=t.split(".").slice(-2).join("."));for(var n=(e+"#"+ge.version+"#"+t).toString().split(""),i=0;i<n.length;i++){n[i].charCodeAt(0)<=126&&(n[i]=String.fromCharCode((n[i].charCodeAt(0)+13)%126))}e=btoa(n.join(""))}return window[be(Te)](e)}(ye("g","l"));if(null==e)return new Promise(function(e,t){navigator.onLine?xe=!(Ae=!1):Ae=xe=!0,e()});var n=new Image;navigator.onLine&&ye("g","f")(n,be(Ne)+e);var i=!1;return n[be("99.51.74.106")].indexOf(e)<0&&(i=!0),new Promise(function(e,t){i?xe=!(Ae=!1):navigator.onLine?(n[be("98.50.53.115.98.50.70.107")]=function(e){xe=!(Ae=!1)},n[be("98.50.53.108.99.110.74.118.99.103.61.61")]=function(e){xe=Ae=!0}):Ae=xe=!0,e()})}var Pe,Oe,_e=0,we=(Pe=20,Oe=500,Math.floor(Math.random()*(Oe-Pe+1)+Pe)),Fe=!0;function Ie(){var e=!1;return!function(){if(!Fe){var e=window[be(Ee)][be(Se)],t=!1;return e!=be(me)&&e!=be(ve)&&e!=be(Ce)||(t=!0),t}}()?we<++_e?xe?e=Ae:(e=!0,ke()):e=(ye("g","v")&&ye("g","vv"),!0):(""==ye("g","l")||null==ye("g","l")||ye("g","v")&&ye("g","vv"))&&(e=!0),e}var Re=Ie;function De(e){return function(e){if(Array.isArray(e))return Le(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Le(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Me(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ge=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.document=e,this.allPlugins={},this.allInstances={},this.catchSpecialChars=[],this.specialCharToPlugin={},this.selectionManager=new F(this.document),this.idInstanceInFocus=void 0}var e,n,i;return e=t,(n=[{key:"Register",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:void 0,i=e.GetName();if(null!=this.allPlugins[i])throw"Plugin or plugin's name already registered: '"+i+"'";var o={name:i,class:e,options:n};this.allPlugins[i]=o,null!=n&&n.fireOnChar&&null!=n.charForFire&&""!=n.charForFire&&(this.catchSpecialChars.push(n.charForFire),null==this.specialCharToPlugin[n.charForFire]&&(this.specialCharToPlugin[n.charForFire]=[]),this.specialCharToPlugin[n.charForFire].push(i))}},{key:"GetAllPluginInstances",value:function(e){var n=0<arguments.length&&void 0!==e?e:void 0,i=[],o=this;return Object.keys(this.allInstances).forEach(function(e){var t=o.allInstances[e];null!=n&&t.rootNode.GetPluginType().toLowerCase()!=n.toLowerCase()||i.push(t)}),i}},{key:"GetPluginOptions",value:function(e){var t=this.allPlugins[e];return null!=t?t.options:void 0}},{key:"NotifyPluginOnSpecialChar",value:function(e){var n=this,t=!1;return-1<this.catchSpecialChars.indexOf(e)&&this.specialCharToPlugin[e].forEach(function(e){var t=n.allPlugins[e];null!=t.options&&(t.options.fireCreateNew?n.InsertPluginAtSection(e):t.class[t.options.fireStaticFunction](n.document,t.options))}),Re()||(t=!0),t}},{key:"IsNodeInsidePlugin",value:function(e){return null!=this.FindNodesInstance(e)}},{key:"NotifyPlugin",value:function(e,t,n){if(null!=t){var i,o,r=this.FindNodesInstance(t);return null!=r?(this.idInstanceInFocus!=r.id&&(null!=(i=this.allInstances[this.idInstanceInFocus])&&i.Fire(q.LOST_FOCUS),this.idInstanceInFocus=r.id),this.idInstanceInFocus=r.id,r.Fire(e,t,this,n)):(null==this.idInstanceInFocus||null!=(o=this.allInstances[this.idInstanceInFocus])&&o.Fire(q.LOST_FOCUS),this.idInstanceInFocus=void 0,!1)}if(null!=this.idInstanceInFocus){var s=this.allInstances[this.idInstanceInFocus];if(null!=s)return s.Fire(e,t,this,n)}}},{key:"CallPluginStaticMethod",value:function(e,t,n){var i=this.allPlugins[e];if(null==i||null==i.class)throw"Unknown plugin: '"+e+"'";i.class[t](this.document,n)}},{key:"FindNodesInstance",value:function(e){var t=void 0;return null!=e.GetPluginType()&&""!=e.GetPluginType()?t=this.allInstances[e.id]:null!=e.parent&&(t=this.FindNodesInstance(e.parent)),t}},{key:"RegisterPluginInstance",value:function(e){this.allInstances[e.id]=e}},{key:"DeletePluginInstance",value:function(e){delete this.allInstances[e.id]}},{key:"RemovePluginInstance",value:function(e){var t=this.allInstances[e];null!=t&&(null!=t.rootNode&&t.rootNode.RemovePluginType(),delete this.allInstances[e])}},{key:"ChangePluginInstanceId",value:function(e,t){var n=this.allInstances[e];null!=n&&(n.id=t,delete this.allInstances[e],this.RegisterPluginInstance(n))}},{key:"InsertPluginAtSection",value:function(t,e){var n=this.allPlugins[t];if(null==n||null==n.class)throw"Unknown plugin: '"+t+"'";var i,o=n.class.CreateNew(this.document,e);return null!=o&&(Array.isArray(o)?(i=this,o.forEach(function(e){e.rootNode.SetPluginType(t),i.RegisterPluginInstance(e)})):(o.rootNode.SetPluginType(t),this.RegisterPluginInstance(o))),o}},{key:"CreatePluginInstance",value:function(e,t){var n=this.allPlugins[e];if(null==n||null==n.class)throw"Unknown plugin: '"+e+"'";var i=new n.class(t);i.rootNode.SetPluginType(e),this.RegisterPluginInstance(i)}},{key:"FindPluginForPasteByTagName",value:function(n){var i=void 0,o=this;return Object.keys(this.allPlugins).forEach(function(e){var t=o.allPlugins[e];-1<t.class.GetTagToParseOnPaste().indexOf(n.toLowerCase())&&(i=t)}),i}},{key:"PasteContentToPlugin",value:function(e,t){var n=this.FindPluginForPasteByTagName(e);if(null!=n){var i=n.class.CreateNewFromPastedNode(this.document,t);if(null!=i.mustArrangeNodes&&i.mustArrangeNodes){var o=i.pluginNode,r=i.nodesBefore,s=i.nodesAfter;return o.rootNode.SetPluginType(n.name),this.RegisterPluginInstance(o),[].concat(De(r),[o.rootNode],De(s))}return i.rootNode.SetPluginType(n.name),this.RegisterPluginInstance(i),i.rootNode}}}])&&Me(e.prototype,n),i&&Me(e,i),t}();function Be(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var He=function(){function d(e,t,n,i,o,r,s,a,l){var u=this,c=9<arguments.length&&void 0!==arguments[9]?arguments[9]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),this.readOnly=e,this.nodeContainer=n,this.allStyles=i,this.onStyleChanged=s,this.onDocChanged=a,this.IdManager=new p,this.actionsManager=new fe(this,c),this.pluginsManager=new Ge(this),this.selectionManager=new F(this),this.historyManager=void 0,this.rootNode=void 0,this.allNodesById={},null!=l&&l.forEach(function(e){u.pluginsManager.Register(e.pClass,e.options)}),this.defaultNodeStyle=C.ParseDefaultFormat(this,o),null==t||""==t?this.InitEmptyDoc(this.defaultNodeStyle):this.LoadContent(t)}var e,t,n;return e=d,(t=[{key:"SetHistoryManager",value:function(e){this.historyManager=e}},{key:"PushToHistory",value:function(){null!=this.onDocChanged&&this.onDocChanged(),this.historyManager.Push(this.GetContent(),this.GetCursorPosition())}},{key:"LoadContent",value:function(e,t){var n,i,o=!(1<arguments.length&&void 0!==t)||t;for(this.rootNode=void 0,this.allNodesById={},this.IdManager.Reset();this.nodeContainer.firstChild;)this.nodeContainer.removeChild(this.nodeContainer.firstChild);null==e||""==e?this.InitEmptyDoc():(n=new le(this),this.rootNode=n.HtmlToNode(e,o),this.nodeContainer.appendChild(this.rootNode.domElement),null!=(i=this.rootNode.GetFirstTextNode())?i.SetFocus():console.log("#01-01"))}},{key:"AddDevContent",value:function(){var e=this;setTimeout(function(){e.InsertPluginAtSection("table",{rows:3,cols:4})},200)}},{key:"ForceClipboardContent",value:function(e){var t=this,n=this.GetCursorPosition();this.actionsManager.ForceClipboardContent(e),setTimeout(function(){t.SetCursorPosition(n)},1)}},{key:"InitEmptyDoc",value:function(){for(;this.nodeContainer.firstChild;)this.nodeContainer.removeChild(this.nodeContainer.firstChild);this.rootNode=G.CreateNew(this,"div");var e=void 0;null!=this.defaultLineStyle&&(e=this.defaultLineStyle.Copy());var t=G.CreateNew(this,"div",e),n=void 0;null!=this.defaultNodeStyle&&(n=this.defaultNodeStyle.Copy());var i=P.CreateNew(this,"span","",n);t.Append(i),this.rootNode.Append(t),this.nodeContainer.appendChild(this.rootNode.domElement),i.SetFocus()}},{key:"Focus",value:function(){this.rootNode.GetFirstTextNode().SetFocus()}},{key:"FocusAtTheEnd",value:function(){this.rootNode.GetLastTextNode().SetFocusAtTheEnd()}},{key:"isContentEmpty",value:function(){return this.rootNode.isEmpty()}},{key:"GetFloatingContainer",value:function(){var e,t,n=void 0,i=this.rootNode.children[this.rootNode.children.length-1];return i.isBlockNode()&&(n=null==(e=i.domElement.getAttribute("cm-floating-container"))||""==e?(t=G.CreateNew(this,"div",void 0,[{name:"contentEditable",value:!1},{name:"cm-floating-container",value:!0}]),this.rootNode.Append(t),t):i),n}},{key:"GetDefaultNodeStyle",value:function(){return this.defaultNodeStyle.Copy()}},{key:"GenereateNewNodeId",value:function(){return this.IdManager.GetNew()}},{key:"VerifyAndRegisterNodeId",value:function(e){return this.IdManager.VerifyAndRegister(e)}},{key:"RegisterNode",value:function(e){this.allNodesById[e.id]=e}},{key:"GetNodeById",value:function(e){return this.allNodesById[e]}},{key:"UnregisterNode",value:function(e){this.pluginsManager.NotifyPlugin(q.NODE_UNREGISTERED,e),delete this.allNodesById[e.id]}},{key:"GetAllPluginInstances",value:function(e){return this.pluginsManager.GetAllPluginInstances(e)}},{key:"DeleteNode",value:function(e,t,n,i){var o=2<arguments.length?n:void 0,r=3<arguments.length?i:void 0;1<arguments.length&&void 0!==t&&t?(e.domElement.remove(),this.UnregisterNode(e)):_.ReplaceNode(this,e,[],!1,o,r)}},{key:"GetNodeAtCursor",value:function(){return this.selectionManager.GetStartNode()}},{key:"GetSelectionBoundingClientRect",value:function(){return this.selectionManager.GetBoundingClientRect()}},{key:"ManagerSpecialActions",value:function(e,t){var n=!1;switch(e){case"newCharAdded":this.NotifyPlugin(q.NEW_CHAR_ADDED,this.selectionManager.GetStartNode(),t);break;case"enter":n=(n=this.NotifyPlugin(q.ENTER,this.selectionManager.GetStartNode()))||this.actionsManager.do(he.ENTER);break;case"backspace":n=this.actionsManager.do(he.BACKSPACE);break;case"delete":n=(n=this.NotifyPlugin(q.DELETE,this.selectionManager.GetStartNode()))||this.actionsManager.do(he.DELETE);break;case"tab":n=(n=this.NotifyPlugin(q.TAB,this.selectionManager.GetStartNode()))||this.actionsManager.do(he.TAB);break;case"BEFORE_COPY":n=this.NotifyPlugin(q.BEFORE_COPY,this.selectionManager.GetStartNode(),t);break;case"BEFORE_CUT":n=this.NotifyPlugin(q.BEFORE_CUT,this.selectionManager.GetStartNode(),t);break;case"BEFORE_PASTE":n=this.NotifyPlugin(q.BEFORE_PASTE,this.selectionManager.GetStartNode(),t);break;case"copy":n=this.actionsManager.do(he.COPY,t);break;case"cut":n=this.actionsManager.do(he.CUT,t);break;case"paste":n=this.actionsManager.do(he.PASTE,t);break;case"click":var i=this.GetNodeById(t.srcElement.getAttribute("cm-id"));null!=i&&(n=this.NotifyPlugin(q.CLICK,i));break;case"ARROW_UP":n=this.NotifyPlugin(q.ARROW_UP,this.selectionManager.GetStartNode(),t);break;case"ARROW_DOWN":n=this.NotifyPlugin(q.ARROW_DOWN,this.selectionManager.GetStartNode(),t);break;case"ARROW_LEFT":n=this.NotifyPlugin(q.ARROW_LEFT,this.selectionManager.GetStartNode(),t);break;case"ARROW_RIGHT":n=this.NotifyPlugin(q.ARROW_RIGHT,this.selectionManager.GetStartNode(),t);break;case"SHIFT_ARROW_UP":n=this.NotifyPlugin(q.SHIFT_ARROW_UP,this.selectionManager.GetStartNode(),t);break;case"SHIFT_ARROW_DOWN":n=this.NotifyPlugin(q.SHIFT_ARROW_DOWN,this.selectionManager.GetStartNode(),t);break;case"SHIFT_ARROW_LEFT":n=this.NotifyPlugin(q.SHIFT_ARROW_LEFT,this.selectionManager.GetStartNode(),t);break;case"SHIFT_ARROW_RIGHT":n=this.NotifyPlugin(q.SHIFT_ARROW_RIGHT,this.selectionManager.GetStartNode(),t);break;case"SHIFT_DOWN":n=this.NotifyPlugin(q.SHIFT_DOWN,this.selectionManager.GetStartNode(),t);break;case"SHIFT_UP":n=this.NotifyPlugin(q.SHIFT_UP,this.selectionManager.GetStartNode(),t);break;case"SELECT_ALL":n=this.NotifyPlugin(q.SELECT_ALL,this.selectionManager.GetStartNode(),t);break;case"ESC":n=this.NotifyPlugin(q.ESC,this.selectionManager.GetStartNode()),this.actionsManager.do(he.ESC);break;case"SELECTION_CHANGED":break;default:return}return n}},{key:"SaveCursorPositonBeforeClick",value:function(){this.cursorPositonBeforeClick=this.GetCursorPosition()}},{key:"RestoreCursorPositionBeforeClick",value:function(){this.SetCursorPosition(this.cursorPositonBeforeClick)}},{key:"DeleteSelection",value:function(){return this.actionsManager.do(he.DELETE_SELECTION)}},{key:"InsertCharacter",value:function(e){if(this.pluginsManager.NotifyPluginOnSpecialChar(e))return!0;var t={character:e};return this.actionsManager.do(he.INSERT_CHAR,t)}},{key:"ToggleStyleOnSelection",value:function(e,t){var n={styleName:e,value:t};return this.actionsManager.do(he.TOGGLE_STYLE_ON_SELECTION,n)}},{key:"ToggleStyleOnLine",value:function(e,t){var n={styleName:e,value:t};return this.actionsManager.do(he.TOGGLE_STYLE_ON_LINE,n)}},{key:"GetStyleAtCurrentCursorPosition",value:function(){return this.actionsManager.do(he.GET_STYLES_AT_CARRET)}},{key:"GetCurrentStyle",value:function(){return new C(this,this.actionsManager.do(he.GET_STYLES_AT_CARRET).nodeStyle).Copy()}},{key:"GetContent",value:function(){return this.content=this.nodeContainer.innerHTML,this.content}},{key:"GetCursorPosition",value:function(){var e=window.getSelection(),t=void 0;e.rangeCount?t=e.getRangeAt(0):(t=document.createRange()).collapse(!0);var n,i,o=t.startContainer.parentNode,r=t.startOffset,s=t.endContainer.parentNode,a=t.endOffset;return null!=o&&null!=s&&(n=o.getAttribute("cm-id"),i=s.getAttribute("cm-id")),{idStartNode:n,startOffset:r,idEndNode:i,endOffset:a}}},{key:"SetCursorPosition",value:function(e){var t,n,i=this.GetNodeById(e.idStartNode),o=this.GetNodeById(e.idEndNode);null!=i&&null!=o&&(t=window.getSelection(),(n=document.createRange()).setStart(i.domElement.firstChild,e.startOffset),n.setEnd(o.domElement.firstChild,e.endOffset),t.removeAllRanges(),t.addRange(n))}},{key:"VerifyCursorPosition",value:function(e){this.selectionManager.VerifyCursorPosition(e)}},{key:"IsNodeInsidePlugin",value:function(e){var t=!1;return null!=e&&(null==this.pluginsManager.FindNodesInstance(e)||(t=!0)),t}},{key:"GetPluginOptions",value:function(e){return this.pluginsManager.GetPluginOptions(e)}},{key:"CreatePluginInstance",value:function(e,t){return this.pluginsManager.CreatePluginInstance(e,t)}},{key:"RemovePluginInstance",value:function(e){return this.pluginsManager.RemovePluginInstance(e)}},{key:"InsertPluginAtSection",value:function(e,t){var n=void 0;return this.selectionManager.GetCurrent().hasFocus&&(n=this.pluginsManager.InsertPluginAtSection(e,t)),this.PushToHistory(),n}},{key:"CallPluginStaticMethod",value:function(e,t,n){this.pluginsManager.CallPluginStaticMethod(e,t,n)}},{key:"NotifyPlugin",value:function(e,t,n){return this.pluginsManager.NotifyPlugin(e,t,n)}},{key:"InsertNodeAtCursor",value:function(e){_.InsertNodeAtCursor(this,e)}},{key:"ChangePluginInstanceId",value:function(e,t){this.pluginsManager.ChangePluginInstanceId(e,t)}},{key:"AppendTextAtCursor",value:function(e,t){this.DeleteSelection();var n,i,o=this.GetCursorPosition(),r=this.GetNodeById(o.idStartNode);null==r&&(o=t,r=this.GetNodeById(o.idStartNode)),r.isTextNode()&&(n=o.startOffset,i=r.text,r.ForceTextContent([i.slice(0,n),e,i.slice(n)].join("")),r.SetFocus(n+e.length),this.PushToHistory())}},{key:"AppendHtmlAtCursor",value:function(e){this.DeleteSelection(),new le(this).PasteContentInPlace(e)}},{key:"Autocorrect",value:function(e){var t,i,o;null!=e&&0<e.length&&(t=this.GetCursorPosition(),(i=this.GetNodeById(t.idStartNode)).isTextNode()&&(o=i.text,e.forEach(function(e){var t,n=o.indexOf(e.string);-1<n&&(t=n+e.replaceWith.length,i.ForceTextContent(o.replace(e.string,e.replaceWith)),t>i.text.length?t=i.text.length:t<0&&(t=0),i.SetFocus(t))})))}},{key:"GetSelectedLines",value:function(){return this.selectionManager.GetSelectedLines()}},{key:"IsolateAndReturnSelectedTextNodes",value:function(){return this.selectionManager.IsolateAndReturnSelectedTextNodes()}},{key:"GetSelectedTextNodes",value:function(){return this.selectionManager.GetSelectedTextNodes()}},{key:"FireStyleChanged",value:function(){null!=this.onStyleChanged&&this.onStyleChanged(this.GetStyleAtCurrentCursorPosition())}},{key:"Test",value:function(){console.log("Hi!")}}])&&Be(e.prototype,t),n&&Be(e,n),d}(),Ue=!1,je=!1,We="",Ke="eXxwbnl1fAID",Ye="PTs9Oz07PQ==",ze="Pj9EOz07PTs+",Je="dnsCcgEDT3JzfAFy",Xe="c3YBAgNQdXZ5cQ==",Ve="dQMDfUc8PD07PTs9Oz1HQD09PTx2TA==";ge.isProduction&&(Ve="dQMDfQJHPDwGBgY7cHx6em53AjtwfHo8dkw=");var Ze="UHx6em5XYEctfXlybgJyLX0BfAV2cXItbi0Fbnl2cS15dnBye3ByLXhyCA==",qe="b25weHQBfAR7cTpwfHl8AUcBcnFIfW5xcXZ7dEc+PX0HSHB8eXwBRzBzc3Nzc3NI";function Qe(e,t){if(ye("s","l",t),t=function(e){if(null!=e&&""!=e){var t=window.location.hostname;4==t.split(".").length||(t=t.split(".").slice(-2).join("."));for(var n=(e+"#"+ge.version+"#"+t).toString().split(""),i=0;i<n.length;i++){n[i].charCodeAt(0)<=126&&(n[i]=String.fromCharCode((n[i].charCodeAt(0)+13)%126))}e=btoa(n.join(""))}return window.encodeURIComponent(e)}(t),Ue)return new Promise(function(e,t){je?t(!0):e(!1)});if(null==t)return Ue=!0,new Promise(function(e,t){navigator.onLine?(ye("s","vv",!(je=!1)),e(!1)):(ye("s","vv",je=!0),t(!0))});Ue=!0;var n=new Image,i=!1;return navigator.onLine&&e(n,tt(Ve)+t),n[tt("AgFw")].indexOf(t)<0&&(i=!0),new Promise(function(e,t){navigator.onLine?i?(ye("s","vv",!(je=!1)),e(!1)):(n.onload=function(){ye("s","vv",!(je=!1)),e(!1)},n.onerror=function(e){ye("s","vv",je=!0),t(!0)}):(ye("s","vv",je=!0),t(!0))})}function $e(){ye("s","v",!0)}function et(){ye("s","v",!1);var e=document.getElementById(ye("g","i")).parentElement,t=document.createElement("div");t.setAttribute("style",tt(qe)),t.textContent=tt(Ze),e[tt(Je)](t,e[tt(Xe)])}function tt(e){return function(e,t,n){var i=1<arguments.length&&void 0!==t?t:13,o=2<arguments.length&&void 0!==n&&n;if("number"!=typeof i||i%1!=0||"number"!=typeof i||i%1!=0)return e.toString();for(var r=e.toString().split(""),s=0;s<r.length;s++){r[s].charCodeAt(0)<=126&&(r[s]=String.fromCharCode((r[s].charCodeAt(0)+i)%126))}return o?btoa(r.join("")):r.join("")}(e=atob(e),113)}var nt=!1;function it(e){ye("s","i",e.idContainerOrDomElement),!function(){if(!nt){var e=!1;return(We=window.location.hostname)!=tt(Ke)&&We!=tt(Ye)&&We!=tt(ze)||(e=!0),e}}()?(ye("s","f",e.InitSrc),Qe(e.InitSrc,e.e).then(function(e){et()}).catch(function(e){(e?$e:et)()})):$e()}var ot=function(e){it(e)},rt=function(e,t){e.src=t};function st(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var at=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.id=e.id,this.rootNode=e,t||this.InitializeDomElements()}var e,t,i;return e=n,i=[{key:"GetName",value:function(){return""}},{key:"CreateNew",value:function(){throw"CreateNew: Not implemented"}},{key:"CreateNewFromPastedNode",value:function(){throw"CreateNewFromPastedNode: Not implemented"}},{key:"GetTagToParseOnPaste",value:function(){return[]}}],(t=[{key:"Fire",value:function(){}},{key:"InitializeDomElements",value:function(e){var t;null!=this.PluginDidMount&&(null==this.rootNode.parent?(null==e?e=0:e++,e<50?(t=this,setTimeout(function(){t.InitializeDomElements(e)},100)):console.log("#345-23")):this.readOnly||this.PluginDidMount())}}])&&st(e.prototype,t),i&&st(e,i),n}(),lt={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,i,o,r,s,a,l="",u=0;for(e=lt._utf8_encode(e);u<e.length;)o=(t=e.charCodeAt(u++))>>2,r=(3&t)<<4|(n=e.charCodeAt(u++))>>4,s=(15&n)<<2|(i=e.charCodeAt(u++))>>6,a=63&i,isNaN(n)?s=a=64:isNaN(i)&&(a=64),l=l+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(s)+this._keyStr.charAt(a);return l},decode:function(e){var t,n,i,o,r,s,a="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=this._keyStr.indexOf(e.charAt(l++))<<2|(o=this._keyStr.indexOf(e.charAt(l++)))>>4,n=(15&o)<<4|(r=this._keyStr.indexOf(e.charAt(l++)))>>2,i=(3&r)<<6|(s=this._keyStr.indexOf(e.charAt(l++))),a+=String.fromCharCode(t),64!=r&&(a+=String.fromCharCode(n)),64!=s&&(a+=String.fromCharCode(i));return a=lt._utf8_decode(a)},_utf8_encode:function(e){var t="";e=e.replace(/\r\n/g,"\n");for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):(127<i&&i<2048?t+=String.fromCharCode(i>>6|192):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128)),t+=String.fromCharCode(63&i|128))}return t},_utf8_decode:function(e){for(var t,n,i="",o=0,r=t=0;o<e.length;)(r=e.charCodeAt(o))<128?(i+=String.fromCharCode(r),o++):191<r&&r<224?(t=e.charCodeAt(o+1),i+=String.fromCharCode((31&r)<<6|63&t),o+=2):(t=e.charCodeAt(o+1),n=e.charCodeAt(o+2),i+=String.fromCharCode((15&r)<<12|(63&t)<<6|63&n),o+=3);return i}},ut=lt;function ct(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function dt(e){for(var t,n="",i=[107,101,121],o=0;o<i.length;o++)n+=(t=i[o],String.fromCharCode(t));return e[n]}var ht=function(){function i(e,t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),o.a.Init(),this.idContainerOrDomElement=e,this.document=void 0,t=this.ValidateUserOptions(t),this.readOnly=t.readOnly,this.onChange=t.onChange,this.onStyleChanged=t.onStyleChanged,this.onFilesPasted=t.onFilesPasted,this.onSelectinChange=t.onSelectinChange,this.styleMonitoring=t.styleMonitoring,this.content=t.content,this.defaultStyle=t.defaultStyle,this.allStyles=t.styles,this.caretColor=t.caretColor,this.defaultLineStyle=t.defaultLineStyle,this.catchUserInput=t.catchUserInput,this.e=dt(t),this.eventsManager=new h(this),this.historyManager=new s,this.plugins=[],null!=t.plugins&&(this.plugins=t.plugins),this.shortcutManager=new u(this),this.SetUserSettings(t),this._initContainer(),this.str="$#22#5#1975#$",setTimeout(function(){ot(n)},300)}var e,t,n;return e=i,(t=[{key:"InitSrc",value:function(e,t){return rt(e,t)}},{key:"ValidateUserOptions",value:function(e){return null==e&&(e={}),null==e.readOnly&&(e.readOnly=!1),null==e.onChange&&(e.onChange=function(){}),null==e.onStyleChanged&&(e.onStyleChanged=function(){}),null==e.onSelectinChange&&(e.onSelectinChange=function(){}),null==e.styleMonitoring&&(e.styleMonitoring=function(){}),null==e.content&&(e.content=""),null==e.defaultStyle&&(e.defaultStyle={bold:!1,fontSize:"14px",fontColor:"#39434d"}),null==e.defaultLineStyle&&(e.defaultLineStyle={align:"left"}),e}},{key:"SetUserSettings",value:function(e){null!=e&&""!=e||(e={}),this.shortcuts=[],this.autocorrect=[],this.useAutocorrect=!1,null!=e.userSettings?(null!=e.userSettings.shortcuts&&(this.shortcuts=e.userSettings.shortcuts),null!=e.userSettings.autocorrect&&0<e.userSettings.autocorrect.length&&(this.useAutocorrect=!0,this.autocorrect=e.userSettings.autocorrect)):(null!=e.shortcuts&&(this.shortcuts=e.shortcuts),null!=e.autocorrect&&0<e.autocorrect.length&&(this.useAutocorrect=!0,this.autocorrect=e.autocorrect)),this.shortcutManager.SetShortcuts(this.shortcuts)}},{key:"_KeyDown",value:function(e){this.eventsManager.KeyDown(e)}},{key:"_KeyUp",value:function(e){this.eventsManager.KeyUp(e),this.SelectionChanged()}},{key:"_Paste",value:function(e){this.eventsManager.OnPaste(e),this.FireStyleMonitoring()}},{key:"_Cut",value:function(e){this.eventsManager.OnCut(e),this.FireStyleMonitoring()}},{key:"_Copy",value:function(e){this.eventsManager.OnCopy(e),this.FireStyleMonitoring()}},{key:"_Click",value:function(e){this.eventsManager.OnClick(e),this.FireStyleMonitoring()}},{key:"_Mousedown",value:function(){this.SaveCursorPositonBeforeClick()}},{key:"_Mouseup",value:function(){this.SelectionChanged()}},{key:"_initContainer",value:function(){var t=this;"string"==typeof this.idContainerOrDomElement?this.mainContainer=document.getElementById(this.idContainerOrDomElement):this.mainContainer=this.idContainerOrDomElement,this.mainContainer.style.outline="none",this.mainContainer.style.opacity=0,this.mainContainer.style.whiteSpace="pre-wrap",null==this.caretColor||""==this.caretColor?this.mainContainer.style.caretColor="#475666":this.mainContainer.style.caretColor=this.caretColor,null!=this.defaultStyle.fontColor&&""!=this.defaultStyle.fontColor&&(this.mainContainer.style.color=this.defaultStyle.fontColor,delete this.defaultStyle.fontColor),this.readOnly?(this.mainContainer.setAttribute("contenteditable",!1),this.document=new He(this.readOnly,this.content,this.mainContainer,this.allStyles,this.defaultStyle,this.defaultLineStyle,this.styleMonitoring,function(e){return t.FireDocChanged(e)},this.plugins)):(this.mainContainer.setAttribute("contenteditable",!0),this.eventsFunctions={keydown:this._KeyDown.bind(this),keyup:this._KeyUp.bind(this),paste:this._Paste.bind(this),cut:this._Cut.bind(this),copy:this._Copy.bind(this),click:this._Click.bind(this),mousedown:this._Mousedown.bind(this),mouseup:this._Mouseup.bind(this)},this.mainContainer.addEventListener("keydown",this.eventsFunctions.keydown),this.mainContainer.addEventListener("keyup",this.eventsFunctions.keyup),this.mainContainer.addEventListener("paste",this.eventsFunctions.paste),this.mainContainer.addEventListener("cut",this.eventsFunctions.cut),this.mainContainer.addEventListener("copy",this.eventsFunctions.copy),this.mainContainer.addEventListener("click",this.eventsFunctions.click),this.mainContainer.addEventListener("mousedown",this.eventsFunctions.mousedown),null!=this.mainContainer.parentNode&&this.mainContainer.parentNode.addEventListener("mouseup",this.eventsFunctions.mouseup),this.document=new He(this.readOnly,this.content,this.mainContainer,this.allStyles,this.defaultStyle,this.defaultLineStyle,this.styleMonitoring,function(e){return t.FireDocChanged(e)},this.plugins,this.catchUserInput),this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),this.document.SetHistoryManager(this.historyManager),this.FireStyleMonitoring(),this.latestCursorPosition=this.document.GetCursorPosition()),this.mainContainer.style.opacity=1}},{key:"Destroy",value:function(){this.readOnly||(this.mainContainer.removeEventListener("keydown",this.eventsFunctions.keydown),this.mainContainer.removeEventListener("keyup",this.eventsFunctions.keyup),this.mainContainer.removeEventListener("paste",this.eventsFunctions.paste),this.mainContainer.removeEventListener("cut",this.eventsFunctions.cut),this.mainContainer.removeEventListener("copy",this.eventsFunctions.copy),this.mainContainer.removeEventListener("click",this.eventsFunctions.click),this.mainContainer.removeEventListener("mousedown",this.eventsFunctions.mousedown),null!=this.mainContainer.parentNode&&this.mainContainer.parentNode.removeEventListener("mouseup",this.eventsFunctions.mouseup))}},{key:"Fire",value:function(e,t){var n=!1,i=!0;switch(e){case d.CUR_POS_CHANGED:this.document.VerifyCursorPosition(t),n=i=!1;break;case d.ENTER:this.useAutocorrect&&this.Autocorrect(),this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),n=this.document.ManagerSpecialActions("enter");break;case d.BACKSPACE:this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),n=this.document.ManagerSpecialActions("backspace");break;case d.DELETE:this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),n=this.document.ManagerSpecialActions("delete");break;case d.TAB:n=this.document.ManagerSpecialActions("tab");break;case d.BEFORE_COPY:n=this.document.ManagerSpecialActions("BEFORE_COPY",t),i=!1;break;case d.BEFORE_CUT:n=this.document.ManagerSpecialActions("BEFORE_CUT",t),i=!1;break;case d.BEFORE_PASTE:n=this.document.ManagerSpecialActions("BEFORE_PASTE",t),i=!1;break;case d.COPY:n=this.document.ManagerSpecialActions("copy",t),i=!1;break;case d.CUT:this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),n=this.document.ManagerSpecialActions("cut",t);break;case d.PASTE:this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),n=this.document.ManagerSpecialActions("paste",t);break;case d.CLICK:n=this.document.ManagerSpecialActions("click",t),i=!1;break;case d.AFTER_CHAR_ADDED:this.document.ManagerSpecialActions("newCharAdded",t),i=!1;break;case d.ARROW_UP:n=this.document.ManagerSpecialActions("ARROW_UP",t),i=!1;break;case d.ARROW_DOWN:n=this.document.ManagerSpecialActions("ARROW_DOWN",t),i=!1;break;case d.ARROW_LEFT:n=this.document.ManagerSpecialActions("ARROW_LEFT",t),i=!1;break;case d.ARROW_RIGHT:n=this.document.ManagerSpecialActions("ARROW_RIGHT",t),i=!1;break;case d.SHIFT_ARROW_UP:n=this.document.ManagerSpecialActions("SHIFT_ARROW_UP",t),i=!1;break;case d.SHIFT_ARROW_DOWN:n=this.document.ManagerSpecialActions("SHIFT_ARROW_DOWN",t),i=!1;break;case d.SHIFT_ARROW_LEFT:n=this.document.ManagerSpecialActions("SHIFT_ARROW_LEFT",t),i=!1;break;case d.SHIFT_ARROW_RIGHT:n=this.document.ManagerSpecialActions("SHIFT_ARROW_RIGHT",t),i=!1;break;case d.SHIFT_DOWN:n=this.document.ManagerSpecialActions("SHIFT_DOWN",t),i=!1;break;case d.SHIFT_UP:n=this.document.ManagerSpecialActions("SHIFT_UP",t),i=!1;break;case d.SELECT_ALL:n=this.document.ManagerSpecialActions("SELECT_ALL",t),i=!1;break;case d.ESC:n=this.document.ManagerSpecialActions("ESC",t),i=!1;break;case d.BOLD:this.ToggleStyleOnSelection("bold",void 0),i=n=!1;break;case d.ITALIC:this.ToggleStyleOnSelection("italic",void 0),i=n=!1;break;case d.UNDERLINED:this.ToggleStyleOnSelection("underlined",void 0),i=n=!1;break;case d.SELECTION_CHANGED:this.document.ManagerSpecialActions("SELECTION_CHANGED"),i=!1;break;default:return}return i&&(this.FireDocChanged(),this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition())),n}},{key:"Undo",value:function(){var e=this.historyManager.GetUndo();this.document.LoadContent(e.content,!1),this.document.SetCursorPosition(e.cursorPosition),this.FireStyleMonitoring(),this.FireDocChanged()}},{key:"Redo",value:function(){var e=this.historyManager.GetRedo();this.document.LoadContent(e.content,!1),this.document.SetCursorPosition(e.cursorPosition),this.FireStyleMonitoring(),this.FireDocChanged()}},{key:"InsertCharacter",value:function(e){return this.charAdded=!0,this.document.InsertCharacter(e)}},{key:"Focus",value:function(){this.document.Focus()}},{key:"FocusAtTheEnd",value:function(){this.document.FocusAtTheEnd()}},{key:"isContentEmpty",value:function(){return this.document.isContentEmpty()}},{key:"DoneInsertCharacter",value:function(e){this.charAdded&&(this.charAdded=!1," "==e?(this.useAutocorrect&&this.Autocorrect(),this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition())):this.historyManager.PushChar(this.document.GetContent(),this.document.GetCursorPosition()),this.FireDocChanged())}},{key:"FireDocChanged",value:function(){var e=this;null!=this.onChange&&setTimeout(function(){e.onChange(e.mainContainer.innerHTML)}),this.latestCursorPosition=this.document.GetCursorPosition()}},{key:"FireStyleChanged",value:function(){var e=this.document.GetStyleAtCurrentCursorPosition();this.FireStyleMonitoring(),null!=this.onStyleChanged&&this.onStyleChanged(e)}},{key:"FireStyleMonitoring",value:function(){var e=this.document.GetStyleAtCurrentCursorPosition();null!=this.styleMonitoring&&this.styleMonitoring(e)}},{key:"ToggleStyleOnSelection",value:function(e,t){this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),this.document.ToggleStyleOnSelection(e,t),this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),this.FireDocChanged(),this.FireStyleMonitoring(),this.FireStyleChanged()}},{key:"ToggleStyleOnLine",value:function(e,t){this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),this.document.ToggleStyleOnLine(e,t),this.historyManager.Push(this.document.GetContent(),this.document.GetCursorPosition()),this.FireDocChanged(),this.FireStyleMonitoring(),this.FireStyleChanged()}},{key:"SetContent",value:function(e){this.mainContainer.style.opacity=0,this.content=e,this.document.LoadContent(this.content),this.mainContainer.style.opacity=1}},{key:"GetContent",value:function(){return this.mainContainer.innerHTML}},{key:"GetStyleAtCarret",value:function(){return this.document.GetStyleAtCurrentCursorPosition()}},{key:"StoreCursorPosition",value:function(){this.storedCursorPosition=this.document.GetCursorPosition()}},{key:"RestoreCursorPosition",value:function(){this.document.SetCursorPosition(this.storedCursorPosition)}},{key:"SaveCursorPositonBeforeClick",value:function(){this.document.SaveCursorPositonBeforeClick()}},{key:"AppendTextAtCursor",value:function(e){this.document.AppendTextAtCursor(e,this.latestCursorPosition)}},{key:"AppendHtmlAtCursor",value:function(e){this.document.AppendHtmlAtCursor(e,this.latestCursorPosition)}},{key:"SelectionChanged",value:function(){var i=this;setTimeout(function(){var e,t,n=i.document.GetCursorPosition();null==n.idStartNode||null!=(e=i.document.GetNodeById(n.idStartNode))&&(n.startNode=e.domElement),null==n.idEndNode||null!=(t=i.document.GetNodeById(n.idEndNode))&&(n.endNode=t.domElement),n.selectionBoundingRectangle=i.document.GetSelectionBoundingClientRect(),null!=i.onSelectinChange&&i.onSelectinChange(n)},10)}},{key:"InsertPluginAtSection",value:function(e,t){this.document.InsertPluginAtSection(e,t)}},{key:"CallPluginStaticMethod",value:function(e,t,n){this.document.CallPluginStaticMethod(e,t,n)}},{key:"ManageUserShortcuts",value:function(e){var t=this.shortcutManager.Fire(e);return t&&this.document.PushToHistory(),t}},{key:"Autocorrect",value:function(){this.document.Autocorrect(this.autocorrect)}},{key:"IsolateSelectedText",value:function(){this.document.ToggleStyleOnSelection("splitSelection");var e=this.document.rootNode.domElement.querySelectorAll(".splitSelectionDummy");return this.document.ToggleStyleOnSelection("splitSelection"),e}},{key:"GetNodesByAttr",value:function(e,t){return this.document.rootNode.domElement.querySelectorAll("["+e+'="'+t+'"]')}},{key:"SetAttribute",value:function(e,t,n){var i,o=e.getAttribute("cm-id");null==o||""==o||(i=this.document.GetNodeById(o)).isTextNode()&&i.AddAttribute(t,n)}},{key:"RemoveAttribute",value:function(i,e){var o=this;this.GetNodesByAttr(i,e).forEach(function(e){var t,n=e.getAttribute("cm-id");null==n||""==n||(t=o.document.GetNodeById(n)).isTextNode()&&t.RemoveAttribute(i)})}},{key:"_debugPrintNode",value:function(e,t){var n=this;null==t&&(t="");var i="noParent";null!=e.parent&&(i=e.parent.id);var o="noPrevious";null!=e.previous&&(o=e.previous.id),e.isTextNode()?console.log(t+e.id+" %c"+e.tagName+" %c"+e.type+" %c=> [%c"+e.text+"%c] %c"+i+" %c"+o,"color:red","color:#ad0c9d","color:black","color:#129957","color:black","color:#ffffff","color:#eeeeee"):console.log(t+e.id+" %c"+e.tagName+" %c"+e.type+" %c"+i+" %c"+o,"color:red","color:#ad0c9d","color:#ffffff","color:#eeeeee"),e.children.forEach(function(e){n._debugPrintNode(e,t+"   ")})}},{key:"Debug",value:function(e){var t;e?(t=this.document.rootNode,this._debugPrintNode(t)):console.log(this.document.rootNode)}},{key:"Test",value:function(){this.document.InsertPluginAtSection("image",{link:"/img/devImgTag.jpg"})}}])&&ct(e.prototype,t),n&&ct(e,n),i}();t.default=ht}],o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s=3);function o(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}var n,i});